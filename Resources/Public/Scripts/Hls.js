(()=>{var In=Object.create;var Bi=Object.defineProperty;var Cn=Object.getOwnPropertyDescriptor;var Pn=Object.getOwnPropertyNames;var Fn=Object.getPrototypeOf,On=Object.prototype.hasOwnProperty;var Mn=(ie,$)=>()=>($||ie(($={exports:{}}).exports,$),$.exports);var Nn=(ie,$,ye,xe)=>{if($&&typeof $=="object"||typeof $=="function")for(let Re of Pn($))!On.call(ie,Re)&&Re!==ye&&Bi(ie,Re,{get:()=>$[Re],enumerable:!(xe=Cn($,Re))||xe.enumerable});return ie};var Bn=(ie,$,ye)=>(ye=ie!=null?In(Fn(ie)):{},Nn($||!ie||!ie.__esModule?Bi(ye,"default",{value:ie,enumerable:!0}):ye,ie));var Gi=Mn((Ui,dr)=>{(function ie($){var ye,xe;ye=this,xe=function(){"use strict";function Re(s,a){var e=Object.keys(s);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(s);a&&(t=t.filter(function(r){return Object.getOwnPropertyDescriptor(s,r).enumerable})),e.push.apply(e,t)}return e}function de(s){for(var a=1;a<arguments.length;a++){var e=arguments[a]!=null?arguments[a]:{};a%2?Re(Object(e),!0).forEach(function(t){Ki(s,t,e[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(e)):Re(Object(e)).forEach(function(t){Object.defineProperty(s,t,Object.getOwnPropertyDescriptor(e,t))})}return s}function hr(s,a){for(var e=0;e<a.length;e++){var t=a[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(s,fr(t.key),t)}}function se(s,a,e){return a&&hr(s.prototype,a),e&&hr(s,e),Object.defineProperty(s,"prototype",{writable:!1}),s}function Ki(s,a,e){return(a=fr(a))in s?Object.defineProperty(s,a,{value:e,enumerable:!0,configurable:!0,writable:!0}):s[a]=e,s}function oe(){return oe=Object.assign?Object.assign.bind():function(s){for(var a=1;a<arguments.length;a++){var e=arguments[a];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(s[t]=e[t])}return s},oe.apply(this,arguments)}function Ee(s,a){s.prototype=Object.create(a.prototype),s.prototype.constructor=s,je(s,a)}function kt(s){return kt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},kt(s)}function je(s,a){return je=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},je(s,a)}function Vi(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Dt(s,a,e){return Dt=Vi()?Reflect.construct.bind():function(t,r,i){var n=[null];n.push.apply(n,r);var o=new(Function.bind.apply(t,n));return i&&je(o,i.prototype),o},Dt.apply(null,arguments)}function nt(s){var a=typeof Map=="function"?new Map:void 0;return nt=function(e){if(e===null||(t=e,Function.toString.call(t).indexOf("[native code]")===-1))return e;var t;if(typeof e!="function")throw new TypeError("Super expression must either be null or a function");if(a!==void 0){if(a.has(e))return a.get(e);a.set(e,r)}function r(){return Dt(e,arguments,kt(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),je(r,e)},nt(s)}function fr(s){var a=function(e,t){if(typeof e!="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}(s,"string");return typeof a=="symbol"?a:String(a)}function cr(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var vr={exports:{}};(function(s,a){var e,t,r,i,n;e=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,t=/^(?=([^\/?#]*))\1([^]*)$/,r=/(?:\/|^)\.(?=\/)/g,i=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,n={buildAbsoluteURL:function(o,l,u){if(u=u||{},o=o.trim(),!(l=l.trim())){if(!u.alwaysNormalize)return o;var d=n.parseURL(o);if(!d)throw new Error("Error trying to parse base URL.");return d.path=n.normalizePath(d.path),n.buildURLFromParts(d)}var h=n.parseURL(l);if(!h)throw new Error("Error trying to parse relative URL.");if(h.scheme)return u.alwaysNormalize?(h.path=n.normalizePath(h.path),n.buildURLFromParts(h)):l;var f=n.parseURL(o);if(!f)throw new Error("Error trying to parse base URL.");if(!f.netLoc&&f.path&&f.path[0]!=="/"){var c=t.exec(f.path);f.netLoc=c[1],f.path=c[2]}f.netLoc&&!f.path&&(f.path="/");var g={scheme:f.scheme,netLoc:h.netLoc,path:null,params:h.params,query:h.query,fragment:h.fragment};if(!h.netLoc&&(g.netLoc=f.netLoc,h.path[0]!=="/"))if(h.path){var m=f.path,y=m.substring(0,m.lastIndexOf("/")+1)+h.path;g.path=n.normalizePath(y)}else g.path=f.path,h.params||(g.params=f.params,h.query||(g.query=f.query));return g.path===null&&(g.path=u.alwaysNormalize?n.normalizePath(h.path):h.path),n.buildURLFromParts(g)},parseURL:function(o){var l=e.exec(o);return l?{scheme:l[1]||"",netLoc:l[2]||"",path:l[3]||"",params:l[4]||"",query:l[5]||"",fragment:l[6]||""}:null},normalizePath:function(o){for(o=o.split("").reverse().join("").replace(r,"");o.length!==(o=o.replace(i,"")).length;);return o.split("").reverse().join("")},buildURLFromParts:function(o){return o.scheme+o.netLoc+o.path+o.params+o.query+o.fragment}},s.exports=n})(vr);var _t=vr.exports,F=Number.isFinite||function(s){return typeof s=="number"&&isFinite(s)},Yi=Number.isSafeInteger||function(s){return typeof s=="number"&&Math.abs(s)<=Wi},Wi=Number.MAX_SAFE_INTEGER||9007199254740991,E=function(s){return s.MEDIA_ATTACHING="hlsMediaAttaching",s.MEDIA_ATTACHED="hlsMediaAttached",s.MEDIA_DETACHING="hlsMediaDetaching",s.MEDIA_DETACHED="hlsMediaDetached",s.BUFFER_RESET="hlsBufferReset",s.BUFFER_CODECS="hlsBufferCodecs",s.BUFFER_CREATED="hlsBufferCreated",s.BUFFER_APPENDING="hlsBufferAppending",s.BUFFER_APPENDED="hlsBufferAppended",s.BUFFER_EOS="hlsBufferEos",s.BUFFER_FLUSHING="hlsBufferFlushing",s.BUFFER_FLUSHED="hlsBufferFlushed",s.MANIFEST_LOADING="hlsManifestLoading",s.MANIFEST_LOADED="hlsManifestLoaded",s.MANIFEST_PARSED="hlsManifestParsed",s.LEVEL_SWITCHING="hlsLevelSwitching",s.LEVEL_SWITCHED="hlsLevelSwitched",s.LEVEL_LOADING="hlsLevelLoading",s.LEVEL_LOADED="hlsLevelLoaded",s.LEVEL_UPDATED="hlsLevelUpdated",s.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",s.LEVELS_UPDATED="hlsLevelsUpdated",s.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",s.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",s.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",s.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",s.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",s.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",s.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",s.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",s.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",s.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",s.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",s.CUES_PARSED="hlsCuesParsed",s.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",s.INIT_PTS_FOUND="hlsInitPtsFound",s.FRAG_LOADING="hlsFragLoading",s.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",s.FRAG_LOADED="hlsFragLoaded",s.FRAG_DECRYPTED="hlsFragDecrypted",s.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",s.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",s.FRAG_PARSING_METADATA="hlsFragParsingMetadata",s.FRAG_PARSED="hlsFragParsed",s.FRAG_BUFFERED="hlsFragBuffered",s.FRAG_CHANGED="hlsFragChanged",s.FPS_DROP="hlsFpsDrop",s.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",s.ERROR="hlsError",s.DESTROYING="hlsDestroying",s.KEY_LOADING="hlsKeyLoading",s.KEY_LOADED="hlsKeyLoaded",s.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",s.BACK_BUFFER_REACHED="hlsBackBufferReached",s}({}),K=function(s){return s.NETWORK_ERROR="networkError",s.MEDIA_ERROR="mediaError",s.KEY_SYSTEM_ERROR="keySystemError",s.MUX_ERROR="muxError",s.OTHER_ERROR="otherError",s}({}),k=function(s){return s.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",s.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",s.KEY_SYSTEM_NO_SESSION="keySystemNoSession",s.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",s.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",s.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",s.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",s.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",s.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",s.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",s.MANIFEST_LOAD_ERROR="manifestLoadError",s.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",s.MANIFEST_PARSING_ERROR="manifestParsingError",s.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",s.LEVEL_EMPTY_ERROR="levelEmptyError",s.LEVEL_LOAD_ERROR="levelLoadError",s.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",s.LEVEL_PARSING_ERROR="levelParsingError",s.LEVEL_SWITCH_ERROR="levelSwitchError",s.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",s.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",s.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",s.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",s.FRAG_LOAD_ERROR="fragLoadError",s.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",s.FRAG_DECRYPT_ERROR="fragDecryptError",s.FRAG_PARSING_ERROR="fragParsingError",s.FRAG_GAP="fragGap",s.REMUX_ALLOC_ERROR="remuxAllocError",s.KEY_LOAD_ERROR="keyLoadError",s.KEY_LOAD_TIMEOUT="keyLoadTimeOut",s.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",s.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",s.BUFFER_APPEND_ERROR="bufferAppendError",s.BUFFER_APPENDING_ERROR="bufferAppendingError",s.BUFFER_STALLED_ERROR="bufferStalledError",s.BUFFER_FULL_ERROR="bufferFullError",s.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",s.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",s.INTERNAL_EXCEPTION="internalException",s.INTERNAL_ABORTED="aborted",s.UNKNOWN="unknown",s}({}),we=function(){},xt={trace:we,debug:we,log:we,warn:we,info:we,error:we},qe=xt;function ji(s){var a=self.console[s];return a?a.bind(self.console,"["+s+"] >"):we}function gr(s,a){if(self.console&&s===!0||typeof s=="object"){(function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];r.forEach(function(n){qe[n]=e[n]?e[n].bind(e):ji(n)})})(s,"debug","log","info","warn","error");try{qe.log('Debug logs enabled for "'+a+'" in hls.js version 1.4.13')}catch{qe=xt}}else qe=xt}var L=qe,qi=/^(\d+)x(\d+)$/,mr=/(.+?)=(".*?"|.*?)(?:,|$)/g,Q=function(){function s(e){for(var t in typeof e=="string"&&(e=s.parseAttrList(e)),e)e.hasOwnProperty(t)&&(t.substring(0,2)==="X-"&&(this.clientAttrs=this.clientAttrs||[],this.clientAttrs.push(t)),this[t]=e[t])}var a=s.prototype;return a.decimalInteger=function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t},a.hexadecimalInteger=function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var r=new Uint8Array(t.length/2),i=0;i<t.length/2;i++)r[i]=parseInt(t.slice(2*i,2*i+2),16);return r}return null},a.hexadecimalIntegerAsNumber=function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t},a.decimalFloatingPoint=function(e){return parseFloat(this[e])},a.optionalFloat=function(e,t){var r=this[e];return r?parseFloat(r):t},a.enumeratedString=function(e){return this[e]},a.bool=function(e){return this[e]==="YES"},a.decimalResolution=function(e){var t=qi.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},s.parseAttrList=function(e){var t,r={};for(mr.lastIndex=0;(t=mr.exec(e))!==null;){var i=t[2];i.indexOf('"')===0&&i.lastIndexOf('"')===i.length-1&&(i=i.slice(1,-1)),r[t[1].trim()]=i}return r},s}();function Xi(s){return s==="SCTE35-OUT"||s==="SCTE35-IN"}var pr=function(){function s(a,e){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,e){var t=e.attr;for(var r in t)if(Object.prototype.hasOwnProperty.call(a,r)&&a[r]!==t[r]){L.warn('DATERANGE tag attribute: "'+r+'" does not match for tags with ID: "'+a.ID+'"'),this._badValueForSameId=r;break}a=oe(new Q({}),t,a)}if(this.attr=a,this._startDate=new Date(a["START-DATE"]),"END-DATE"in this.attr){var i=new Date(this.attr["END-DATE"]);F(i.getTime())&&(this._endDate=i)}}return se(s,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var a=this.duration;return a!==null?new Date(this._startDate.getTime()+1e3*a):null}},{key:"duration",get:function(){if("DURATION"in this.attr){var a=this.attr.decimalFloatingPoint("DURATION");if(F(a))return a}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}},{key:"endOnNext",get:function(){return this.attr.bool("END-ON-NEXT")}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&F(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),s}(),st=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}},me="audio",he="video",wt="audiovideo",yr=function(){function s(a){var e;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((e={})[me]=null,e[he]=null,e[wt]=null,e),this.baseurl=a}return s.prototype.setByteRange=function(a,e){var t=a.split("@",2),r=[];t.length===1?r[0]=e?e.byteRangeEndOffset:0:r[0]=parseInt(t[1]),r[1]=parseInt(t[0])+r[0],this._byteRange=r},se(s,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=_t.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(a){this._url=a}}]),s}(),It=function(s){function a(t,r){var i;return(i=s.call(this,r)||this)._decryptdata=null,i.rawProgramDateTime=null,i.programDateTime=null,i.tagList=[],i.duration=0,i.sn=0,i.levelkeys=void 0,i.type=void 0,i.loader=null,i.keyLoader=null,i.level=-1,i.cc=0,i.startPTS=void 0,i.endPTS=void 0,i.startDTS=void 0,i.endDTS=void 0,i.start=0,i.deltaPTS=void 0,i.maxStartPTS=void 0,i.minEndPTS=void 0,i.stats=new st,i.urlId=0,i.data=void 0,i.bitrateTest=!1,i.title=null,i.initSegment=null,i.endList=void 0,i.gap=void 0,i.type=t,i}Ee(a,s);var e=a.prototype;return e.setKeyFormat=function(t){if(this.levelkeys){var r=this.levelkeys[t];r&&!this._decryptdata&&(this._decryptdata=r.getDecryptData(this.sn))}},e.abortRequests=function(){var t,r;(t=this.loader)==null||t.abort(),(r=this.keyLoader)==null||r.abort()},e.setElementaryStreamInfo=function(t,r,i,n,o,l){l===void 0&&(l=!1);var u=this.elementaryStreams,d=u[t];d?(d.startPTS=Math.min(d.startPTS,r),d.endPTS=Math.max(d.endPTS,i),d.startDTS=Math.min(d.startDTS,n),d.endDTS=Math.max(d.endDTS,o)):u[t]={startPTS:r,endPTS:i,startDTS:n,endDTS:o,partial:l}},e.clearElementaryStreamInfo=function(){var t=this.elementaryStreams;t[me]=null,t[he]=null,t[wt]=null},se(a,[{key:"decryptdata",get:function(){if(!this.levelkeys&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){var t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{var r=Object.keys(this.levelkeys);if(r.length===1)return this._decryptdata=this.levelkeys[r[0]].getDecryptData(this.sn)}}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!F(this.programDateTime))return null;var t=F(this.duration)?this.duration:0;return this.programDateTime+1e3*t}},{key:"encrypted",get:function(){var t;if((t=this._decryptdata)!=null&&t.encrypted)return!0;if(this.levelkeys){var r=Object.keys(this.levelkeys),i=r.length;if(i>1||i===1&&this.levelkeys[r[0]].encrypted)return!0}return!1}}]),a}(yr),zi=function(s){function a(e,t,r,i,n){var o;(o=s.call(this,r)||this).fragOffset=0,o.duration=0,o.gap=!1,o.independent=!1,o.relurl=void 0,o.fragment=void 0,o.index=void 0,o.stats=new st,o.duration=e.decimalFloatingPoint("DURATION"),o.gap=e.bool("GAP"),o.independent=e.bool("INDEPENDENT"),o.relurl=e.enumeratedString("URI"),o.fragment=t,o.index=i;var l=e.enumeratedString("BYTERANGE");return l&&o.setByteRange(l,n),n&&(o.fragOffset=n.fragOffset+n.duration),o}return Ee(a,s),se(a,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var e=this.elementaryStreams;return!!(e.audio||e.video||e.audiovideo)}}]),a}(yr),Qi=function(){function s(a){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=a}return s.prototype.reloaded=function(a){if(!a)return this.advanced=!0,void(this.updated=!0);var e=this.lastPartSn-a.lastPartSn,t=this.lastPartIndex-a.lastPartIndex;this.updated=this.endSN!==a.endSN||!!t||!!e||!this.live,this.advanced=this.endSN>a.endSN||e>0||e===0&&t>0,this.updated||this.advanced?this.misses=Math.floor(.6*a.misses):this.misses=a.misses+1,this.availabilityDelay=a.availabilityDelay},se(s,[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&F(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var a=this.driftEndTime-this.driftStartTime;return a>0?1e3*(this.driftEnd-this.driftStart)/a:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var a;return(a=this.partList)!=null&&a.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var a;return(a=this.fragments)!=null&&a.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var a;return(a=this.partList)!=null&&a.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var a;return(a=this.partList)!=null&&a.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),s}(),Zi=cr(void 0);function Ie(s,a,e){return Uint8Array.prototype.slice?s.slice(a,e):new Uint8Array(Array.prototype.slice.call(s,a,e))}var Ct,Pt=function(s,a){return a+10<=s.length&&s[a]===73&&s[a+1]===68&&s[a+2]===51&&s[a+3]<255&&s[a+4]<255&&s[a+6]<128&&s[a+7]<128&&s[a+8]<128&&s[a+9]<128},Er=function(s,a){return a+10<=s.length&&s[a]===51&&s[a+1]===68&&s[a+2]===73&&s[a+3]<255&&s[a+4]<255&&s[a+6]<128&&s[a+7]<128&&s[a+8]<128&&s[a+9]<128},ot=function(s,a){for(var e=a,t=0;Pt(s,a);)t+=10,t+=lt(s,a+6),Er(s,a+10)&&(t+=10),a+=t;if(t>0)return s.subarray(e,e+t)},lt=function(s,a){var e=0;return e=(127&s[a])<<21,e|=(127&s[a+1])<<14,e|=(127&s[a+2])<<7,e|=127&s[a+3]},$i=function(s,a){return Pt(s,a)&&lt(s,a+6)+10<=s.length-a},Tr=function(s){return s&&s.key==="PRIV"&&s.info==="com.apple.streaming.transportStreamTimestamp"},Ji=function(s){var a=String.fromCharCode(s[0],s[1],s[2],s[3]),e=lt(s,4);return{type:a,size:e,data:s.subarray(10,10+e)}},Sr=function(s){for(var a=0,e=[];Pt(s,a);){for(var t=lt(s,a+6),r=(a+=10)+t;a+8<r;){var i=Ji(s.subarray(a)),n=ea(i);n&&e.push(n),a+=i.size+10}Er(s,a)&&(a+=10)}return e},ea=function(s){return s.type==="PRIV"?ta(s):s.type[0]==="W"?ia(s):ra(s)},ta=function(s){if(!(s.size<2)){var a=be(s.data,!0),e=new Uint8Array(s.data.subarray(a.length+1));return{key:s.type,info:a,data:e.buffer}}},ra=function(s){if(!(s.size<2)){if(s.type==="TXXX"){var a=1,e=be(s.data.subarray(a),!0);a+=e.length+1;var t=be(s.data.subarray(a));return{key:s.type,info:e,data:t}}var r=be(s.data.subarray(1));return{key:s.type,data:r}}},ia=function(s){if(s.type==="WXXX"){if(s.size<2)return;var a=1,e=be(s.data.subarray(a),!0);a+=e.length+1;var t=be(s.data.subarray(a));return{key:s.type,info:e,data:t}}var r=be(s.data);return{key:s.type,data:r}},aa=function(s){if(s.data.byteLength===8){var a=new Uint8Array(s.data),e=1&a[3],t=(a[4]<<23)+(a[5]<<15)+(a[6]<<7)+a[7];return t/=45,e&&(t+=4772185884e-2),Math.round(t)}},be=function(s,a){a===void 0&&(a=!1);var e=na();if(e){var t=e.decode(s);if(a){var r=t.indexOf("\0");return r!==-1?t.substring(0,r):t}return t.replace(/\0/g,"")}for(var i,n,o,l=s.length,u="",d=0;d<l;){if((i=s[d++])===0&&a)return u;if(i!==0&&i!==3)switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:u+=String.fromCharCode(i);break;case 12:case 13:n=s[d++],u+=String.fromCharCode((31&i)<<6|63&n);break;case 14:n=s[d++],o=s[d++],u+=String.fromCharCode((15&i)<<12|(63&n)<<6|(63&o)<<0)}}return u};function na(){return Ct||self.TextDecoder===void 0||(Ct=new self.TextDecoder("utf-8")),Ct}var Lr=function(s){for(var a="",e=0;e<s.length;e++){var t=s[e].toString(16);t.length<2&&(t="0"+t),a+=t}return a},ut=Math.pow(2,32)-1,sa=[].push,Rr={video:1,audio:2,id3:3,text:4};function J(s){return String.fromCharCode.apply(null,s)}function br(s,a){var e=s[a]<<8|s[a+1];return e<0?65536+e:e}function N(s,a){var e=Ar(s,a);return e<0?4294967296+e:e}function Ar(s,a){return s[a]<<24|s[a+1]<<16|s[a+2]<<8|s[a+3]}function Ft(s,a,e){s[a]=e>>24,s[a+1]=e>>16&255,s[a+2]=e>>8&255,s[a+3]=255&e}function Y(s,a){var e=[];if(!a.length)return e;for(var t=s.byteLength,r=0;r<t;){var i=N(s,r),n=i>1?r+i:t;if(J(s.subarray(r+4,r+8))===a[0])if(a.length===1)e.push(s.subarray(r+8,n));else{var o=Y(s.subarray(r+8,n),a.slice(1));o.length&&sa.apply(e,o)}r=n}return e}function oa(s){var a=[],e=s[0],t=8,r=N(s,t);t+=4,t+=e===0?8:16,t+=2;var i=s.length+0,n=br(s,t);t+=2;for(var o=0;o<n;o++){var l=t,u=N(s,l);l+=4;var d=2147483647&u;if((2147483648&u)>>>31==1)return L.warn("SIDX has hierarchical references (not supported)"),null;var h=N(s,l);l+=4,a.push({referenceSize:d,subsegmentDuration:h,info:{duration:h/r,start:i,end:i+d-1}}),i+=d,t=l+=4}return{earliestPresentationTime:0,timescale:r,version:e,referencesCount:n,references:a}}function kr(s){for(var a=[],e=Y(s,["moov","trak"]),t=0;t<e.length;t++){var r=e[t],i=Y(r,["tkhd"])[0];if(i){var n=i[0],o=n===0?12:20,l=N(i,o),u=Y(r,["mdia","mdhd"])[0];if(u){var d=N(u,o=(n=u[0])===0?12:20),h=Y(r,["mdia","hdlr"])[0];if(h){var f=J(h.subarray(8,12)),c={soun:me,vide:he}[f];if(c){var g=Y(r,["mdia","minf","stbl","stsd"])[0],m=void 0;g&&(m=J(g.subarray(12,16))),a[l]={timescale:d,type:c},a[c]={timescale:d,id:l,codec:m}}}}}}return Y(s,["moov","mvex","trex"]).forEach(function(y){var v=N(y,4),p=a[v];p&&(p.default={duration:N(y,12),flags:N(y,20)})}),a}function la(s,a){if(!s||!a)return s;var e=a.keyId;return e&&a.isCommonEncryption&&Y(s,["moov","trak"]).forEach(function(t){var r=Y(t,["mdia","minf","stbl","stsd"])[0].subarray(8),i=Y(r,["enca"]),n=i.length>0;n||(i=Y(r,["encv"])),i.forEach(function(o){Y(n?o.subarray(28):o.subarray(78),["sinf"]).forEach(function(l){var u=function(h){var f=Y(h,["schm"])[0];if(f){var c=J(f.subarray(4,8));if(c==="cbcs"||c==="cenc")return Y(h,["schi","tenc"])[0]}return L.error("[eme] missing 'schm' box"),null}(l);if(u){var d=u.subarray(8,24);d.some(function(h){return h!==0})||(L.log("[eme] Patching keyId in 'enc"+(n?"a":"v")+">sinf>>tenc' box: "+Lr(d)+" -> "+Lr(e)),u.set(e,8))}})})}),s}function ua(s){var a=N(s,0),e=8;1&a&&(e+=4),4&a&&(e+=4);for(var t=0,r=N(s,4),i=0;i<r;i++)256&a&&(t+=N(s,e),e+=4),512&a&&(e+=4),1024&a&&(e+=4),2048&a&&(e+=4);return t}function Ue(s,a){var e=new Uint8Array(s.length+a.length);return e.set(s),e.set(a,s.length),e}function Dr(s,a){var e=[],t=a.samples,r=a.timescale,i=a.id,n=!1;return Y(t,["moof"]).map(function(o){var l=o.byteOffset-8;Y(o,["traf"]).map(function(u){var d=Y(u,["tfdt"]).map(function(h){var f=h[0],c=N(h,4);return f===1&&(c*=Math.pow(2,32),c+=N(h,8)),c/r})[0];return d!==void 0&&(s=d),Y(u,["tfhd"]).map(function(h){var f=N(h,4),c=16777215&N(h,0),g=0,m=(16&c)!=0,y=0,v=(32&c)!=0,p=8;f===i&&(1&c&&(p+=8),2&c&&(p+=4),8&c&&(g=N(h,p),p+=4),m&&(y=N(h,p),p+=4),v&&(p+=4),a.type==="video"&&(n=function(S){if(!S)return!1;var T=S.indexOf("."),R=T<0?S:S.substring(0,T);return R==="hvc1"||R==="hev1"||R==="dvh1"||R==="dvhe"}(a.codec)),Y(u,["trun"]).map(function(S){var T=S[0],R=16777215&N(S,0),b=(1&R)!=0,A=0,_=(4&R)!=0,x=(256&R)!=0,D=0,I=(512&R)!=0,w=0,O=(1024&R)!=0,B=(2048&R)!=0,C=0,U=N(S,4),M=8;b&&(A=N(S,M),M+=4),_&&(M+=4);for(var P=A+l,H=0;H<U;H++){if(x?(D=N(S,M),M+=4):D=g,I?(w=N(S,M),M+=4):w=y,O&&(M+=4),B&&(C=T===0?N(S,M):Ar(S,M),M+=4),a.type===he)for(var V=0;V<w;){var G=N(t,P);da(n,t[P+=4])&&_r(t.subarray(P,P+G),n?2:1,s+C/r,e),P+=G,V+=G+4}s+=D/r}}))})})}),e}function da(s,a){if(s){var e=a>>1&63;return e===39||e===40}return(31&a)==6}function _r(s,a,e,t){var r=xr(s),i=0;i+=a;for(var n=0,o=0,l=!1,u=0;i<r.length;){n=0;do{if(i>=r.length)break;n+=u=r[i++]}while(u===255);o=0;do{if(i>=r.length)break;o+=u=r[i++]}while(u===255);var d=r.length-i;if(!l&&n===4&&i<r.length){if(l=!0,r[i++]===181){var h=br(r,i);if(i+=2,h===49){var f=N(r,i);if(i+=4,f===1195456820){var c=r[i++];if(c===3){var g=r[i++],m=64&g,y=m?2+3*(31&g):0,v=new Uint8Array(y);if(m){v[0]=g;for(var p=1;p<y;p++)v[p]=r[i++]}t.push({type:c,payloadType:n,pts:e,bytes:v})}}}}}else if(n===5&&o<d){if(l=!0,o>16){for(var S=[],T=0;T<16;T++){var R=r[i++].toString(16);S.push(R.length==1?"0"+R:R),T!==3&&T!==5&&T!==7&&T!==9||S.push("-")}for(var b=o-16,A=new Uint8Array(b),_=0;_<b;_++)A[_]=r[i++];t.push({payloadType:n,pts:e,uuid:S.join(""),userData:be(A),userDataBytes:A})}}else if(o<d)i+=o;else if(o>d)break}}function xr(s){for(var a=s.byteLength,e=[],t=1;t<a-2;)s[t]===0&&s[t+1]===0&&s[t+2]===3?(e.push(t+2),t+=2):t++;if(e.length===0)return s;var r=a-e.length,i=new Uint8Array(r),n=0;for(t=0;t<r;n++,t++)n===e[0]&&(n++,e.shift()),i[t]=s[n];return i}var ha=function(){function s(e,t,r,i,n){i===void 0&&(i=[1]),n===void 0&&(n=null),this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=r,this.keyFormatVersions=i,this.iv=n,this.encrypted=!!e&&e!=="NONE",this.isCommonEncryption=this.encrypted&&e!=="AES-128"}s.clearKeyUriToKeyIdMap=function(){};var a=s.prototype;return a.isSupported=function(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES"}return!1},a.getDecryptData=function(e){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv){typeof e!="number"&&(this.method!=="AES-128"||this.iv||L.warn('missing IV for initialization segment with method="'+this.method+'" - compliance issue'),e=0);var t=function(r){for(var i=new Uint8Array(16),n=12;n<16;n++)i[n]=r>>8*(15-n)&255;return i}(e);return new s(this.method,this.uri,"identity",this.keyFormatVersions,t)}return this},s}();function dt(){if(typeof self<"u")return self.MediaSource||self.WebKitMediaSource}var fa={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}},wr=dt();function Ot(s,a){var e;return(e=wr?.isTypeSupported((a||"video")+'/mp4;codecs="'+s+'"'))!=null&&e}var Ir=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Cr=/#EXT-X-MEDIA:(.*)/g,ca=/^#EXT(?:INF|-X-TARGETDURATION):/m,Pr=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),va=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),Xe=function(){function s(){}return s.findGroup=function(a,e){for(var t=0;t<a.length;t++){var r=a[t];if(r.id===e)return r}},s.convertAVC1ToAVCOTI=function(a){var e=a.split(".");if(e.length>2){var t=e.shift()+".";return t+=parseInt(e.shift()).toString(16),t+=("000"+parseInt(e.shift()).toString(16)).slice(-4)}return a},s.resolve=function(a,e){return _t.buildAbsoluteURL(e,a,{alwaysNormalize:!0})},s.isMediaPlaylist=function(a){return ca.test(a)},s.parseMasterPlaylist=function(a,e){var t,r={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:!1},i=[];for(Ir.lastIndex=0;(t=Ir.exec(a))!=null;)if(t[1]){var n,o=new Q(t[1]),l=t[2],u={attrs:o,bitrate:o.decimalInteger("AVERAGE-BANDWIDTH")||o.decimalInteger("BANDWIDTH"),name:o.NAME,url:s.resolve(l,e)},d=o.decimalResolution("RESOLUTION");d&&(u.width=d.width,u.height=d.height),ga((o.CODECS||"").split(/[ ,]+/).filter(function(p){return p}),u),u.videoCodec&&u.videoCodec.indexOf("avc1")!==-1&&(u.videoCodec=s.convertAVC1ToAVCOTI(u.videoCodec)),(n=u.unknownCodecs)!=null&&n.length||i.push(u),r.levels.push(u)}else if(t[3]){var h=t[3],f=t[4];switch(h){case"SESSION-DATA":var c=new Q(f),g=c["DATA-ID"];g&&(r.sessionData===null&&(r.sessionData={}),r.sessionData[g]=c);break;case"SESSION-KEY":var m=Fr(f,e);m.encrypted&&m.isSupported()?(r.sessionKeys===null&&(r.sessionKeys=[]),r.sessionKeys.push(m)):L.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'+f+'"');break;case"DEFINE":break;case"CONTENT-STEERING":var y=new Q(f);r.contentSteering={uri:s.resolve(y["SERVER-URI"],e),pathwayId:y["PATHWAY-ID"]||"."};break;case"START":r.startTimeOffset=Or(f)}}var v=i.length>0&&i.length<r.levels.length;return r.levels=v?i:r.levels,r.levels.length===0&&(r.playlistParsingError=new Error("no levels found in manifest")),r},s.parseMasterPlaylistMedia=function(a,e,t){var r,i={},n=t.levels,o={AUDIO:n.map(function(m){return{id:m.attrs.AUDIO,audioCodec:m.audioCodec}}),SUBTITLES:n.map(function(m){return{id:m.attrs.SUBTITLES,textCodec:m.textCodec}}),"CLOSED-CAPTIONS":[]},l=0;for(Cr.lastIndex=0;(r=Cr.exec(a))!==null;){var u=new Q(r[1]),d=u.TYPE;if(d){var h=o[d],f=i[d]||[];i[d]=f;var c={attrs:u,bitrate:0,id:l++,groupId:u["GROUP-ID"]||"",instreamId:u["INSTREAM-ID"],name:u.NAME||u.LANGUAGE||"",type:d,default:u.bool("DEFAULT"),autoselect:u.bool("AUTOSELECT"),forced:u.bool("FORCED"),lang:u.LANGUAGE,url:u.URI?s.resolve(u.URI,e):""};if(h!=null&&h.length){var g=s.findGroup(h,c.groupId)||h[0];Mr(c,g,"audioCodec"),Mr(c,g,"textCodec")}f.push(c)}}return i},s.parseLevelPlaylist=function(a,e,t,r,i,n){var o,l,u,d=new Qi(e),h=d.fragments,f=null,c=0,g=0,m=0,y=0,v=null,p=new It(r,e),S=-1,T=!1;for(Pr.lastIndex=0,d.m3u8=a,d.hasVariableRefs=!1;(o=Pr.exec(a))!==null;){T&&(T=!1,(p=new It(r,e)).start=m,p.sn=c,p.cc=y,p.level=t,f&&(p.initSegment=f,p.rawProgramDateTime=f.rawProgramDateTime,f.rawProgramDateTime=null));var R=o[1];if(R){p.duration=parseFloat(R);var b=(" "+o[2]).slice(1);p.title=b||null,p.tagList.push(b?["INF",R,b]:["INF",R])}else if(o[3]){if(F(p.duration)){p.start=m,u&&Ur(p,u,d),p.sn=c,p.level=t,p.cc=y,p.urlId=i,h.push(p);var A=(" "+o[3]).slice(1);p.relurl=A,Nr(p,v),v=p,m+=p.duration,c++,g=0,T=!0}}else if(o[4]){var _=(" "+o[4]).slice(1);v?p.setByteRange(_,v):p.setByteRange(_)}else if(o[5])p.rawProgramDateTime=(" "+o[5]).slice(1),p.tagList.push(["PROGRAM-DATE-TIME",p.rawProgramDateTime]),S===-1&&(S=h.length);else{if(!(o=o[0].match(va))){L.warn("No matches on slow regex match for level playlist!");continue}for(l=1;l<o.length&&o[l]===void 0;l++);var x=(" "+o[l]).slice(1),D=(" "+o[l+1]).slice(1),I=o[l+2]?(" "+o[l+2]).slice(1):"";switch(x){case"PLAYLIST-TYPE":d.type=D.toUpperCase();break;case"MEDIA-SEQUENCE":c=d.startSN=parseInt(D);break;case"SKIP":var w=new Q(D),O=w.decimalInteger("SKIPPED-SEGMENTS");if(F(O)){d.skippedSegments=O;for(var B=O;B--;)h.unshift(null);c+=O}var C=w.enumeratedString("RECENTLY-REMOVED-DATERANGES");C&&(d.recentlyRemovedDateranges=C.split("	"));break;case"TARGETDURATION":d.targetduration=Math.max(parseInt(D),1);break;case"VERSION":d.version=parseInt(D);break;case"EXTM3U":case"DEFINE":break;case"ENDLIST":d.live=!1;break;case"#":(D||I)&&p.tagList.push(I?[D,I]:[D]);break;case"DISCONTINUITY":y++,p.tagList.push(["DIS"]);break;case"GAP":p.gap=!0,p.tagList.push([x]);break;case"BITRATE":p.tagList.push([x,D]);break;case"DATERANGE":var U=new Q(D),M=new pr(U,d.dateRanges[U.ID]);M.isValid||d.skippedSegments?d.dateRanges[M.id]=M:L.warn('Ignoring invalid DATERANGE tag: "'+D+'"'),p.tagList.push(["EXT-X-DATERANGE",D]);break;case"DISCONTINUITY-SEQUENCE":y=parseInt(D);break;case"KEY":var P=Fr(D,e);if(P.isSupported()){if(P.method==="NONE"){u=void 0;break}u||(u={}),u[P.keyFormat]&&(u=oe({},u)),u[P.keyFormat]=P}else L.warn('[Keys] Ignoring invalid EXT-X-KEY tag: "'+D+'"');break;case"START":d.startTimeOffset=Or(D);break;case"MAP":var H=new Q(D);if(p.duration){var V=new It(r,e);Br(V,H,t,u),f=V,p.initSegment=f,f.rawProgramDateTime&&!p.rawProgramDateTime&&(p.rawProgramDateTime=f.rawProgramDateTime)}else Br(p,H,t,u),f=p,T=!0;break;case"SERVER-CONTROL":var G=new Q(D);d.canBlockReload=G.bool("CAN-BLOCK-RELOAD"),d.canSkipUntil=G.optionalFloat("CAN-SKIP-UNTIL",0),d.canSkipDateRanges=d.canSkipUntil>0&&G.bool("CAN-SKIP-DATERANGES"),d.partHoldBack=G.optionalFloat("PART-HOLD-BACK",0),d.holdBack=G.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var q=new Q(D);d.partTarget=q.decimalFloatingPoint("PART-TARGET");break;case"PART":var te=d.partList;te||(te=d.partList=[]);var re=g>0?te[te.length-1]:void 0,ce=g++,le=new Q(D),ue=new zi(le,p,e,ce,re);te.push(ue),p.duration+=ue.duration;break;case"PRELOAD-HINT":var z=new Q(D);d.preloadHint=z;break;case"RENDITION-REPORT":var ee=new Q(D);d.renditionReports=d.renditionReports||[],d.renditionReports.push(ee);break;default:L.warn("line parsed but not handled: "+o)}}}v&&!v.relurl?(h.pop(),m-=v.duration,d.partList&&(d.fragmentHint=v)):d.partList&&(Nr(p,v),p.cc=y,d.fragmentHint=p,u&&Ur(p,u,d));var ve=h.length,Me=h[0],ne=h[ve-1];if((m+=d.skippedSegments*d.targetduration)>0&&ve&&ne){d.averagetargetduration=m/ve;var Lt=ne.sn;d.endSN=Lt!=="initSegment"?Lt:0,d.live||(ne.endList=!0),Me&&(d.startCC=Me.cc)}else d.endSN=0,d.startCC=0;return d.fragmentHint&&(m+=d.fragmentHint.duration),d.totalduration=m,d.endCC=y,S>0&&function(at,Rt){for(var We=at[Rt],Ne=Rt;Ne--;){var Be=at[Ne];if(!Be)return;Be.programDateTime=We.programDateTime-1e3*Be.duration,We=Be}}(h,S),d},s}();function Fr(s,a,e){var t,r,i=new Q(s),n=(t=i.METHOD)!=null?t:"",o=i.URI,l=i.hexadecimalInteger("IV"),u=i.KEYFORMATVERSIONS,d=(r=i.KEYFORMAT)!=null?r:"identity";o&&i.IV&&!l&&L.error("Invalid IV: "+i.IV);var h=o?Xe.resolve(o,a):"",f=(u||"1").split("/").map(Number).filter(Number.isFinite);return new ha(n,h,d,f,l)}function Or(s){var a=new Q(s).decimalFloatingPoint("TIME-OFFSET");return F(a)?a:null}function ga(s,a){["video","audio","text"].forEach(function(e){var t=s.filter(function(i){return function(n,o){var l=fa[o];return!!l&&l[n.slice(0,4)]===!0}(i,e)});if(t.length){var r=t.filter(function(i){return i.lastIndexOf("avc1",0)===0||i.lastIndexOf("mp4a",0)===0});a[e+"Codec"]=r.length>0?r[0]:t[0],s=s.filter(function(i){return t.indexOf(i)===-1})}}),a.unknownCodecs=s}function Mr(s,a,e){var t=a[e];t&&(s[e]=t)}function Nr(s,a){s.rawProgramDateTime?s.programDateTime=Date.parse(s.rawProgramDateTime):a!=null&&a.programDateTime&&(s.programDateTime=a.endProgramDateTime),F(s.programDateTime)||(s.programDateTime=null,s.rawProgramDateTime=null)}function Br(s,a,e,t){s.relurl=a.URI,a.BYTERANGE&&s.setByteRange(a.BYTERANGE),s.level=e,s.sn="initSegment",t&&(s.levelkeys=t),s.initSegment=null}function Ur(s,a,e){s.levelkeys=a;var t=e.encryptedFragments;t.length&&t[t.length-1].levelkeys===a||!Object.keys(a).some(function(r){return a[r].isCommonEncryption})||t.push(s)}var Ge="manifest",Ce="level",Ae="audioTrack",ke="subtitleTrack",W="main",ht="audio",Gr="subtitle";function Hr(s){switch(s.type){case Ae:return ht;case ke:return Gr;default:return W}}function Mt(s,a){var e=s.url;return e!==void 0&&e.indexOf("data:")!==0||(e=a.url),e}var ma=function(){function s(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=e,this.registerListeners()}var a=s.prototype;return a.startLoad=function(e){},a.stopLoad=function(){this.destroyInternalLoaders()},a.registerListeners=function(){var e=this.hls;e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.LEVEL_LOADING,this.onLevelLoading,this),e.on(E.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(E.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},a.unregisterListeners=function(){var e=this.hls;e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.LEVEL_LOADING,this.onLevelLoading,this),e.off(E.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(E.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},a.createInternalLoader=function(e){var t=this.hls.config,r=t.pLoader,i=t.loader,n=new(r||i)(t);return this.loaders[e.type]=n,n},a.getInternalLoader=function(e){return this.loaders[e.type]},a.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},a.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},a.destroy=function(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()},a.onManifestLoading=function(e,t){var r=t.url;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Ge,url:r,deliveryDirectives:null})},a.onLevelLoading=function(e,t){var r=t.id,i=t.level,n=t.url,o=t.deliveryDirectives;this.load({id:r,level:i,responseType:"text",type:Ce,url:n,deliveryDirectives:o})},a.onAudioTrackLoading=function(e,t){var r=t.id,i=t.groupId,n=t.url,o=t.deliveryDirectives;this.load({id:r,groupId:i,level:null,responseType:"text",type:Ae,url:n,deliveryDirectives:o})},a.onSubtitleTrackLoading=function(e,t){var r=t.id,i=t.groupId,n=t.url,o=t.deliveryDirectives;this.load({id:r,groupId:i,level:null,responseType:"text",type:ke,url:n,deliveryDirectives:o})},a.load=function(e){var t,r,i,n=this,o=this.hls.config,l=this.getInternalLoader(e);if(l){var u=l.context;if(u&&u.url===e.url)return void L.trace("[playlist-loader]: playlist request ongoing");L.log("[playlist-loader]: aborting previous loader for type: "+e.type),l.abort()}if(r=e.type===Ge?o.manifestLoadPolicy.default:oe({},o.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),l=this.createInternalLoader(e),(t=e.deliveryDirectives)!=null&&t.part&&(e.type===Ce&&e.level!==null?i=this.hls.levels[e.level].details:e.type===Ae&&e.id!==null?i=this.hls.audioTracks[e.id].details:e.type===ke&&e.id!==null&&(i=this.hls.subtitleTracks[e.id].details),i)){var d=i.partTarget,h=i.targetduration;if(d&&h){var f=1e3*Math.max(3*d,.8*h);r=oe({},r,{maxTimeToFirstByteMs:Math.min(f,r.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(f,r.maxTimeToFirstByteMs)})}}var c=r.errorRetry||r.timeoutRetry||{},g={loadPolicy:r,timeout:r.maxLoadTimeMs,maxRetry:c.maxNumRetry||0,retryDelay:c.retryDelayMs||0,maxRetryDelay:c.maxRetryDelayMs||0},m={onSuccess:function(y,v,p,S){var T=n.getInternalLoader(p);n.resetInternalLoader(p.type);var R=y.data;R.indexOf("#EXTM3U")===0?(v.parsing.start=performance.now(),Xe.isMediaPlaylist(R)?n.handleTrackOrLevelPlaylist(y,v,p,S||null,T):n.handleMasterPlaylist(y,v,p,S)):n.handleManifestParsingError(y,p,new Error("no EXTM3U delimiter"),S||null,v)},onError:function(y,v,p,S){n.handleNetworkError(v,p,!1,y,S)},onTimeout:function(y,v,p){n.handleNetworkError(v,p,!0,void 0,y)}};l.load(e,g,m)},a.handleMasterPlaylist=function(e,t,r,i){var n=this.hls,o=e.data,l=Mt(e,r),u=Xe.parseMasterPlaylist(o,l);if(u.playlistParsingError)this.handleManifestParsingError(e,r,u.playlistParsingError,i,t);else{var d=u.contentSteering,h=u.levels,f=u.sessionData,c=u.sessionKeys,g=u.startTimeOffset,m=u.variableList;this.variableList=m;var y=Xe.parseMasterPlaylistMedia(o,l,u),v=y.AUDIO,p=v===void 0?[]:v,S=y.SUBTITLES,T=y["CLOSED-CAPTIONS"];p.length&&(p.some(function(R){return!R.url})||!h[0].audioCodec||h[0].attrs.AUDIO||(L.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),p.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Q({}),bitrate:0,url:""}))),n.trigger(E.MANIFEST_LOADED,{levels:h,audioTracks:p,subtitles:S,captions:T,contentSteering:d,url:l,stats:t,networkDetails:i,sessionData:f,sessionKeys:c,startTimeOffset:g,variableList:m})}},a.handleTrackOrLevelPlaylist=function(e,t,r,i,n){var o=this.hls,l=r.id,u=r.level,d=r.type,h=Mt(e,r),f=F(l)?l:0,c=F(u)?u:f,g=Hr(r),m=Xe.parseLevelPlaylist(e.data,h,c,g,f,this.variableList);if(d===Ge){var y={attrs:new Q({}),bitrate:0,details:m,name:"",url:h};o.trigger(E.MANIFEST_LOADED,{levels:[y],audioTracks:[],url:h,stats:t,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),r.levelDetails=m,this.handlePlaylistLoaded(m,e,t,r,i,n)},a.handleManifestParsingError=function(e,t,r,i,n){this.hls.trigger(E.ERROR,{type:K.NETWORK_ERROR,details:k.MANIFEST_PARSING_ERROR,fatal:t.type===Ge,url:e.url,err:r,error:r,reason:r.message,response:e,context:t,networkDetails:i,stats:n})},a.handleNetworkError=function(e,t,r,i,n){r===void 0&&(r=!1);var o="A network "+(r?"timeout":"error"+(i?" (status "+i.code+")":""))+" occurred while loading "+e.type;e.type===Ce?o+=": "+e.level+" id: "+e.id:e.type!==Ae&&e.type!==ke||(o+=" id: "+e.id+' group-id: "'+e.groupId+'"');var l=new Error(o);L.warn("[playlist-loader]: "+o);var u=k.UNKNOWN,d=!1,h=this.getInternalLoader(e);switch(e.type){case Ge:u=r?k.MANIFEST_LOAD_TIMEOUT:k.MANIFEST_LOAD_ERROR,d=!0;break;case Ce:u=r?k.LEVEL_LOAD_TIMEOUT:k.LEVEL_LOAD_ERROR,d=!1;break;case Ae:u=r?k.AUDIO_TRACK_LOAD_TIMEOUT:k.AUDIO_TRACK_LOAD_ERROR,d=!1;break;case ke:u=r?k.SUBTITLE_TRACK_LOAD_TIMEOUT:k.SUBTITLE_LOAD_ERROR,d=!1}h&&this.resetInternalLoader(e.type);var f={type:K.NETWORK_ERROR,details:u,fatal:d,url:e.url,loader:h,context:e,error:l,networkDetails:t,stats:n};if(i){var c=t?.url||e.url;f.response=de({url:c,data:void 0},i)}this.hls.trigger(E.ERROR,f)},a.handlePlaylistLoaded=function(e,t,r,i,n,o){var l=this.hls,u=i.type,d=i.level,h=i.id,f=i.groupId,c=i.deliveryDirectives,g=Mt(t,i),m=Hr(i),y=typeof i.level=="number"&&m===W?d:void 0;if(e.fragments.length){e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));var v=e.playlistParsingError;if(v)l.trigger(E.ERROR,{type:K.NETWORK_ERROR,details:k.LEVEL_PARSING_ERROR,fatal:!1,url:g,error:v,reason:v.message,response:t,context:i,level:y,parent:m,networkDetails:n,stats:r});else switch(e.live&&o&&(o.getCacheAge&&(e.ageHeader=o.getCacheAge()||0),o.getCacheAge&&!isNaN(e.ageHeader)||(e.ageHeader=0)),u){case Ge:case Ce:l.trigger(E.LEVEL_LOADED,{details:e,level:y||0,id:h||0,stats:r,networkDetails:n,deliveryDirectives:c});break;case Ae:l.trigger(E.AUDIO_TRACK_LOADED,{details:e,id:h||0,groupId:f||"",stats:r,networkDetails:n,deliveryDirectives:c});break;case ke:l.trigger(E.SUBTITLE_TRACK_LOADED,{details:e,id:h||0,groupId:f||"",stats:r,networkDetails:n,deliveryDirectives:c})}}else{var p=new Error("No Segments found in Playlist");l.trigger(E.ERROR,{type:K.NETWORK_ERROR,details:k.LEVEL_EMPTY_ERROR,fatal:!1,url:g,error:p,reason:p.message,response:t,context:i,level:y,parent:m,networkDetails:n,stats:r})}},s}();function pa(s,a){var e;try{e=new Event("addtrack")}catch{(e=document.createEvent("Event")).initEvent("addtrack",!1,!1)}e.track=s,a.dispatchEvent(e)}function ya(s,a,e,t){var r=s.mode;if(r==="disabled"&&(s.mode="hidden"),s.cues&&s.cues.length>0)for(var i=function(o,l,u){var d=[],h=function(m,y){if(y<m[0].startTime)return 0;var v=m.length-1;if(y>m[v].endTime)return-1;for(var p=0,S=v;p<=S;){var T=Math.floor((S+p)/2);if(y<m[T].startTime)S=T-1;else{if(!(y>m[T].startTime&&p<v))return T;p=T+1}}return m[p].startTime-y<y-m[S].startTime?p:S}(o,l);if(h>-1)for(var f=h,c=o.length;f<c;f++){var g=o[f];if(g.startTime>=l&&g.endTime<=u)d.push(g);else if(g.startTime>u)return d}return d}(s.cues,a,e),n=0;n<i.length;n++)t&&!t(i[n])||s.removeCue(i[n]);r==="disabled"&&(s.mode=r)}var ze="org.id3",Ea="com.apple.quicktime.HLS",Qe="https://aomedia.org/emsg/ID3";function Nt(){if(typeof self<"u")return self.VTTCue||self.TextTrackCue}function Kr(s,a,e,t,r){var i=new s(a,e,"");try{i.value=t,r&&(i.type=r)}catch{i=new s(a,e,JSON.stringify(r?de({type:r},t):t))}return i}var ft=function(){var s=Nt();try{s&&new s(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function Bt(s,a){return s.getTime()/1e3-a}var Ta=function(){function s(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}var a=s.prototype;return a.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},a._registerListeners=function(){var e=this.hls;e.on(E.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(E.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(E.LEVEL_UPDATED,this.onLevelUpdated,this)},a._unregisterListeners=function(){var e=this.hls;e.off(E.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(E.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(E.LEVEL_UPDATED,this.onLevelUpdated,this)},a.onMediaAttached=function(e,t){this.media=t.media},a.onMediaDetaching=function(){this.id3Track&&(function(e){var t=e.mode;if(t==="disabled"&&(e.mode="hidden"),e.cues)for(var r=e.cues.length;r--;)e.removeCue(e.cues[r]);t==="disabled"&&(e.mode=t)}(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},a.onManifestLoading=function(){this.dateRangeCuesAppended={}},a.createTrack=function(e){var t=this.getID3Track(e.textTracks);return t.mode="hidden",t},a.getID3Track=function(e){if(this.media){for(var t=0;t<e.length;t++){var r=e[t];if(r.kind==="metadata"&&r.label==="id3")return pa(r,this.media),r}return this.media.addTextTrack("metadata","id3")}},a.onFragParsingMetadata=function(e,t){if(this.media){var r=this.hls.config,i=r.enableEmsgMetadataCues,n=r.enableID3MetadataCues;if(i||n){var o=t.samples;this.id3Track||(this.id3Track=this.createTrack(this.media));var l=Nt();if(l)for(var u=0;u<o.length;u++){var d=o[u].type;if((d!==Qe||i)&&n){var h=Sr(o[u].data);if(h){var f=o[u].pts,c=f+o[u].duration;c>ft&&(c=ft),c-f<=0&&(c=f+.25);for(var g=0;g<h.length;g++){var m=h[g];if(!Tr(m)){this.updateId3CueEnds(f,d);var y=Kr(l,f,c,m,d);y&&this.id3Track.addCue(y)}}}}}}}},a.updateId3CueEnds=function(e,t){var r,i=(r=this.id3Track)==null?void 0:r.cues;if(i)for(var n=i.length;n--;){var o=i[n];o.type===t&&o.startTime<e&&o.endTime===ft&&(o.endTime=e)}},a.onBufferFlushing=function(e,t){var r=t.startOffset,i=t.endOffset,n=t.type,o=this.id3Track,l=this.hls;if(l){var u=l.config,d=u.enableEmsgMetadataCues,h=u.enableID3MetadataCues;o&&(d||h)&&ya(o,r,i,n==="audio"?function(f){return f.type===ze&&h}:n==="video"?function(f){return f.type===Qe&&d}:function(f){return f.type===ze&&h||f.type===Qe&&d})}},a.onLevelUpdated=function(e,t){var r=this,i=t.details;if(this.media&&i.hasProgramDateTime&&this.hls.config.enableDateRangeMetadataCues){var n=this.dateRangeCuesAppended,o=this.id3Track,l=i.dateRanges,u=Object.keys(l);if(o)for(var d=Object.keys(n).filter(function(p){return!u.includes(p)}),h=function(){var p=d[f];Object.keys(n[p].cues).forEach(function(S){o.removeCue(n[p].cues[S])}),delete n[p]},f=d.length;f--;)h();var c=i.fragments[i.fragments.length-1];if(u.length!==0&&F(c?.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var g=c.programDateTime/1e3-c.start,m=Nt(),y=function(){var p=u[v],S=l[p],T=n[p],R=T?.cues||{},b=T?.durationKnown||!1,A=Bt(S.startDate,g),_=ft,x=S.endDate;if(x)_=Bt(x,g),b=!0;else if(S.endOnNext&&!b){var D=u.reduce(function(H,V){var G=l[V];return G.class===S.class&&G.id!==V&&G.startDate>S.startDate&&H.push(G),H},[]).sort(function(H,V){return H.startDate.getTime()-V.startDate.getTime()})[0];D&&(_=Bt(D.startDate,g),b=!0)}for(var I,w,O=Object.keys(S.attr),B=0;B<O.length;B++){var C=O[B];if((w=C)!=="ID"&&w!=="CLASS"&&w!=="START-DATE"&&w!=="DURATION"&&w!=="END-DATE"&&w!=="END-ON-NEXT"){var U=R[C];if(U)b&&!T.durationKnown&&(U.endTime=_);else if(m){var M=S.attr[C];Xi(C)&&(I=M,M=Uint8Array.from(I.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer);var P=Kr(m,A,_,{key:C,data:M},Ea);P&&(P.id=p,r.id3Track.addCue(P),R[C]=P)}}}n[p]={cues:R,dateRange:S,durationKnown:b}},v=0;v<u.length;v++)y()}}},s}(),Sa=function(){function s(e){var t=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return t.timeupdate()},this.hls=e,this.config=e.config,this.registerListeners()}var a=s.prototype;return a.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},a.registerListeners=function(){this.hls.on(E.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(E.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(E.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(E.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(E.ERROR,this.onError,this)},a.unregisterListeners=function(){this.hls.off(E.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(E.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(E.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(E.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(E.ERROR,this.onError,this)},a.onMediaAttached=function(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},a.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},a.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},a.onLevelUpdated=function(e,t){var r=t.details;this.levelDetails=r,r.advanced&&this.timeupdate(),!r.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},a.onError=function(e,t){var r;t.details===k.BUFFER_STALLED_ERROR&&(this.stallCount++,(r=this.levelDetails)!=null&&r.live&&L.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},a.timeupdate=function(){var e=this.media,t=this.levelDetails;if(e&&t){this.currentTime=e.currentTime;var r=this.computeLatency();if(r!==null){this._latency=r;var i=this.config,n=i.lowLatencyMode,o=i.maxLiveSyncPlaybackRate;if(n&&o!==1){var l=this.targetLatency;if(l!==null){var u=r-l,d=u<Math.min(this.maxLatency,l+t.targetduration);if(t.live&&d&&u>.05&&this.forwardBufferLength>1){var h=Math.min(2,Math.max(1,o)),f=Math.round(2/(1+Math.exp(-.75*u-this.edgeStalled))*20)/20;e.playbackRate=Math.min(h,Math.max(1,f))}else e.playbackRate!==1&&e.playbackRate!==0&&(e.playbackRate=1)}}}}},a.estimateLiveEdge=function(){var e=this.levelDetails;return e===null?null:e.edge+e.age},a.computeLatency=function(){var e=this.estimateLiveEdge();return e===null?null:e-this.currentTime},se(s,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var e=this.config,t=this.levelDetails;return e.liveMaxLatencyDuration!==void 0?e.liveMaxLatencyDuration:t?e.liveMaxLatencyDurationCount*t.targetduration:0}},{key:"targetLatency",get:function(){var e=this.levelDetails;if(e===null)return null;var t=e.holdBack,r=e.partHoldBack,i=e.targetduration,n=this.config,o=n.liveSyncDuration,l=n.liveSyncDurationCount,u=n.lowLatencyMode,d=this.hls.userConfig,h=u&&r||t;(d.liveSyncDuration||d.liveSyncDurationCount||h===0)&&(h=o!==void 0?o:l*i);var f=i;return h+Math.min(1*this.stallCount,f)}},{key:"liveSyncPosition",get:function(){var e=this.estimateLiveEdge(),t=this.targetLatency,r=this.levelDetails;if(e===null||t===null||r===null)return null;var i=r.edge,n=e-t-this.edgeStalled,o=i-r.totalduration,l=i-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(o,n),l)}},{key:"drift",get:function(){var e=this.levelDetails;return e===null?1:e.drift}},{key:"edgeStalled",get:function(){var e=this.levelDetails;if(e===null)return 0;var t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration);return Math.max(e.age-t,0)}},{key:"forwardBufferLength",get:function(){var e=this.media,t=this.levelDetails;if(!e||!t)return 0;var r=e.buffered.length;return(r?e.buffered.end(r-1):t.edge)-this.currentTime}}]),s}(),Ut=["NONE","TYPE-0","TYPE-1",null],Gt="",La="YES",Ra="v2",Vr=function(){function s(a,e,t){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=a,this.part=e,this.skip=t}return s.prototype.addDirectives=function(a){var e=new self.URL(a);return this.msn!==void 0&&e.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&e.searchParams.set("_HLS_part",this.part.toString()),this.skip&&e.searchParams.set("_HLS_skip",this.skip),e.href},s}(),ba=function(){function s(a){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[a.url],this._attrs=[a.attrs],this.bitrate=a.bitrate,a.details&&(this.details=a.details),this.id=a.id||0,this.name=a.name,this.width=a.width||0,this.height=a.height||0,this.audioCodec=a.audioCodec,this.videoCodec=a.videoCodec,this.unknownCodecs=a.unknownCodecs,this.codecSet=[a.videoCodec,a.audioCodec].filter(function(e){return e}).join(",").replace(/\.[^.,]+/g,"")}return s.prototype.addFallback=function(a){this.url.push(a.url),this._attrs.push(a.attrs)},se(s,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"attrs",get:function(){return this._attrs[this._urlId]}},{key:"pathwayId",get:function(){return this.attrs["PATHWAY-ID"]||"."}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(a){var e=a%this.url.length;this._urlId!==e&&(this.fragmentError=0,this.loadError=0,this.details=void 0,this._urlId=e)}},{key:"audioGroupId",get:function(){var a;return(a=this.audioGroupIds)==null?void 0:a[this.urlId]}},{key:"textGroupId",get:function(){var a;return(a=this.textGroupIds)==null?void 0:a[this.urlId]}}]),s}();function Ht(s,a){var e=a.startPTS;if(F(e)){var t,r=0;a.sn>s.sn?(r=e-s.start,t=s):(r=s.start-e,t=a),t.duration!==r&&(t.duration=r)}else a.sn>s.sn?s.cc===a.cc&&s.minEndPTS?a.start=s.start+(s.minEndPTS-s.start):a.start=s.start+s.duration:a.start=Math.max(s.start-a.duration,0)}function Yr(s,a,e,t,r,i){t-e<=0&&(L.warn("Fragment should have a positive duration",a),t=e+a.duration,i=r+a.duration);var n=e,o=t,l=a.startPTS,u=a.endPTS;if(F(l)){var d=Math.abs(l-e);F(a.deltaPTS)?a.deltaPTS=Math.max(d,a.deltaPTS):a.deltaPTS=d,n=Math.max(e,l),e=Math.min(e,l),r=Math.min(r,a.startDTS),o=Math.min(t,u),t=Math.max(t,u),i=Math.max(i,a.endDTS)}var h=e-a.start;a.start!==0&&(a.start=e),a.duration=t-a.start,a.startPTS=e,a.maxStartPTS=n,a.startDTS=r,a.endPTS=t,a.minEndPTS=o,a.endDTS=i;var f,c=a.sn;if(!s||c<s.startSN||c>s.endSN)return 0;var g=c-s.startSN,m=s.fragments;for(m[g]=a,f=g;f>0;f--)Ht(m[f],m[f-1]);for(f=g;f<m.length-1;f++)Ht(m[f],m[f+1]);return s.fragmentHint&&Ht(m[m.length-1],s.fragmentHint),s.PTSKnown=s.alignedSliding=!0,h}function Aa(s,a){for(var e=null,t=s.fragments,r=t.length-1;r>=0;r--){var i=t[r].initSegment;if(i){e=i;break}}s.fragmentHint&&delete s.fragmentHint.endPTS;var n,o,l,u,d,h=0;if(function(v,p,S){for(var T=p.skippedSegments,R=Math.max(v.startSN,p.startSN)-p.startSN,b=(v.fragmentHint?1:0)+(T?p.endSN:Math.min(v.endSN,p.endSN))-p.startSN,A=p.startSN-v.startSN,_=p.fragmentHint?p.fragments.concat(p.fragmentHint):p.fragments,x=v.fragmentHint?v.fragments.concat(v.fragmentHint):v.fragments,D=R;D<=b;D++){var I=x[A+D],w=_[D];T&&!w&&D<T&&(w=p.fragments[D]=I),I&&w&&S(I,w)}}(s,a,function(v,p){v.relurl&&(h=v.cc-p.cc),F(v.startPTS)&&F(v.endPTS)&&(p.start=p.startPTS=v.startPTS,p.startDTS=v.startDTS,p.maxStartPTS=v.maxStartPTS,p.endPTS=v.endPTS,p.endDTS=v.endDTS,p.minEndPTS=v.minEndPTS,p.duration=v.endPTS-v.startPTS,p.duration&&(n=p),a.PTSKnown=a.alignedSliding=!0),p.elementaryStreams=v.elementaryStreams,p.loader=v.loader,p.stats=v.stats,p.urlId=v.urlId,v.initSegment&&(p.initSegment=v.initSegment,e=v.initSegment)}),e&&(a.fragmentHint?a.fragments.concat(a.fragmentHint):a.fragments).forEach(function(v){var p;v.initSegment&&v.initSegment.relurl!==((p=e)==null?void 0:p.relurl)||(v.initSegment=e)}),a.skippedSegments)if(a.deltaUpdateFailed=a.fragments.some(function(v){return!v}),a.deltaUpdateFailed){L.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var f=a.skippedSegments;f--;)a.fragments.shift();a.startSN=a.fragments[0].sn,a.startCC=a.fragments[0].cc}else a.canSkipDateRanges&&(a.dateRanges=(o=s.dateRanges,l=a.dateRanges,u=a.recentlyRemovedDateranges,d=oe({},o),u&&u.forEach(function(v){delete d[v]}),Object.keys(l).forEach(function(v){var p=new pr(l[v].attr,d[v]);p.isValid?d[v]=p:L.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(l[v].attr)+'"')}),d));var c=a.fragments;if(h){L.warn("discontinuity sliding from playlist, take drift into account");for(var g=0;g<c.length;g++)c[g].cc+=h}a.skippedSegments&&(a.startCC=a.fragments[0].cc),function(v,p,S){if(v&&p)for(var T=0,R=0,b=v.length;R<=b;R++){var A=v[R],_=p[R+T];A&&_&&A.index===_.index&&A.fragment.sn===_.fragment.sn?S(A,_):T--}}(s.partList,a.partList,function(v,p){p.elementaryStreams=v.elementaryStreams,p.stats=v.stats}),n?Yr(a,n,n.startPTS,n.endPTS,n.startDTS,n.endDTS):Wr(s,a),c.length&&(a.totalduration=a.edge-c[0].start),a.driftStartTime=s.driftStartTime,a.driftStart=s.driftStart;var m=a.advancedDateTime;if(a.advanced&&m){var y=a.edge;a.driftStart||(a.driftStartTime=m,a.driftStart=y),a.driftEndTime=m,a.driftEnd=y}else a.driftEndTime=s.driftEndTime,a.driftEnd=s.driftEnd,a.advancedDateTime=s.advancedDateTime}function Wr(s,a){var e=a.startSN+a.skippedSegments-s.startSN,t=s.fragments;e<0||e>=t.length||function(r,i){if(i){for(var n=r.fragments,o=r.skippedSegments;o<n.length;o++)n[o].start+=i;r.fragmentHint&&(r.fragmentHint.start+=i)}}(a,t[e].start)}function jr(s,a,e){var t;return s!=null&&s.details?qr((t=s.details)==null?void 0:t.partList,a,e):null}function qr(s,a,e){if(s)for(var t=s.length;t--;){var r=s[t];if(r.index===e&&r.fragment.sn===a)return r}return null}function ct(s){switch(s.details){case k.FRAG_LOAD_TIMEOUT:case k.KEY_LOAD_TIMEOUT:case k.LEVEL_LOAD_TIMEOUT:case k.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Xr(s,a){var e=ct(a);return s.default[(e?"timeout":"error")+"Retry"]}function Kt(s,a){var e=s.backoff==="linear"?1:Math.pow(2,a);return Math.min(e*s.retryDelayMs,s.maxRetryDelayMs)}function zr(s){return de(de({},s),{errorRetry:null,timeoutRetry:null})}function vt(s,a,e,t){return!!s&&a<s.maxNumRetry&&(function(r){return r===0&&navigator.onLine===!1||!!r&&(r<400||r>499)}(t)||!!e)}var Qr=function(s,a){for(var e=0,t=s.length-1,r=null,i=null;e<=t;){var n=a(i=s[r=(e+t)/2|0]);if(n>0)e=r+1;else{if(!(n<0))return i;t=r-1}}return null};function Vt(s,a,e,t){e===void 0&&(e=0),t===void 0&&(t=0);var r=null;if(s?r=a[s.sn-a[0].sn+1]||null:e===0&&a[0].start===0&&(r=a[0]),r&&Zr(e,t,r)===0)return r;var i=Qr(a,Zr.bind(null,e,t));return!i||i===s&&r?r:i}function Zr(s,a,e){if(s===void 0&&(s=0),a===void 0&&(a=0),e.start<=s&&e.start+e.duration>s)return 0;var t=Math.min(a,e.duration+(e.deltaPTS?e.deltaPTS:0));return e.start+e.duration-t<=s?1:e.start-t>s&&e.start?-1:0}function ka(s,a,e){var t=1e3*Math.min(a,e.duration+(e.deltaPTS?e.deltaPTS:0));return(e.endProgramDateTime||0)-t>s}var Yt,Da=3e5,Wt=0,De=2,gt=5,He=0,jt=1,$r=2,_a=function(){function s(e){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=e,this.log=L.log.bind(L,"[info]:"),this.warn=L.warn.bind(L,"[warning]:"),this.error=L.error.bind(L,"[error]:"),this.registerListeners()}var a=s.prototype;return a.registerListeners=function(){var e=this.hls;e.on(E.ERROR,this.onError,this),e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.LEVEL_UPDATED,this.onLevelUpdated,this)},a.unregisterListeners=function(){var e=this.hls;e&&(e.off(E.ERROR,this.onError,this),e.off(E.ERROR,this.onErrorOut,this),e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.LEVEL_UPDATED,this.onLevelUpdated,this))},a.destroy=function(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}},a.startLoad=function(e){this.playlistError=0},a.stopLoad=function(){},a.getVariantLevelIndex=function(e){return e?.type===W?e.level:this.hls.loadLevel},a.onManifestLoading=function(){this.playlistError=0,this.penalizedRenditions={}},a.onLevelUpdated=function(){this.playlistError=0},a.onError=function(e,t){var r,i;if(!t.fatal){var n=this.hls,o=t.context;switch(t.details){case k.FRAG_LOAD_ERROR:case k.FRAG_LOAD_TIMEOUT:case k.KEY_LOAD_ERROR:case k.KEY_LOAD_TIMEOUT:return void(t.errorAction=this.getFragRetryOrSwitchAction(t));case k.FRAG_PARSING_ERROR:if((r=t.frag)!=null&&r.gap)return void(t.errorAction={action:Wt,flags:He});case k.FRAG_GAP:case k.FRAG_DECRYPT_ERROR:return t.errorAction=this.getFragRetryOrSwitchAction(t),void(t.errorAction.action=De);case k.LEVEL_EMPTY_ERROR:case k.LEVEL_PARSING_ERROR:var l,u,d=t.parent===W?t.level:n.loadLevel;return void(t.details===k.LEVEL_EMPTY_ERROR&&(l=t.context)!=null&&(u=l.levelDetails)!=null&&u.live?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,d):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,d)));case k.LEVEL_LOAD_ERROR:case k.LEVEL_LOAD_TIMEOUT:return void(typeof o?.level=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,o.level)));case k.AUDIO_TRACK_LOAD_ERROR:case k.AUDIO_TRACK_LOAD_TIMEOUT:case k.SUBTITLE_LOAD_ERROR:case k.SUBTITLE_TRACK_LOAD_TIMEOUT:if(o){var h=n.levels[n.loadLevel];if(h&&(o.type===Ae&&o.groupId===h.audioGroupId||o.type===ke&&o.groupId===h.textGroupId))return t.errorAction=this.getPlaylistRetryOrSwitchAction(t,n.loadLevel),t.errorAction.action=De,void(t.errorAction.flags=jt)}return;case k.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:var f=n.levels[n.loadLevel],c=f?.attrs["HDCP-LEVEL"];return void(c&&(t.errorAction={action:De,flags:$r,hdcpLevel:c}));case k.BUFFER_ADD_CODEC_ERROR:case k.REMUX_ALLOC_ERROR:return void(t.errorAction=this.getLevelSwitchAction(t,(i=t.level)!=null?i:n.loadLevel));case k.INTERNAL_EXCEPTION:case k.BUFFER_APPENDING_ERROR:case k.BUFFER_APPEND_ERROR:case k.BUFFER_FULL_ERROR:case k.LEVEL_SWITCH_ERROR:case k.BUFFER_STALLED_ERROR:case k.BUFFER_SEEK_OVER_HOLE:case k.BUFFER_NUDGE_ON_STALL:return void(t.errorAction={action:Wt,flags:He})}if(t.type===K.KEY_SYSTEM_ERROR){var g=this.getVariantLevelIndex(t.frag);return t.levelRetry=!1,void(t.errorAction=this.getLevelSwitchAction(t,g))}}},a.getPlaylistRetryOrSwitchAction=function(e,t){var r,i=Xr(this.hls.config.playlistLoadPolicy,e),n=this.playlistError++,o=(r=e.response)==null?void 0:r.code;if(vt(i,n,ct(e),o))return{action:gt,flags:He,retryConfig:i,retryCount:n};var l=this.getLevelSwitchAction(e,t);return i&&(l.retryConfig=i,l.retryCount=n),l},a.getFragRetryOrSwitchAction=function(e){var t=this.hls,r=this.getVariantLevelIndex(e.frag),i=t.levels[r],n=t.config,o=n.fragLoadPolicy,l=n.keyLoadPolicy,u=Xr(e.details.startsWith("key")?l:o,e),d=t.levels.reduce(function(g,m){return g+m.fragmentError},0);if(i){var h;e.details!==k.FRAG_GAP&&i.fragmentError++;var f=(h=e.response)==null?void 0:h.code;if(vt(u,d,ct(e),f))return{action:gt,flags:He,retryConfig:u,retryCount:d}}var c=this.getLevelSwitchAction(e,r);return u&&(c.retryConfig=u,c.retryCount=d),c},a.getLevelSwitchAction=function(e,t){var r=this.hls;t==null&&(t=r.loadLevel);var i=this.hls.levels[t];if(i&&(i.loadError++,r.autoLevelEnabled)){for(var n,o,l=-1,u=r.levels,d=r.loadLevel,h=r.minAutoLevel,f=r.maxAutoLevel,c=(n=e.frag)==null?void 0:n.type,g=(o=e.context)!=null?o:{},m=g.type,y=g.groupId,v=u.length;v--;){var p=(v+d)%u.length;if(p!==d&&p>=h&&p<=f&&u[p].loadError===0){var S=u[p];if(e.details===k.FRAG_GAP&&e.frag){var T=u[p].details;if(T){var R=Vt(e.frag,T.fragments,e.frag.start);if(R!=null&&R.gap)continue}}else if(m===Ae&&y===S.audioGroupId||m===ke&&y===S.textGroupId||c===ht&&i.audioGroupId===S.audioGroupId||c===Gr&&i.textGroupId===S.textGroupId)continue;l=p;break}}if(l>-1&&r.loadLevel!==l)return e.levelRetry=!0,this.playlistError=0,{action:De,flags:He,nextAutoLevel:l}}return{action:De,flags:jt}},a.onErrorOut=function(e,t){var r;switch((r=t.errorAction)==null?void 0:r.action){case Wt:break;case De:this.sendAlternateToPenaltyBox(t),t.errorAction.resolved||t.details===k.FRAG_GAP||(t.fatal=!0)}t.fatal&&this.hls.stopLoad()},a.sendAlternateToPenaltyBox=function(e){var t=this.hls,r=e.errorAction;if(r){var i=r.flags,n=r.hdcpLevel,o=r.nextAutoLevel;switch(i){case He:this.switchLevel(e,o);break;case jt:r.resolved||(r.resolved=this.redundantFailover(e));break;case $r:n&&(t.maxHdcpLevel=Ut[Ut.indexOf(n)-1],r.resolved=!0),this.warn('Restricting playback to HDCP-LEVEL of "'+t.maxHdcpLevel+'" or lower')}r.resolved||this.switchLevel(e,o)}},a.switchLevel=function(e,t){t!==void 0&&e.errorAction&&(this.warn("switching to level "+t+" after "+e.details),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)},a.redundantFailover=function(e){var t=this,r=this.hls,i=this.penalizedRenditions,n=e.parent===W?e.level:r.loadLevel,o=r.levels[n],l=o.url.length,u=e.frag?e.frag.urlId:o.urlId;o.urlId!==u||e.frag&&!o.details||this.penalizeRendition(o,e);for(var d=function(){var c=(u+h)%l,g=i[c];if(!g||function(m,y,v){if(performance.now()-m.lastErrorPerfMs>Da)return!0;var p=m.details;if(y.details===k.FRAG_GAP&&p&&y.frag){var S=y.frag.start,T=Vt(null,p.fragments,S);if(T&&!T.gap)return!0}if(v&&m.errors.length<v.errors.length){var R=m.errors[m.errors.length-1];if(p&&R.frag&&y.frag&&Math.abs(R.frag.start-y.frag.start)>3*p.targetduration)return!0}return!1}(g,e,i[u]))return t.warn("Switching to Redundant Stream "+(c+1)+"/"+l+': "'+o.url[c]+'" after '+e.details),t.playlistError=0,r.levels.forEach(function(m){m.urlId=c}),r.nextLoadLevel=n,{v:!0}},h=1;h<l;h++){var f=d();if(typeof f=="object")return f.v}return!1},a.penalizeRendition=function(e,t){var r=this.penalizedRenditions,i=r[e.urlId]||{lastErrorPerfMs:0,errors:[],details:void 0};i.lastErrorPerfMs=performance.now(),i.errors.push(t),i.details=e.details,r[e.urlId]=i},s}(),xa=function(){function s(e,t){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=L.log.bind(L,t+":"),this.warn=L.warn.bind(L,t+":"),this.hls=e}var a=s.prototype;return a.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},a.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},a.startLoad=function(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()},a.stopLoad=function(){this.canLoad=!1,this.clearTimer()},a.switchParams=function(e,t){var r=t?.renditionReports;if(r){for(var i=-1,n=0;n<r.length;n++){var o=r[n],l=void 0;try{l=new self.URL(o.URI,t.url).href}catch(c){L.warn("Could not construct new URL for Rendition Report: "+c),l=o.URI||""}if(l===e){i=n;break}l===e.substring(0,l.length)&&(i=n)}if(i!==-1){var u=r[i],d=parseInt(u["LAST-MSN"])||t?.lastPartSn,h=parseInt(u["LAST-PART"])||t?.lastPartIndex;if(this.hls.config.lowLatencyMode){var f=Math.min(t.age-t.partTarget,t.targetduration);h>=0&&f>t.partTarget&&(h+=1)}return new Vr(d,h>=0?h:void 0,Gt)}}},a.loadPlaylist=function(e){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())},a.shouldLoadPlaylist=function(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)},a.shouldReloadPlaylist=function(e){return this.timer===-1&&this.requestScheduled===-1&&this.shouldLoadPlaylist(e)},a.playlistLoaded=function(e,t,r){var i=this,n=t.details,o=t.stats,l=self.performance.now(),u=o.loading.first?Math.max(0,l-o.loading.first):0;if(n.advancedDateTime=Date.now()-u,n.live||r!=null&&r.live){if(n.reloaded(r),r&&this.log("live playlist "+e+" "+(n.advanced?"REFRESHED "+n.lastPartSn+"-"+n.lastPartIndex:n.updated?"UPDATED":"MISSED")),r&&n.fragments.length>0&&Aa(r,n),!this.canLoad||!n.live)return;var d,h=void 0,f=void 0;if(n.canBlockReload&&n.endSN&&n.advanced){var c=this.hls.config.lowLatencyMode,g=n.lastPartSn,m=n.endSN,y=n.lastPartIndex,v=g===m;y!==-1?(h=v?m+1:g,f=v?c?0:y:y+1):h=m+1;var p=n.age,S=p+n.ageHeader,T=Math.min(S-n.partTarget,1.5*n.targetduration);if(T>0){if(r&&T>r.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+r.tuneInGoal+" to: "+T+" with playlist age: "+n.age),T=0;else{var R=Math.floor(T/n.targetduration);h+=R,f!==void 0&&(f+=Math.round(T%n.targetduration/n.partTarget)),this.log("CDN Tune-in age: "+n.ageHeader+"s last advanced "+p.toFixed(2)+"s goal: "+T+" skip sn "+R+" to part "+f)}n.tuneInGoal=T}if(d=this.getDeliveryDirectives(n,t.deliveryDirectives,h,f),c||!v)return void this.loadPlaylist(d)}else(n.canBlockReload||n.canSkipUntil)&&(d=this.getDeliveryDirectives(n,t.deliveryDirectives,h,f));var b=this.hls.mainForwardBufferInfo,A=b?b.end-b.len:0,_=function(D,I){I===void 0&&(I=1/0);var w=1e3*D.targetduration;if(D.updated){var O=D.fragments;if(O.length&&4*w>I){var B=1e3*O[O.length-1].duration;B<w&&(w=B)}}else w/=2;return Math.round(w)}(n,1e3*(n.edge-A));n.updated&&l>this.requestScheduled+_&&(this.requestScheduled=o.loading.start),h!==void 0&&n.canBlockReload?this.requestScheduled=o.loading.first+_-(1e3*n.partTarget||1e3):this.requestScheduled===-1||this.requestScheduled+_<l?this.requestScheduled=l:this.requestScheduled-l<=0&&(this.requestScheduled+=_);var x=this.requestScheduled-l;x=Math.max(0,x),this.log("reload live playlist "+e+" in "+Math.round(x)+" ms"),this.timer=self.setTimeout(function(){return i.loadPlaylist(d)},x)}else this.clearTimer()},a.getDeliveryDirectives=function(e,t,r,i){var n=function(o,l){var u=o.canSkipUntil,d=o.canSkipDateRanges,h=o.endSN;return u&&(l!==void 0?l-h:0)<u?d?Ra:La:Gt}(e,r);return t!=null&&t.skip&&e.deltaUpdateFailed&&(r=t.msn,i=t.part,n=Gt),new Vr(r,i,n)},a.checkRetry=function(e){var t=this,r=e.details,i=ct(e),n=e.errorAction,o=n||{},l=o.action,u=o.retryCount,d=u===void 0?0:u,h=o.retryConfig,f=!!n&&!!h&&(l===gt||!n.resolved&&l===De);if(f){var c;if(this.requestScheduled=-1,d>=h.maxNumRetry)return!1;if(i&&(c=e.context)!=null&&c.deliveryDirectives)this.warn("Retrying playlist loading "+(d+1)+"/"+h.maxNumRetry+' after "'+r+'" without delivery-directives'),this.loadPlaylist();else{var g=Kt(h,d);this.timer=self.setTimeout(function(){return t.loadPlaylist()},g),this.warn("Retrying playlist loading "+(d+1)+"/"+h.maxNumRetry+' after "'+r+'" in '+g+"ms")}e.levelRetry=!0,n.resolved=!0}return f},s}(),wa=function(s){function a(t,r){var i;return(i=s.call(this,t,"[level-controller]")||this)._levels=[],i._firstLevel=-1,i._startLevel=void 0,i.currentLevel=null,i.currentLevelIndex=-1,i.manualLevelIndex=-1,i.steering=void 0,i.onParsedComplete=void 0,i.steering=r,i._registerListeners(),i}Ee(a,s);var e=a.prototype;return e._registerListeners=function(){var t=this.hls;t.on(E.MANIFEST_LOADING,this.onManifestLoading,this),t.on(E.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(E.LEVEL_LOADED,this.onLevelLoaded,this),t.on(E.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(E.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(E.FRAG_LOADED,this.onFragLoaded,this),t.on(E.ERROR,this.onError,this)},e._unregisterListeners=function(){var t=this.hls;t.off(E.MANIFEST_LOADING,this.onManifestLoading,this),t.off(E.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(E.LEVEL_LOADED,this.onLevelLoaded,this),t.off(E.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(E.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(E.FRAG_LOADED,this.onFragLoaded,this),t.off(E.ERROR,this.onError,this)},e.destroy=function(){this._unregisterListeners(),this.steering=null,this.resetLevels(),s.prototype.destroy.call(this)},e.startLoad=function(){this._levels.forEach(function(t){t.loadError=0,t.fragmentError=0}),s.prototype.startLoad.call(this)},e.resetLevels=function(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[]},e.onManifestLoading=function(t,r){this.resetLevels()},e.onManifestLoaded=function(t,r){var i,n=[],o={};r.levels.forEach(function(l){var u,d=l.attrs;((u=l.audioCodec)==null?void 0:u.indexOf("mp4a.40.34"))!==-1&&(Yt||(Yt=/chrome|firefox/i.test(navigator.userAgent)),Yt&&(l.audioCodec=void 0));var h=d.AUDIO,f=d.CODECS,c=d["FRAME-RATE"];d["PATHWAY-ID"];var g=d.RESOLUTION,m=d.SUBTITLES,y=l.bitrate+"-"+g+"-"+c+"-"+f;(i=o[y])?i.addFallback(l):(i=new ba(l),o[y]=i,n.push(i)),Jr(i,"audio",h),Jr(i,"text",m)}),this.filterAndSortMediaOptions(n,r)},e.filterAndSortMediaOptions=function(t,r){var i=this,n=[],o=[],l=!1,u=!1,d=!1,h=t.filter(function(p){var S=p.audioCodec,T=p.videoCodec,R=p.width,b=p.height,A=p.unknownCodecs;return l||(l=!(!R||!b)),u||(u=!!T),d||(d=!!S),!(A!=null&&A.length)&&(!S||Ot(S,"audio"))&&(!T||Ot(T,"video"))});if((l||u)&&d&&(h=h.filter(function(p){var S=p.videoCodec,T=p.width,R=p.height;return!!S||!(!T||!R)})),h.length!==0){r.audioTracks&&ei(n=r.audioTracks.filter(function(p){return!p.audioCodec||Ot(p.audioCodec,"audio")})),r.subtitles&&ei(o=r.subtitles);var f=h.slice(0);h.sort(function(p,S){return p.attrs["HDCP-LEVEL"]!==S.attrs["HDCP-LEVEL"]?(p.attrs["HDCP-LEVEL"]||"")>(S.attrs["HDCP-LEVEL"]||"")?1:-1:p.bitrate!==S.bitrate?p.bitrate-S.bitrate:p.attrs["FRAME-RATE"]!==S.attrs["FRAME-RATE"]?p.attrs.decimalFloatingPoint("FRAME-RATE")-S.attrs.decimalFloatingPoint("FRAME-RATE"):p.attrs.SCORE!==S.attrs.SCORE?p.attrs.decimalFloatingPoint("SCORE")-S.attrs.decimalFloatingPoint("SCORE"):l&&p.height!==S.height?p.height-S.height:0});var c=f[0];if(this.steering&&(h=this.steering.filterParsedLevels(h)).length!==f.length){for(var g=0;g<f.length;g++)if(f[g].pathwayId===h[0].pathwayId){c=f[g];break}}this._levels=h;for(var m=0;m<h.length;m++)if(h[m]===c){this._firstLevel=m,this.log("manifest loaded, "+h.length+" level(s) found, first bitrate: "+c.bitrate);break}var y=d&&!u,v={levels:h,audioTracks:n,subtitleTracks:o,sessionData:r.sessionData,sessionKeys:r.sessionKeys,firstLevel:this._firstLevel,stats:r.stats,audio:d,video:u,altAudio:!y&&n.some(function(p){return!!p.url})};this.hls.trigger(E.MANIFEST_PARSED,v),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else Promise.resolve().then(function(){if(i.hls){var p=new Error("no level with compatible codecs found in manifest");i.hls.trigger(E.ERROR,{type:K.MEDIA_ERROR,details:k.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:r.url,error:p,reason:p.message})}})},e.onError=function(t,r){!r.fatal&&r.context&&r.context.type===Ce&&r.context.level===this.level&&this.checkRetry(r)},e.onFragLoaded=function(t,r){var i=r.frag;if(i!==void 0&&i.type===W){var n=this._levels[i.level];n!==void 0&&(n.loadError=0)}},e.onLevelLoaded=function(t,r){var i,n,o=r.level,l=r.details,u=this._levels[o];if(!u)return this.warn("Invalid level index "+o),void((n=r.deliveryDirectives)!=null&&n.skip&&(l.deltaUpdateFailed=!0));o===this.currentLevelIndex?(u.fragmentError===0&&(u.loadError=0),this.playlistLoaded(o,r,u.details)):(i=r.deliveryDirectives)!=null&&i.skip&&(l.deltaUpdateFailed=!0)},e.onAudioTrackSwitched=function(t,r){var i=this.currentLevel;if(i){var n=this.hls.audioTracks[r.id].groupId;if(i.audioGroupIds&&i.audioGroupId!==n){for(var o=-1,l=0;l<i.audioGroupIds.length;l++)if(i.audioGroupIds[l]===n){o=l;break}o!==-1&&o!==i.urlId&&(i.urlId=o,this.canLoad&&this.startLoad())}}},e.loadPlaylist=function(t){s.prototype.loadPlaylist.call(this);var r=this.currentLevelIndex,i=this.currentLevel;if(i&&this.shouldLoadPlaylist(i)){var n=i.urlId,o=i.uri;if(t)try{o=t.addDirectives(o)}catch(u){this.warn("Could not construct new URL with HLS Delivery Directives: "+u)}var l=i.attrs["PATHWAY-ID"];this.log("Loading level index "+r+(t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:"")+" with"+(l?" Pathway "+l:"")+" URI "+(n+1)+"/"+i.url.length+" "+o),this.clearTimer(),this.hls.trigger(E.LEVEL_LOADING,{url:o,level:r,id:n,deliveryDirectives:t||null})}},e.removeLevel=function(t,r){var i=this,n=function(l,u){return u!==r},o=this._levels.filter(function(l,u){return u!==t||(l.url.length>1&&r!==void 0?(l.url=l.url.filter(n),l.audioGroupIds&&(l.audioGroupIds=l.audioGroupIds.filter(n)),l.textGroupIds&&(l.textGroupIds=l.textGroupIds.filter(n)),l.urlId=0,!0):(i.steering&&i.steering.removeLevel(l),!1))});this.hls.trigger(E.LEVELS_UPDATED,{levels:o})},e.onLevelsUpdated=function(t,r){var i=r.levels;i.forEach(function(n,o){var l=n.details;l!=null&&l.fragments&&l.fragments.forEach(function(u){u.level=o})}),this._levels=i},se(a,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(t){var r=this._levels;if(r.length!==0){if(t<0||t>=r.length){var i=new Error("invalid level idx"),n=t<0;if(this.hls.trigger(E.ERROR,{type:K.OTHER_ERROR,details:k.LEVEL_SWITCH_ERROR,level:t,fatal:n,error:i,reason:i.message}),n)return;t=Math.min(t,r.length-1)}var o=this.currentLevelIndex,l=this.currentLevel,u=l?l.attrs["PATHWAY-ID"]:void 0,d=r[t],h=d.attrs["PATHWAY-ID"];if(this.currentLevelIndex=t,this.currentLevel=d,o!==t||!d.details||!l||u!==h){this.log("Switching to level "+t+(h?" with Pathway "+h:"")+" from level "+o+(u?" with Pathway "+u:""));var f=oe({},d,{level:t,maxBitrate:d.maxBitrate,attrs:d.attrs,uri:d.uri,urlId:d.urlId});delete f._attrs,delete f._urlId,this.hls.trigger(E.LEVEL_SWITCHING,f);var c=d.details;if(!c||c.live){var g=this.switchParams(d.uri,l?.details);this.loadPlaylist(g)}}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(t){this.manualLevelIndex=t,this._startLevel===void 0&&(this._startLevel=t),t!==-1&&(this.level=t)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(t){this._firstLevel=t}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var t=this.hls.config.startLevel;return t!==void 0?t:this._firstLevel}return this._startLevel},set:function(t){this._startLevel=t}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(t){this.level=t,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=t)}}]),a}(xa);function Jr(s,a,e){e&&(a==="audio"?(s.audioGroupIds||(s.audioGroupIds=[]),s.audioGroupIds[s.url.length-1]=e):a==="text"&&(s.textGroupIds||(s.textGroupIds=[]),s.textGroupIds[s.url.length-1]=e))}function ei(s){var a={};s.forEach(function(e){var t=e.groupId||"";e.id=a[t]=a[t]||0,a[t]++})}var ti="NOT_LOADED",ri="APPENDING",Ze="PARTIAL",$e="OK",Ia=function(){function s(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}var a=s.prototype;return a._registerListeners=function(){var e=this.hls;e.on(E.BUFFER_APPENDED,this.onBufferAppended,this),e.on(E.FRAG_BUFFERED,this.onFragBuffered,this),e.on(E.FRAG_LOADED,this.onFragLoaded,this)},a._unregisterListeners=function(){var e=this.hls;e.off(E.BUFFER_APPENDED,this.onBufferAppended,this),e.off(E.FRAG_BUFFERED,this.onFragBuffered,this),e.off(E.FRAG_LOADED,this.onFragLoaded,this)},a.destroy=function(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null},a.getAppendedFrag=function(e,t){var r=this.activePartLists[t];if(r)for(var i=r.length;i--;){var n=r[i];if(!n)break;var o=n.end;if(n.start<=e&&o!==null&&e<=o)return n}return this.getBufferedFrag(e,t)},a.getBufferedFrag=function(e,t){for(var r=this.fragments,i=Object.keys(r),n=i.length;n--;){var o=r[i[n]];if(o?.body.type===t&&o.buffered){var l=o.body;if(l.start<=e&&e<=l.end)return l}}return null},a.detectEvictedFragments=function(e,t,r,i){var n=this;this.timeRanges&&(this.timeRanges[e]=t);var o=i?.fragment.sn||-1;Object.keys(this.fragments).forEach(function(l){var u=n.fragments[l];if(u&&!(o>=u.body.sn))if(u.buffered||u.loaded){var d=u.range[e];d&&d.time.some(function(h){var f=!n.isTimeBuffered(h.startPTS,h.endPTS,t);return f&&n.removeFragment(u.body),f})}else u.body.type===r&&n.removeFragment(u.body)})},a.detectPartialFragments=function(e){var t=this,r=this.timeRanges,i=e.frag,n=e.part;if(r&&i.sn!=="initSegment"){var o=Ke(i),l=this.fragments[o];if(!(!l||l.buffered&&i.gap)){var u=!i.relurl;Object.keys(r).forEach(function(d){var h=i.elementaryStreams[d];if(h){var f=r[d],c=u||h.partial===!0;l.range[d]=t.getBufferedTimes(i,n,c,f)}}),l.loaded=null,Object.keys(l.range).length?(l.buffered=!0,(l.body.endList=i.endList||l.body.endList)&&(this.endListFragments[l.body.type]=l),mt(l)||this.removeParts(i.sn-1,i.type)):this.removeFragment(l.body)}}},a.removeParts=function(e,t){var r=this.activePartLists[t];r&&(this.activePartLists[t]=r.filter(function(i){return i.fragment.sn>=e}))},a.fragBuffered=function(e,t){var r=Ke(e),i=this.fragments[r];!i&&t&&(i=this.fragments[r]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,i.buffered=!0)},a.getBufferedTimes=function(e,t,r,i){for(var n={time:[],partial:r},o=e.start,l=e.end,u=e.minEndPTS||l,d=e.maxStartPTS||o,h=0;h<i.length;h++){var f=i.start(h)-this.bufferPadding,c=i.end(h)+this.bufferPadding;if(d>=f&&u<=c){n.time.push({startPTS:Math.max(o,i.start(h)),endPTS:Math.min(l,i.end(h))});break}if(o<c&&l>f)n.partial=!0,n.time.push({startPTS:Math.max(o,i.start(h)),endPTS:Math.min(l,i.end(h))});else if(l<=f)break}return n},a.getPartialFragment=function(e){var t,r,i,n=null,o=0,l=this.bufferPadding,u=this.fragments;return Object.keys(u).forEach(function(d){var h=u[d];h&&mt(h)&&(r=h.body.start-l,i=h.body.end+l,e>=r&&e<=i&&(t=Math.min(e-r,i-e),o<=t&&(n=h.body,o=t)))}),n},a.isEndListAppended=function(e){var t=this.endListFragments[e];return t!==void 0&&(t.buffered||mt(t))},a.getState=function(e){var t=Ke(e),r=this.fragments[t];return r?r.buffered?mt(r)?Ze:$e:ri:ti},a.isTimeBuffered=function(e,t,r){for(var i,n,o=0;o<r.length;o++){if(i=r.start(o)-this.bufferPadding,n=r.end(o)+this.bufferPadding,e>=i&&t<=n)return!0;if(t<=i)return!1}return!1},a.onFragLoaded=function(e,t){var r=t.frag,i=t.part;if(r.sn!=="initSegment"&&!r.bitrateTest){var n=i?null:t,o=Ke(r);this.fragments[o]={body:r,appendedPTS:null,loaded:n,buffered:!1,range:Object.create(null)}}},a.onBufferAppended=function(e,t){var r=this,i=t.frag,n=t.part,o=t.timeRanges;if(i.sn!=="initSegment"){var l=i.type;if(n){var u=this.activePartLists[l];u||(this.activePartLists[l]=u=[]),u.push(n)}this.timeRanges=o,Object.keys(o).forEach(function(d){var h=o[d];r.detectEvictedFragments(d,h,l,n)})}},a.onFragBuffered=function(e,t){this.detectPartialFragments(t)},a.hasFragment=function(e){var t=Ke(e);return!!this.fragments[t]},a.hasParts=function(e){var t;return!((t=this.activePartLists[e])==null||!t.length)},a.removeFragmentsInRange=function(e,t,r,i,n){var o=this;i&&!this.hasGaps||Object.keys(this.fragments).forEach(function(l){var u=o.fragments[l];if(u){var d=u.body;d.type!==r||i&&!d.gap||d.start<t&&d.end>e&&(u.buffered||n)&&o.removeFragment(d)}})},a.removeFragment=function(e){var t=Ke(e);e.stats.loaded=0,e.clearElementaryStreamInfo();var r=this.activePartLists[e.type];if(r){var i=e.sn;this.activePartLists[e.type]=r.filter(function(n){return n.fragment.sn!==i})}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]},a.removeAllFragments=function(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1},s}();function mt(s){var a,e,t;return s.buffered&&(s.body.gap||((a=s.range.video)==null?void 0:a.partial)||((e=s.range.audio)==null?void 0:e.partial)||((t=s.range.audiovideo)==null?void 0:t.partial))}function Ke(s){return s.type+"_"+s.level+"_"+s.urlId+"_"+s.sn}var ii=Math.pow(2,17),Ca=function(){function s(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}var a=s.prototype;return a.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},a.abort=function(){this.loader&&this.loader.abort()},a.load=function(e,t){var r=this,i=e.url;if(!i)return Promise.reject(new Te({type:K.NETWORK_ERROR,details:k.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error("Fragment does not have a "+(i?"part list":"url")),networkDetails:null}));this.abort();var n=this.config,o=n.fLoader,l=n.loader;return new Promise(function(u,d){if(r.loader&&r.loader.destroy(),e.gap){if(e.tagList.some(function(m){return m[0]==="GAP"}))return void d(ni(e));e.gap=!1}var h=r.loader=e.loader=o?new o(n):new l(n),f=ai(e),c=zr(n.fragLoadPolicy.default),g={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:ii};e.stats=h.stats,h.load(f,g,{onSuccess:function(m,y,v,p){r.resetLoader(e,h);var S=m.data;v.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(S.slice(0,16)),S=S.slice(16)),u({frag:e,part:null,payload:S,networkDetails:p})},onError:function(m,y,v,p){r.resetLoader(e,h),d(new Te({type:K.NETWORK_ERROR,details:k.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:de({url:i,data:void 0},m),error:new Error("HTTP Error "+m.code+" "+m.text),networkDetails:v,stats:p}))},onAbort:function(m,y,v){r.resetLoader(e,h),d(new Te({type:K.NETWORK_ERROR,details:k.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:v,stats:m}))},onTimeout:function(m,y,v){r.resetLoader(e,h),d(new Te({type:K.NETWORK_ERROR,details:k.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error("Timeout after "+g.timeout+"ms"),networkDetails:v,stats:m}))},onProgress:function(m,y,v,p){t&&t({frag:e,part:null,payload:v,networkDetails:p})}})})},a.loadPart=function(e,t,r){var i=this;this.abort();var n=this.config,o=n.fLoader,l=n.loader;return new Promise(function(u,d){if(i.loader&&i.loader.destroy(),e.gap||t.gap)d(ni(e,t));else{var h=i.loader=e.loader=o?new o(n):new l(n),f=ai(e,t),c=zr(n.fragLoadPolicy.default),g={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:ii};t.stats=h.stats,h.load(f,g,{onSuccess:function(m,y,v,p){i.resetLoader(e,h),i.updateStatsFromPart(e,t);var S={frag:e,part:t,payload:m.data,networkDetails:p};r(S),u(S)},onError:function(m,y,v,p){i.resetLoader(e,h),d(new Te({type:K.NETWORK_ERROR,details:k.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:de({url:f.url,data:void 0},m),error:new Error("HTTP Error "+m.code+" "+m.text),networkDetails:v,stats:p}))},onAbort:function(m,y,v){e.stats.aborted=t.stats.aborted,i.resetLoader(e,h),d(new Te({type:K.NETWORK_ERROR,details:k.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:v,stats:m}))},onTimeout:function(m,y,v){i.resetLoader(e,h),d(new Te({type:K.NETWORK_ERROR,details:k.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error("Timeout after "+g.timeout+"ms"),networkDetails:v,stats:m}))}})}})},a.updateStatsFromPart=function(e,t){var r=e.stats,i=t.stats,n=i.total;if(r.loaded+=i.loaded,n){var o=Math.round(e.duration/t.duration),l=Math.min(Math.round(r.loaded/n),o),u=(o-l)*Math.round(r.loaded/l);r.total=r.loaded+u}else r.total=Math.max(r.loaded,r.total);var d=r.loading,h=i.loading;d.start?d.first+=h.first-h.start:(d.start=h.start,d.first=h.first),d.end=h.end},a.resetLoader=function(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()},s}();function ai(s,a){a===void 0&&(a=null);var e=a||s,t={frag:s,part:a,responseType:"arraybuffer",url:e.url,headers:{},rangeStart:0,rangeEnd:0},r=e.byteRangeStartOffset,i=e.byteRangeEndOffset;if(F(r)&&F(i)){var n,o=r,l=i;if(s.sn==="initSegment"&&((n=s.decryptdata)==null?void 0:n.method)==="AES-128"){var u=i-r;u%16&&(l=i+(16-u%16)),r!==0&&(t.resetIV=!0,o=r-16)}t.rangeStart=o,t.rangeEnd=l}return t}function ni(s,a){var e=new Error("GAP "+(s.gap?"tag":"attribute")+" found"),t={type:K.MEDIA_ERROR,details:k.FRAG_GAP,fatal:!1,frag:s,error:e,networkDetails:null};return a&&(t.part=a),(a||s).stats.aborted=!0,new Te(t)}var Te=function(s){function a(e){var t;return(t=s.call(this,e.error.message)||this).data=void 0,t.data=e,t}return Ee(a,s),a}(nt(Error)),Pa=function(){function s(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}var a=s.prototype;return a.abort=function(e){for(var t in this.keyUriToKeyInfo){var r=this.keyUriToKeyInfo[t].loader;if(r){if(e&&e!==r.context.frag.type)return;r.abort()}}},a.detach=function(){for(var e in this.keyUriToKeyInfo){var t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}},a.destroy=function(){for(var e in this.detach(),this.keyUriToKeyInfo){var t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}},a.createKeyLoadError=function(e,t,r,i,n){return t===void 0&&(t=k.KEY_LOAD_ERROR),new Te({type:K.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:n,error:r,networkDetails:i})},a.loadClear=function(e,t){var r=this;if(this.emeController&&this.config.emeEnabled)for(var i=e.sn,n=e.cc,o=function(){var u=t[l];if(n<=u.cc&&(i==="initSegment"||u.sn==="initSegment"||i<u.sn))return r.emeController.selectKeySystemFormat(u).then(function(d){u.setKeyFormat(d)}),"break"},l=0;l<t.length&&o()!=="break";l++);},a.load=function(e){var t=this;return!e.decryptdata&&e.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(e).then(function(r){return t.loadInternal(e,r)}):this.loadInternal(e)},a.loadInternal=function(e,t){var r,i;t&&e.setKeyFormat(t);var n=e.decryptdata;if(!n){var o=new Error(t?"Expected frag.decryptdata to be defined after setting format "+t:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,k.KEY_LOAD_ERROR,o))}var l=n.uri;if(!l)return Promise.reject(this.createKeyLoadError(e,k.KEY_LOAD_ERROR,new Error('Invalid key URI: "'+l+'"')));var u,d=this.keyUriToKeyInfo[l];if((r=d)!=null&&r.decryptdata.key)return n.key=d.decryptdata.key,Promise.resolve({frag:e,keyInfo:d});if((i=d)!=null&&i.keyLoadPromise)switch((u=d.mediaKeySessionContext)==null?void 0:u.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return d.keyLoadPromise.then(function(h){return n.key=h.keyInfo.decryptdata.key,{frag:e,keyInfo:d}})}switch(d=this.keyUriToKeyInfo[l]={decryptdata:n,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},n.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return n.keyFormat==="identity"?this.loadKeyHTTP(d,e):this.loadKeyEME(d,e);case"AES-128":return this.loadKeyHTTP(d,e);default:return Promise.reject(this.createKeyLoadError(e,k.KEY_LOAD_ERROR,new Error('Key supplied with unsupported METHOD: "'+n.method+'"')))}},a.loadKeyEME=function(e,t){var r={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var i=this.emeController.loadKey(r);if(i)return(e.keyLoadPromise=i.then(function(n){return e.mediaKeySessionContext=n,r})).catch(function(n){throw e.keyLoadPromise=null,n})}return Promise.resolve(r)},a.loadKeyHTTP=function(e,t){var r=this,i=this.config,n=new i.loader(i);return t.keyLoader=e.loader=n,e.keyLoadPromise=new Promise(function(o,l){var u={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},d=i.keyLoadPolicy.default,h={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},f={onSuccess:function(c,g,m,y){var v=m.frag,p=m.keyInfo,S=m.url;if(!v.decryptdata||p!==r.keyUriToKeyInfo[S])return l(r.createKeyLoadError(v,k.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),y));p.decryptdata.key=v.decryptdata.key=new Uint8Array(c.data),v.keyLoader=null,p.loader=null,o({frag:v,keyInfo:p})},onError:function(c,g,m,y){r.resetLoader(g),l(r.createKeyLoadError(t,k.KEY_LOAD_ERROR,new Error("HTTP Error "+c.code+" loading key "+c.text),m,de({url:u.url,data:void 0},c)))},onTimeout:function(c,g,m){r.resetLoader(g),l(r.createKeyLoadError(t,k.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),m))},onAbort:function(c,g,m){r.resetLoader(g),l(r.createKeyLoadError(t,k.INTERNAL_ABORTED,new Error("key loading aborted"),m))}};n.load(u,h,f)})},a.resetLoader=function(e){var t=e.frag,r=e.keyInfo,i=e.url,n=r.loader;t.keyLoader===n&&(t.keyLoader=null,r.loader=null),delete this.keyUriToKeyInfo[i],n&&n.destroy()},s}(),Fa=function(){function s(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var a=s.prototype;return a.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},a.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},a.onHandlerDestroyed=function(){},a.hasInterval=function(){return!!this._tickInterval},a.hasNextTick=function(){return!!this._tickTimer},a.setInterval=function(e){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)},a.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},a.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},a.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},a.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},a.doTick=function(){},s}(),Oa={length:0,start:function(){return 0},end:function(){return 0}},X=function(){function s(){}return s.isBuffered=function(a,e){try{if(a){for(var t=s.getBuffered(a),r=0;r<t.length;r++)if(e>=t.start(r)&&e<=t.end(r))return!0}}catch{}return!1},s.bufferInfo=function(a,e,t){try{if(a){var r,i=s.getBuffered(a),n=[];for(r=0;r<i.length;r++)n.push({start:i.start(r),end:i.end(r)});return this.bufferedInfo(n,e,t)}}catch{}return{len:0,start:e,end:e,nextStart:void 0}},s.bufferedInfo=function(a,e,t){e=Math.max(0,e),a.sort(function(m,y){var v=m.start-y.start;return v||y.end-m.end});var r=[];if(t)for(var i=0;i<a.length;i++){var n=r.length;if(n){var o=r[n-1].end;a[i].start-o<t?a[i].end>o&&(r[n-1].end=a[i].end):r.push(a[i])}else r.push(a[i])}else r=a;for(var l,u=0,d=e,h=e,f=0;f<r.length;f++){var c=r[f].start,g=r[f].end;if(e+t>=c&&e<g)d=c,u=(h=g)-e;else if(e+t<c){l=c;break}}return{len:u,start:d||0,end:h||0,nextStart:l}},s.getBuffered=function(a){try{return a.buffered}catch(e){return L.log("failed to get media.buffered",e),Oa}},s}(),si=function(s,a,e,t,r,i){t===void 0&&(t=0),r===void 0&&(r=-1),i===void 0&&(i=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=s,this.sn=a,this.id=e,this.size=t,this.part=r,this.partial=i};function oi(s,a){if(s){var e=s.start+a;s.start=s.startPTS=e,s.endPTS=e+s.duration}}function li(s,a){for(var e=a.fragments,t=0,r=e.length;t<r;t++)oi(e[t],s);a.fragmentHint&&oi(a.fragmentHint,s),a.alignedSliding=!0}function Ma(s,a,e){a&&(function(t,r,i){if(function(o,l,u){return!(!l.details||!(u.endCC>u.startCC||o&&o.cc<u.startCC))}(t,i,r)){var n=function(o,l,u){var d=o.fragments,h=l.fragments;if(h.length&&d.length){var f=function(c,g){for(var m=null,y=0,v=c.length;y<v;y++){var p=c[y];if(p&&p.cc===g){m=p;break}}return m}(d,h[0].cc);if(f&&(!f||f.startPTS))return f;L.log("No frag in previous level to align on")}else L.log("No fragments to align")}(i.details,r);n&&F(n.start)&&(L.log("Adjusting PTS using last level due to CC increase within current level "+r.url),li(n.start,r))}}(s,e,a),!e.alignedSliding&&a.details&&function(t,r){if(r.fragments.length&&t.hasProgramDateTime&&r.hasProgramDateTime){var i=r.fragments[0].programDateTime,n=t.fragments[0].programDateTime,o=(n-i)/1e3+r.fragments[0].start;o&&F(o)&&(L.log("Adjusting PTS using programDateTime delta "+(n-i)+"ms, sliding:"+o.toFixed(3)+" "+t.url+" "),li(o,t))}}(e,a.details),e.alignedSliding||!a.details||e.skippedSegments||Wr(a.details,e))}var Na=function(){function s(a,e){this.subtle=void 0,this.aesIV=void 0,this.subtle=a,this.aesIV=e}return s.prototype.decrypt=function(a,e){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,a)},s}(),Ba=function(){function s(a,e){this.subtle=void 0,this.key=void 0,this.subtle=a,this.key=e}return s.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},s}(),Ua=function(){function s(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var a=s.prototype;return a.uint8ArrayToUint32Array_=function(e){for(var t=new DataView(e),r=new Uint32Array(4),i=0;i<4;i++)r[i]=t.getUint32(4*i);return r},a.initTable=function(){var e=this.sBox,t=this.invSBox,r=this.subMix,i=r[0],n=r[1],o=r[2],l=r[3],u=this.invSubMix,d=u[0],h=u[1],f=u[2],c=u[3],g=new Uint32Array(256),m=0,y=0,v=0;for(v=0;v<256;v++)g[v]=v<128?v<<1:v<<1^283;for(v=0;v<256;v++){var p=y^y<<1^y<<2^y<<3^y<<4;p=p>>>8^255&p^99,e[m]=p,t[p]=m;var S=g[m],T=g[S],R=g[T],b=257*g[p]^16843008*p;i[m]=b<<24|b>>>8,n[m]=b<<16|b>>>16,o[m]=b<<8|b>>>24,l[m]=b,b=16843009*R^65537*T^257*S^16843008*m,d[p]=b<<24|b>>>8,h[p]=b<<16|b>>>16,f[p]=b<<8|b>>>24,c[p]=b,m?(m=S^g[g[g[R^S]]],y^=g[g[y]]):m=y=1}},a.expandKey=function(e){for(var t=this.uint8ArrayToUint32Array_(e),r=!0,i=0;i<t.length&&r;)r=t[i]===this.key[i],i++;if(!r){this.key=t;var n=this.keySize=t.length;if(n!==4&&n!==6&&n!==8)throw new Error("Invalid aes key size="+n);var o,l,u,d,h=this.ksRows=4*(n+6+1),f=this.keySchedule=new Uint32Array(h),c=this.invKeySchedule=new Uint32Array(h),g=this.sBox,m=this.rcon,y=this.invSubMix,v=y[0],p=y[1],S=y[2],T=y[3];for(o=0;o<h;o++)o<n?u=f[o]=t[o]:(d=u,o%n==0?(d=g[(d=d<<8|d>>>24)>>>24]<<24|g[d>>>16&255]<<16|g[d>>>8&255]<<8|g[255&d],d^=m[o/n|0]<<24):n>6&&o%n==4&&(d=g[d>>>24]<<24|g[d>>>16&255]<<16|g[d>>>8&255]<<8|g[255&d]),f[o]=u=(f[o-n]^d)>>>0);for(l=0;l<h;l++)o=h-l,d=3&l?f[o]:f[o-4],c[l]=l<4||o<=4?d:v[g[d>>>24]]^p[g[d>>>16&255]]^S[g[d>>>8&255]]^T[g[255&d]],c[l]=c[l]>>>0}},a.networkToHostOrderSwap=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},a.decrypt=function(e,t,r){for(var i,n,o,l,u,d,h,f,c,g,m,y,v,p,S=this.keySize+6,T=this.invKeySchedule,R=this.invSBox,b=this.invSubMix,A=b[0],_=b[1],x=b[2],D=b[3],I=this.uint8ArrayToUint32Array_(r),w=I[0],O=I[1],B=I[2],C=I[3],U=new Int32Array(e),M=new Int32Array(U.length),P=this.networkToHostOrderSwap;t<U.length;){for(c=P(U[t]),g=P(U[t+1]),m=P(U[t+2]),y=P(U[t+3]),u=c^T[0],d=y^T[1],h=m^T[2],f=g^T[3],v=4,p=1;p<S;p++)i=A[u>>>24]^_[d>>16&255]^x[h>>8&255]^D[255&f]^T[v],n=A[d>>>24]^_[h>>16&255]^x[f>>8&255]^D[255&u]^T[v+1],o=A[h>>>24]^_[f>>16&255]^x[u>>8&255]^D[255&d]^T[v+2],l=A[f>>>24]^_[u>>16&255]^x[d>>8&255]^D[255&h]^T[v+3],u=i,d=n,h=o,f=l,v+=4;i=R[u>>>24]<<24^R[d>>16&255]<<16^R[h>>8&255]<<8^R[255&f]^T[v],n=R[d>>>24]<<24^R[h>>16&255]<<16^R[f>>8&255]<<8^R[255&u]^T[v+1],o=R[h>>>24]<<24^R[f>>16&255]<<16^R[u>>8&255]<<8^R[255&d]^T[v+2],l=R[f>>>24]<<24^R[u>>16&255]<<16^R[d>>8&255]<<8^R[255&h]^T[v+3],M[t]=P(i^w),M[t+1]=P(l^O),M[t+2]=P(o^B),M[t+3]=P(n^C),w=c,O=g,B=m,C=y,t+=4}return M.buffer},s}(),qt=function(){function s(e,t){var r=(t===void 0?{}:t).removePKCS7Padding,i=r===void 0||r;if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=e.enableSoftwareAES,this.removePKCS7Padding=i,i)try{var n=self.crypto;n&&(this.subtle=n.subtle||n.webkitSubtle)}catch{}this.subtle===null&&(this.useSoftware=!0)}var a=s.prototype;return a.destroy=function(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null},a.isSync=function(){return this.useSoftware},a.flush=function(){var e=this.currentResult,t=this.remainderData;if(!e||t)return this.reset(),null;var r,i,n,o=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?(i=(r=o).byteLength,(n=i&&new DataView(r.buffer).getUint8(i-1))?Ie(r,0,i-n):r):o},a.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},a.decrypt=function(e,t,r){var i=this;return this.useSoftware?new Promise(function(n,o){i.softwareDecrypt(new Uint8Array(e),t,r);var l=i.flush();l?n(l.buffer):o(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,r)},a.softwareDecrypt=function(e,t,r){var i=this.currentIV,n=this.currentResult,o=this.remainderData;this.logOnce("JS AES decrypt"),o&&(e=Ue(o,e),this.remainderData=null);var l=this.getValidChunk(e);if(!l.length)return null;i&&(r=i);var u=this.softwareDecrypter;u||(u=this.softwareDecrypter=new Ua),u.expandKey(t);var d=n;return this.currentResult=u.decrypt(l.buffer,0,r),this.currentIV=Ie(l,-16).buffer,d||null},a.webCryptoDecrypt=function(e,t,r){var i=this,n=this.subtle;return this.key===t&&this.fastAesKey||(this.key=t,this.fastAesKey=new Ba(n,t)),this.fastAesKey.expandKey().then(function(o){return n?(i.logOnce("WebCrypto AES decrypt"),new Na(n,new Uint8Array(r)).decrypt(e.buffer,o)):Promise.reject(new Error("web crypto not initialized"))}).catch(function(o){return L.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, "+o.name+": "+o.message),i.onWebCryptoError(e,t,r)})},a.onWebCryptoError=function(e,t,r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,r);var i=this.flush();if(i)return i.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")},a.getValidChunk=function(e){var t=e,r=e.length-e.length%16;return r!==e.length&&(t=Ie(e,0,r),this.remainderData=Ie(e,r)),t},a.logOnce=function(e){this.logEnabled&&(L.log("[decrypter]: "+e),this.logEnabled=!1)},s}(),Ga=function(s){for(var a="",e=s.length,t=0;t<e;t++)a+="["+s.start(t).toFixed(3)+"-"+s.end(t).toFixed(3)+"]";return a},Se="STOPPED",j="IDLE",Xt="KEY_LOADING",Je="FRAG_LOADING",et="FRAG_LOADING_WAITING_RETRY",Pe="PARSING",pt="PARSED",zt="ENDED",tt="ERROR",Fe="WAITING_LEVEL",Ha=function(s){function a(t,r,i,n,o){var l;return(l=s.call(this)||this).hls=void 0,l.fragPrevious=null,l.fragCurrent=null,l.fragmentTracker=void 0,l.transmuxer=null,l._state=Se,l.playlistType=void 0,l.media=null,l.mediaBuffer=null,l.config=void 0,l.bitrateTest=!1,l.lastCurrentTime=0,l.nextLoadPosition=0,l.startPosition=0,l.startTimeOffset=null,l.loadedmetadata=!1,l.retryDate=0,l.levels=null,l.fragmentLoader=void 0,l.keyLoader=void 0,l.levelLastLoaded=null,l.startFragRequested=!1,l.decrypter=void 0,l.initPTS=[],l.onvseeking=null,l.onvended=null,l.logPrefix="",l.log=void 0,l.warn=void 0,l.playlistType=o,l.logPrefix=n,l.log=L.log.bind(L,n+":"),l.warn=L.warn.bind(L,n+":"),l.hls=t,l.fragmentLoader=new Ca(t.config),l.keyLoader=i,l.fragmentTracker=r,l.config=t.config,l.decrypter=new qt(t.config),t.on(E.MANIFEST_LOADED,l.onManifestLoaded,function(u){if(u===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return u}(l)),l}Ee(a,s);var e=a.prototype;return e.doTick=function(){this.onTickEnd()},e.onTickEnd=function(){},e.startLoad=function(t){},e.stopLoad=function(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);var t=this.fragCurrent;t!=null&&t.loader&&(t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=Se},e._streamEnded=function(t,r){if(r.live||t.nextStart||!t.end||!this.media)return!1;var i=r.partList;if(i!=null&&i.length){var n=i[i.length-1];return X.isBuffered(this.media,n.start+n.duration/2)}var o=r.fragments[r.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(o)},e.getLevelDetails=function(){var t;if(this.levels&&this.levelLastLoaded!==null)return(t=this.levels[this.levelLastLoaded])==null?void 0:t.details},e.onMediaAttached=function(t,r){var i=this.media=this.mediaBuffer=r.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),i.addEventListener("seeking",this.onvseeking),i.addEventListener("ended",this.onvended);var n=this.config;this.levels&&n.autoStartLoad&&this.state===Se&&this.startLoad(n.startPosition)},e.onMediaDetaching=function(){var t=this.media;t!=null&&t.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),t&&this.onvseeking&&this.onvended&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},e.onMediaSeeking=function(){var t=this.config,r=this.fragCurrent,i=this.media,n=this.mediaBuffer,o=this.state,l=i?i.currentTime:0,u=X.bufferInfo(n||i,l,t.maxBufferHole);if(this.log("media seeking to "+(F(l)?l.toFixed(3):l)+", state: "+o),this.state===zt)this.resetLoadingState();else if(r){var d=t.maxFragLookUpTolerance,h=r.start-d,f=r.start+r.duration+d;if(!u.len||f<u.start||h>u.end){var c=l>f;(l<h||c)&&(c&&r.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),r.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}i&&(this.fragmentTracker.removeFragmentsInRange(l,1/0,this.playlistType,!0),this.lastCurrentTime=l),this.loadedmetadata||u.len||(this.nextLoadPosition=this.startPosition=l),this.tickImmediate()},e.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},e.onManifestLoaded=function(t,r){this.startTimeOffset=r.startTimeOffset,this.initPTS=[]},e.onHandlerDestroying=function(){this.stopLoad(),s.prototype.onHandlerDestroying.call(this)},e.onHandlerDestroyed=function(){this.state=Se,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,s.prototype.onHandlerDestroyed.call(this)},e.loadFragment=function(t,r,i){this._loadFragForPlayback(t,r,i)},e._loadFragForPlayback=function(t,r,i){var n=this;this._doFragLoad(t,r,i,function(o){if(n.fragContextChanged(t))return n.warn("Fragment "+t.sn+(o.part?" p: "+o.part.index:"")+" of level "+t.level+" was dropped during download."),void n.fragmentTracker.removeFragment(t);t.stats.chunkCount++,n._handleFragmentLoadProgress(o)}).then(function(o){if(o){var l=n.state;n.fragContextChanged(t)?(l===Je||!n.fragCurrent&&l===Pe)&&(n.fragmentTracker.removeFragment(t),n.state=j):("payload"in o&&(n.log("Loaded fragment "+t.sn+" of level "+t.level),n.hls.trigger(E.FRAG_LOADED,o)),n._handleFragmentLoadComplete(o))}}).catch(function(o){n.state!==Se&&n.state!==tt&&(n.warn(o),n.resetFragmentLoading(t))})},e.clearTrackerIfNeeded=function(t){var r,i=this.fragmentTracker;if(i.getState(t)===ri){var n=t.type,o=this.getFwdBufferInfo(this.mediaBuffer,n),l=Math.max(t.duration,o?o.len:this.config.maxBufferLength);this.reduceMaxBufferLength(l)&&i.removeFragment(t)}else((r=this.mediaBuffer)==null?void 0:r.buffered.length)===0?i.removeAllFragments():i.hasParts(t.type)&&(i.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type}),i.getState(t)===Ze&&i.removeFragment(t))},e.checkLiveUpdate=function(t){if(t.updated&&!t.live){var r=t.fragments[t.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:r,part:null,stats:r.stats,id:r.type})}t.fragments[0]||(t.deltaUpdateFailed=!0)},e.flushMainBuffer=function(t,r,i){if(i===void 0&&(i=null),t-r){var n={startOffset:t,endOffset:r,type:i};this.hls.trigger(E.BUFFER_FLUSHING,n)}},e._loadInitSegment=function(t,r){var i=this;this._doFragLoad(t,r).then(function(n){if(!n||i.fragContextChanged(t)||!i.levels)throw new Error("init load aborted");return n}).then(function(n){var o=i.hls,l=n.payload,u=t.decryptdata;if(l&&l.byteLength>0&&u&&u.key&&u.iv&&u.method==="AES-128"){var d=self.performance.now();return i.decrypter.decrypt(new Uint8Array(l),u.key.buffer,u.iv.buffer).catch(function(h){throw o.trigger(E.ERROR,{type:K.MEDIA_ERROR,details:k.FRAG_DECRYPT_ERROR,fatal:!1,error:h,reason:h.message,frag:t}),h}).then(function(h){var f=self.performance.now();return o.trigger(E.FRAG_DECRYPTED,{frag:t,payload:h,stats:{tstart:d,tdecrypt:f}}),n.payload=h,n})}return n}).then(function(n){var o=i.fragCurrent,l=i.hls;if(!i.levels)throw new Error("init load aborted, missing levels");var u=t.stats;i.state=j,r.fragmentError=0,t.data=new Uint8Array(n.payload),u.parsing.start=u.buffering.start=self.performance.now(),u.parsing.end=u.buffering.end=self.performance.now(),n.frag===o&&l.trigger(E.FRAG_BUFFERED,{stats:u,frag:o,part:null,id:t.type}),i.tick()}).catch(function(n){i.state!==Se&&i.state!==tt&&(i.warn(n),i.resetFragmentLoading(t))})},e.fragContextChanged=function(t){var r=this.fragCurrent;return!t||!r||t.level!==r.level||t.sn!==r.sn||t.urlId!==r.urlId},e.fragBufferedComplete=function(t,r){var i,n,o,l,u=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+t.type+" sn: "+t.sn+(r?" part: "+r.index:"")+" of "+(this.playlistType===W?"level":"track")+" "+t.level+" (frag:["+((i=t.startPTS)!=null?i:NaN).toFixed(3)+"-"+((n=t.endPTS)!=null?n:NaN).toFixed(3)+"] > buffer:"+(u?Ga(X.getBuffered(u)):"(detached)")+")"),this.state=j,u&&(!this.loadedmetadata&&t.type==W&&u.buffered.length&&((o=this.fragCurrent)==null?void 0:o.sn)===((l=this.fragPrevious)==null?void 0:l.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},e.seekToStartPos=function(){},e._handleFragmentLoadComplete=function(t){var r=this.transmuxer;if(r){var i=t.frag,n=t.part,o=t.partsLoaded,l=!o||o.length===0||o.some(function(d){return!d}),u=new si(i.level,i.sn,i.stats.chunkCount+1,0,n?n.index:-1,!l);r.flush(u)}},e._handleFragmentLoadProgress=function(t){},e._doFragLoad=function(t,r,i,n){var o,l=this;i===void 0&&(i=null);var u=r?.details;if(!this.levels||!u)throw new Error("frag load aborted, missing level"+(u?"":" detail")+"s");var d=null;if(!t.encrypted||(o=t.decryptdata)!=null&&o.key?!t.encrypted&&u.encryptedFragments.length&&this.keyLoader.loadClear(t,u.encryptedFragments):(this.log("Loading key for "+t.sn+" of ["+u.startSN+"-"+u.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+t.level),this.state=Xt,this.fragCurrent=t,d=this.keyLoader.load(t).then(function(v){if(!l.fragContextChanged(v.frag))return l.hls.trigger(E.KEY_LOADED,v),l.state===Xt&&(l.state=j),v}),this.hls.trigger(E.KEY_LOADING,{frag:t}),this.fragCurrent===null&&(d=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))),i=Math.max(t.start,i||0),this.config.lowLatencyMode&&t.sn!=="initSegment"){var h=u.partList;if(h&&n){i>t.end&&u.fragmentHint&&(t=u.fragmentHint);var f=this.getNextPart(h,t,i);if(f>-1){var c,g=h[f];return this.log("Loading part sn: "+t.sn+" p: "+g.index+" cc: "+t.cc+" of playlist ["+u.startSN+"-"+u.endSN+"] parts [0-"+f+"-"+(h.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+t.level+", target: "+parseFloat(i.toFixed(3))),this.nextLoadPosition=g.start+g.duration,this.state=Je,c=d?d.then(function(v){return!v||l.fragContextChanged(v.frag)?null:l.doFragPartsLoad(t,g,r,n)}).catch(function(v){return l.handleFragLoadError(v)}):this.doFragPartsLoad(t,g,r,n).catch(function(v){return l.handleFragLoadError(v)}),this.hls.trigger(E.FRAG_LOADING,{frag:t,part:g,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):c}if(!t.url||this.loadedEndOfParts(h,i))return Promise.resolve(null)}}this.log("Loading fragment "+t.sn+" cc: "+t.cc+" "+(u?"of ["+u.startSN+"-"+u.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+t.level+", target: "+parseFloat(i.toFixed(3))),F(t.sn)&&!this.bitrateTest&&(this.nextLoadPosition=t.start+t.duration),this.state=Je;var m,y=this.config.progressive;return m=y&&d?d.then(function(v){return!v||l.fragContextChanged(v?.frag)?null:l.fragmentLoader.load(t,n)}).catch(function(v){return l.handleFragLoadError(v)}):Promise.all([this.fragmentLoader.load(t,y?n:void 0),d]).then(function(v){var p=v[0];return!y&&p&&n&&n(p),p}).catch(function(v){return l.handleFragLoadError(v)}),this.hls.trigger(E.FRAG_LOADING,{frag:t,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):m},e.doFragPartsLoad=function(t,r,i,n){var o=this;return new Promise(function(l,u){var d,h=[],f=(d=i.details)==null?void 0:d.partList;(function c(g){o.fragmentLoader.loadPart(t,g,n).then(function(m){h[g.index]=m;var y=m.part;o.hls.trigger(E.FRAG_LOADED,m);var v=jr(i,t.sn,g.index+1)||qr(f,t.sn,g.index+1);if(!v)return l({frag:t,part:y,partsLoaded:h});c(v)}).catch(u)})(r)})},e.handleFragLoadError=function(t){if("data"in t){var r=t.data;t.data&&r.details===k.INTERNAL_ABORTED?this.handleFragLoadAborted(r.frag,r.part):this.hls.trigger(E.ERROR,r)}else this.hls.trigger(E.ERROR,{type:K.OTHER_ERROR,details:k.INTERNAL_EXCEPTION,err:t,error:t,fatal:!0});return null},e._handleTransmuxerFlush=function(t){var r=this.getCurrentContext(t);if(r&&this.state===Pe){var i=r.frag,n=r.part,o=r.level,l=self.performance.now();i.stats.parsing.end=l,n&&(n.stats.parsing.end=l),this.updateLevelTiming(i,n,o,t.partial)}else this.fragCurrent||this.state===Se||this.state===tt||(this.state=j)},e.getCurrentContext=function(t){var r=this.levels,i=this.fragCurrent,n=t.level,o=t.sn,l=t.part;if(r==null||!r[n])return this.warn("Levels object was unset while buffering fragment "+o+" of level "+n+". The current chunk will not be buffered."),null;var u=r[n],d=l>-1?jr(u,o,l):null,h=d?d.fragment:function(f,c,g){if(f==null||!f.details)return null;var m=f.details,y=m.fragments[c-m.startSN];return y||((y=m.fragmentHint)&&y.sn===c?y:c<m.startSN&&g&&g.sn===c?g:null)}(u,o,i);return h?(i&&i!==h&&(h.stats=i.stats),{frag:h,part:d,level:u}):null},e.bufferFragmentData=function(t,r,i,n,o){var l;if(t&&this.state===Pe){var u=t.data1,d=t.data2,h=u;if(u&&d&&(h=Ue(u,d)),(l=h)!=null&&l.length){var f={type:t.type,frag:r,part:i,chunkMeta:n,parent:r.type,data:h};if(this.hls.trigger(E.BUFFER_APPENDING,f),t.dropped&&t.independent&&!i){if(o)return;this.flushBufferGap(r)}}}},e.flushBufferGap=function(t){var r=this.media;if(r)if(X.isBuffered(r,r.currentTime)){var i=r.currentTime,n=X.bufferInfo(r,i,0),o=t.duration,l=Math.min(2*this.config.maxFragLookUpTolerance,.25*o),u=Math.max(Math.min(t.start-l,n.end-l),i+l);t.start-u>l&&this.flushMainBuffer(u,t.start)}else this.flushMainBuffer(0,t.start)},e.getFwdBufferInfo=function(t,r){var i=this.getLoadPosition();return F(i)?this.getFwdBufferInfoAtPos(t,i,r):null},e.getFwdBufferInfoAtPos=function(t,r,i){var n=this.config.maxBufferHole,o=X.bufferInfo(t,r,n);if(o.len===0&&o.nextStart!==void 0){var l=this.fragmentTracker.getBufferedFrag(r,i);if(l&&o.nextStart<l.end)return X.bufferInfo(t,r,Math.max(o.nextStart,n))}return o},e.getMaxBufferLength=function(t){var r,i=this.config;return r=t?Math.max(8*i.maxBufferSize/t,i.maxBufferLength):i.maxBufferLength,Math.min(r,i.maxMaxBufferLength)},e.reduceMaxBufferLength=function(t){var r=this.config,i=t||r.maxBufferLength;return r.maxMaxBufferLength>=i&&(r.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+r.maxMaxBufferLength+"s"),!0)},e.getAppendedFrag=function(t,r){var i=this.fragmentTracker.getAppendedFrag(t,W);return i&&"fragment"in i?i.fragment:i},e.getNextFragment=function(t,r){var i=r.fragments,n=i.length;if(!n)return null;var o,l=this.config,u=i[0].start;if(r.live){var d=l.initialLiveManifestSize;if(n<d)return this.warn("Not enough fragments to start playback (have: "+n+", need: "+d+")"),null;r.PTSKnown||this.startFragRequested||this.startPosition!==-1||(o=this.getInitialLiveFragment(r,i),this.startPosition=o?this.hls.liveSyncPosition||o.start:t)}else t<=u&&(o=i[0]);if(!o){var h=l.lowLatencyMode?r.partEnd:r.fragmentEnd;o=this.getFragmentAtPosition(t,h,r)}return this.mapToInitFragWhenRequired(o)},e.isLoopLoading=function(t,r){var i=this.fragmentTracker.getState(t);return(i===$e||i===Ze&&!!t.gap)&&this.nextLoadPosition>r},e.getNextFragmentLoopLoading=function(t,r,i,n,o){var l=t.gap,u=this.getNextFragment(this.nextLoadPosition,r);if(u===null)return u;if(t=u,l&&t&&!t.gap&&i.nextStart){var d=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,n);if(d!==null&&i.len+d.len>=o)return this.log('buffer full after gaps in "'+n+'" playlist starting at sn: '+t.sn),null}return t},e.mapToInitFragWhenRequired=function(t){return t==null||!t.initSegment||t!=null&&t.initSegment.data||this.bitrateTest?t:t.initSegment},e.getNextPart=function(t,r,i){for(var n=-1,o=!1,l=!0,u=0,d=t.length;u<d;u++){var h=t[u];if(l=l&&!h.independent,n>-1&&i<h.start)break;var f=h.loaded;f?n=-1:(o||h.independent||l)&&h.fragment===r&&(n=u),o=f}return n},e.loadedEndOfParts=function(t,r){var i=t[t.length-1];return i&&r>i.start&&i.loaded},e.getInitialLiveFragment=function(t,r){var i=this.fragPrevious,n=null;if(i){if(t.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+i.programDateTime),n=function(d,h,f){if(h===null||!Array.isArray(d)||!d.length||!F(h)||h<(d[0].programDateTime||0)||h>=(d[d.length-1].endProgramDateTime||0))return null;f=f||0;for(var c=0;c<d.length;++c){var g=d[c];if(ka(h,f,g))return g}return null}(r,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!n){var o=i.sn+1;if(o>=t.startSN&&o<=t.endSN){var l=r[o-t.startSN];i.cc===l.cc&&(n=l,this.log("Live playlist, switching playlist, load frag with next SN: "+n.sn))}n||(n=function(d,h){return Qr(d,function(f){return f.cc<h?1:f.cc>h?-1:0})}(r,i.cc),n&&this.log("Live playlist, switching playlist, load frag with same CC: "+n.sn))}}else{var u=this.hls.liveSyncPosition;u!==null&&(n=this.getFragmentAtPosition(u,this.bitrateTest?t.fragmentEnd:t.edge,t))}return n},e.getFragmentAtPosition=function(t,r,i){var n,o=this.config,l=this.fragPrevious,u=i.fragments,d=i.endSN,h=i.fragmentHint,f=o.maxFragLookUpTolerance,c=i.partList,g=!!(o.lowLatencyMode&&c!=null&&c.length&&h);if(g&&h&&!this.bitrateTest&&(u=u.concat(h),d=h.sn),n=t<r?Vt(l,u,t,t>r-f?0:f):u[u.length-1]){var m=n.sn-i.startSN,y=this.fragmentTracker.getState(n);if((y===$e||y===Ze&&n.gap)&&(l=n),l&&n.sn===l.sn&&(!g||c[0].fragment.sn>n.sn)&&l&&n.level===l.level){var v=u[m+1];n=n.sn<d&&this.fragmentTracker.getState(v)!==$e?v:null}}return n},e.synchronizeToLiveEdge=function(t){var r=this.config,i=this.media;if(i){var n=this.hls.liveSyncPosition,o=i.currentTime,l=t.fragments[0].start,u=t.edge,d=o>=l-r.maxFragLookUpTolerance&&o<=u;if(n!==null&&i.duration>n&&(o<n||!d)){var h=r.liveMaxLatencyDuration!==void 0?r.liveMaxLatencyDuration:r.liveMaxLatencyDurationCount*t.targetduration;(!d&&i.readyState<4||o<u-h)&&(this.loadedmetadata||(this.nextLoadPosition=n),i.readyState&&(this.warn("Playback: "+o.toFixed(3)+" is located too far from the end of live sliding playlist: "+u+", reset currentTime to : "+n.toFixed(3)),i.currentTime=n))}}},e.alignPlaylists=function(t,r){var i=this.levels,n=this.levelLastLoaded,o=this.fragPrevious,l=n!==null?i[n]:null,u=t.fragments.length;if(!u)return this.warn("No fragments in live playlist"),0;var d=t.fragments[0].start,h=!r,f=t.alignedSliding&&F(d);if(h||!f&&!d){Ma(o,l,t);var c=t.fragments[0].start;return this.log("Live playlist sliding: "+c.toFixed(2)+" start-sn: "+(r?r.startSN:"na")+"->"+t.startSN+" prev-sn: "+(o?o.sn:"na")+" fragments: "+u),c}return d},e.waitForCdnTuneIn=function(t){return t.live&&t.canBlockReload&&t.partTarget&&t.tuneInGoal>Math.max(t.partHoldBack,3*t.partTarget)},e.setStartPosition=function(t,r){var i=this.startPosition;if(i<r&&(i=-1),i===-1||this.lastCurrentTime===-1){var n=this.startTimeOffset!==null,o=n?this.startTimeOffset:t.startTimeOffset;o!==null&&F(o)?(i=r+o,o<0&&(i+=t.totalduration),i=Math.min(Math.max(r,i),r+t.totalduration),this.log("Start time offset "+o+" found in "+(n?"multivariant":"media")+" playlist, adjust startPosition to "+i),this.startPosition=i):t.live?i=this.hls.liveSyncPosition||r:this.startPosition=i=0,this.lastCurrentTime=i}this.nextLoadPosition=i},e.getLoadPosition=function(){var t=this.media,r=0;return this.loadedmetadata&&t?r=t.currentTime:this.nextLoadPosition&&(r=this.nextLoadPosition),r},e.handleFragLoadAborted=function(t,r){this.transmuxer&&t.sn!=="initSegment"&&t.stats.aborted&&(this.warn("Fragment "+t.sn+(r?" part "+r.index:"")+" of level "+t.level+" was aborted"),this.resetFragmentLoading(t))},e.resetFragmentLoading=function(t){this.fragCurrent&&(this.fragContextChanged(t)||this.state===et)||(this.state=j)},e.onFragmentOrKeyLoadError=function(t,r){if(r.chunkMeta&&!r.frag){var i=this.getCurrentContext(r.chunkMeta);i&&(r.frag=i.frag)}var n=r.frag;if(n&&n.type===t&&this.levels)if(this.fragContextChanged(n)){var o;this.warn("Frag load error must match current frag to retry "+n.url+" > "+((o=this.fragCurrent)==null?void 0:o.url))}else{var l=r.details===k.FRAG_GAP;l&&this.fragmentTracker.fragBuffered(n,!0);var u=r.errorAction,d=u||{},h=d.action,f=d.retryCount,c=f===void 0?0:f,g=d.retryConfig;if(u&&h===gt&&g){var m;this.resetStartWhenNotLoaded((m=this.levelLastLoaded)!=null?m:n.level);var y=Kt(g,c);this.warn("Fragment "+n.sn+" of "+t+" "+n.level+" errored with "+r.details+", retrying loading "+(c+1)+"/"+g.maxNumRetry+" in "+y+"ms"),u.resolved=!0,this.retryDate=self.performance.now()+y,this.state=et}else g&&u?(this.resetFragmentErrors(t),c<g.maxNumRetry?l||(u.resolved=!0):L.warn(r.details+" reached or exceeded max retry ("+c+")")):u?.action===De?this.state=Fe:this.state=tt;this.tickImmediate()}},e.reduceLengthAndFlushBuffer=function(t){if(this.state===Pe||this.state===pt){var r=t.parent,i=this.getFwdBufferInfo(this.mediaBuffer,r),n=i&&i.len>.5;n&&this.reduceMaxBufferLength(i.len);var o=!n;return o&&this.warn("Buffer full error while media.currentTime is not buffered, flush "+r+" buffer"),t.frag&&(this.fragmentTracker.removeFragment(t.frag),this.nextLoadPosition=t.frag.start),this.resetLoadingState(),o}return!1},e.resetFragmentErrors=function(t){t===ht&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==Se&&(this.state=j)},e.afterBufferFlushed=function(t,r,i){if(t){var n=X.getBuffered(t);this.fragmentTracker.detectEvictedFragments(r,n,i),this.state===zt&&this.resetLoadingState()}},e.resetLoadingState=function(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=j},e.resetStartWhenNotLoaded=function(t){if(!this.loadedmetadata){this.startFragRequested=!1;var r=this.levels?this.levels[t].details:null;r!=null&&r.live?(this.startPosition=-1,this.setStartPosition(r,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},e.resetWhenMissingContext=function(t){var r;this.warn("The loading context changed while buffering fragment "+t.sn+" of level "+t.level+". This chunk will not be buffered."),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded((r=this.levelLastLoaded)!=null?r:t.level),this.resetLoadingState()},e.removeUnbufferedFrags=function(t){t===void 0&&(t=0),this.fragmentTracker.removeFragmentsInRange(t,1/0,this.playlistType,!1,!0)},e.updateLevelTiming=function(t,r,i,n){var o,l=this,u=i.details;if(u){if(Object.keys(t.elementaryStreams).reduce(function(h,f){var c=t.elementaryStreams[f];if(c){var g=c.endPTS-c.startPTS;if(g<=0)return l.warn("Could not parse fragment "+t.sn+" "+f+" duration reliably ("+g+")"),h||!1;var m=n?0:Yr(u,t,c.startPTS,c.endPTS,c.startDTS,c.endDTS);return l.hls.trigger(E.LEVEL_PTS_UPDATED,{details:u,level:i,drift:m,type:f,frag:t,start:c.startPTS,end:c.endPTS}),!0}return h},!1))i.fragmentError=0;else if(((o=this.transmuxer)==null?void 0:o.error)===null){var d=new Error("Found no media in fragment "+t.sn+" of level "+t.level+" resetting transmuxer to fallback to playlist timing");if(i.fragmentError===0&&(i.fragmentError++,t.gap=!0,this.fragmentTracker.removeFragment(t),this.fragmentTracker.fragBuffered(t,!0)),this.warn(d.message),this.hls.trigger(E.ERROR,{type:K.MEDIA_ERROR,details:k.FRAG_PARSING_ERROR,fatal:!1,error:d,frag:t,reason:"Found no media in msn "+t.sn+' of level "'+i.url+'"'}),!this.hls)return;this.resetTransmuxer()}this.state=pt,this.hls.trigger(E.FRAG_PARSED,{frag:t,part:r})}else this.warn("level.details undefined")},e.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},e.recoverWorkerError=function(t){var r,i,n;t.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded((r=(i=this.levelLastLoaded)!=null?i:(n=this.fragCurrent)==null?void 0:n.level)!=null?r:0),this.resetLoadingState())},se(a,[{key:"state",get:function(){return this._state},set:function(t){var r=this._state;r!==t&&(this._state=t,this.log(r+"->"+t))}}]),a}(Fa);function ui(){return self.SourceBuffer||self.WebKitSourceBuffer}function pe(s,a){return s===void 0&&(s=""),a===void 0&&(a=9e4),{type:s,id:-1,pid:-1,inputTimeScale:a,sequenceNumber:-1,samples:[],dropped:0}}var di=function(){function s(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var a=s.prototype;return a.resetInitSegment=function(e,t,r,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},a.resetTimeStamp=function(e){this.initPTS=e,this.resetContiguity()},a.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},a.canParse=function(e,t){return!1},a.appendFrame=function(e,t,r){},a.demux=function(e,t){this.cachedData&&(e=Ue(this.cachedData,e),this.cachedData=null);var r,i=ot(e,0),n=i?i.length:0,o=this._audioTrack,l=this._id3Track,u=i?function(c){for(var g=Sr(c),m=0;m<g.length;m++){var y=g[m];if(Tr(y))return aa(y)}}(i):void 0,d=e.length;for((this.basePTS===null||this.frameIndex===0&&F(u))&&(this.basePTS=Ka(u,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),i&&i.length>0&&l.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:ze,duration:Number.POSITIVE_INFINITY});n<d;){if(this.canParse(e,n)){var h=this.appendFrame(o,e,n);h?(this.frameIndex++,this.lastPTS=h.sample.pts,r=n+=h.length):n=d}else $i(e,n)?(i=ot(e,n),l.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:ze,duration:Number.POSITIVE_INFINITY}),r=n+=i.length):n++;if(n===d&&r!==d){var f=Ie(e,r);this.cachedData?this.cachedData=Ue(this.cachedData,f):this.cachedData=f}}return{audioTrack:o,videoTrack:pe(),id3Track:l,textTrack:pe()}},a.demuxSampleAes=function(e,t,r){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},a.flush=function(e){var t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:pe(),id3Track:this._id3Track,textTrack:pe()}},a.destroy=function(){},s}(),Ka=function(s,a,e){return F(s)?90*s:9e4*a+(e?9e4*e.baseTime/e.timescale:0)};function hi(s,a){return s[a]===255&&(246&s[a+1])==240}function fi(s,a){return 1&s[a+1]?7:9}function Qt(s,a){return(3&s[a+3])<<11|s[a+4]<<3|(224&s[a+5])>>>5}function yt(s,a){return a+1<s.length&&hi(s,a)}function Va(s,a){if(yt(s,a)){var e=fi(s,a);if(a+e>=s.length)return!1;var t=Qt(s,a);if(t<=e)return!1;var r=a+t;return r===s.length||yt(s,r)}return!1}function ci(s,a,e,t,r){if(!s.samplerate){var i=function(n,o,l,u){var d,h,f,c,g=navigator.userAgent.toLowerCase(),m=u,y=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];d=1+((192&o[l+2])>>>6);var v=(60&o[l+2])>>>2;if(!(v>y.length-1))return f=(1&o[l+2])<<2,f|=(192&o[l+3])>>>6,L.log("manifest codec:"+u+", ADTS type:"+d+", samplingIndex:"+v),/firefox/i.test(g)?v>=6?(d=5,c=new Array(4),h=v-3):(d=2,c=new Array(2),h=v):g.indexOf("android")!==-1?(d=2,c=new Array(2),h=v):(d=5,c=new Array(4),u&&(u.indexOf("mp4a.40.29")!==-1||u.indexOf("mp4a.40.5")!==-1)||!u&&v>=6?h=v-3:((u&&u.indexOf("mp4a.40.2")!==-1&&(v>=6&&f===1||/vivaldi/i.test(g))||!u&&f===1)&&(d=2,c=new Array(2)),h=v)),c[0]=d<<3,c[0]|=(14&v)>>1,c[1]|=(1&v)<<7,c[1]|=f<<3,d===5&&(c[1]|=(14&h)>>1,c[2]=(1&h)<<7,c[2]|=8,c[3]=0),{config:c,samplerate:y[v],channelCount:f,codec:"mp4a.40."+d,manifestCodec:m};n.trigger(E.ERROR,{type:K.MEDIA_ERROR,details:k.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+v})}(a,e,t,r);if(!i)return;s.config=i.config,s.samplerate=i.samplerate,s.channelCount=i.channelCount,s.codec=i.codec,s.manifestCodec=i.manifestCodec,L.log("parsed codec:"+s.codec+", rate:"+i.samplerate+", channels:"+i.channelCount)}}function vi(s){return 9216e4/s}function gi(s,a,e,t,r){var i,n=t+r*vi(s.samplerate),o=function(g,m){var y=fi(g,m);if(m+y<=g.length){var v=Qt(g,m)-y;if(v>0)return{headerLength:y,frameLength:v}}}(a,e);if(o){var l=o.frameLength,u=o.headerLength,d=u+l,h=Math.max(0,e+d-a.length);h?(i=new Uint8Array(d-u)).set(a.subarray(e+u,a.length),0):i=a.subarray(e+u,e+d);var f={unit:i,pts:n};return h||s.samples.push(f),{sample:f,length:d,missing:h}}var c=a.length-e;return(i=new Uint8Array(c)).set(a.subarray(e,a.length),0),{sample:{unit:i,pts:n},length:c,missing:-1}}var Ya=function(s){function a(t,r){var i;return(i=s.call(this)||this).observer=void 0,i.config=void 0,i.observer=t,i.config=r,i}Ee(a,s);var e=a.prototype;return e.resetInitSegment=function(t,r,i,n){s.prototype.resetInitSegment.call(this,t,r,i,n),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:r,duration:n,inputTimeScale:9e4,dropped:0}},a.probe=function(t){if(!t)return!1;for(var r=(ot(t,0)||[]).length,i=t.length;r<i;r++)if(Va(t,r))return L.log("ADTS sync word found !"),!0;return!1},e.canParse=function(t,r){return function(i,n){return function(o,l){return l+5<o.length}(i,n)&&hi(i,n)&&Qt(i,n)<=i.length-n}(t,r)},e.appendFrame=function(t,r,i){ci(t,this.observer,r,i,t.manifestCodec);var n=gi(t,r,i,this.basePTS,this.frameIndex);if(n&&n.missing===0)return n},a}(di),Wa=/\/emsg[-/]ID3/i,ja=function(){function s(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}var a=s.prototype;return a.resetTimeStamp=function(){},a.resetInitSegment=function(e,t,r,i){var n=this.videoTrack=pe("video",1),o=this.audioTrack=pe("audio",1),l=this.txtTrack=pe("text",1);if(this.id3Track=pe("id3",1),this.timeOffset=0,e!=null&&e.byteLength){var u=kr(e);if(u.video){var d=u.video,h=d.id,f=d.timescale,c=d.codec;n.id=h,n.timescale=l.timescale=f,n.codec=c}if(u.audio){var g=u.audio,m=g.id,y=g.timescale,v=g.codec;o.id=m,o.timescale=y,o.codec=v}l.id=Rr.text,n.sampleDuration=0,n.duration=o.duration=i}},a.resetContiguity=function(){this.remainderData=null},s.probe=function(e){return Y(e=e.length>16384?e.subarray(0,16384):e,["moof"]).length>0},a.demux=function(e,t){this.timeOffset=t;var r=e,i=this.videoTrack,n=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=Ue(this.remainderData,e));var o=function(u){var d={valid:null,remainder:null},h=Y(u,["moof"]);if(!h)return d;if(h.length<2)return d.remainder=u,d;var f=h[h.length-1];return d.valid=Ie(u,0,f.byteOffset-8),d.remainder=Ie(u,f.byteOffset-8),d}(r);this.remainderData=o.remainder,i.samples=o.valid||new Uint8Array}else i.samples=r;var l=this.extractID3Track(i,t);return n.samples=Dr(t,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:l,textTrack:this.txtTrack}},a.flush=function(){var e=this.timeOffset,t=this.videoTrack,r=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;var i=this.extractID3Track(t,this.timeOffset);return r.samples=Dr(e,t),{videoTrack:t,audioTrack:pe(),id3Track:i,textTrack:pe()}},a.extractID3Track=function(e,t){var r=this.id3Track;if(e.samples.length){var i=Y(e.samples,["emsg"]);i&&i.forEach(function(n){var o=function(h){var f=h[0],c="",g="",m=0,y=0,v=0,p=0,S=0,T=0;if(f===0){for(;J(h.subarray(T,T+1))!=="\0";)c+=J(h.subarray(T,T+1)),T+=1;for(c+=J(h.subarray(T,T+1)),T+=1;J(h.subarray(T,T+1))!=="\0";)g+=J(h.subarray(T,T+1)),T+=1;g+=J(h.subarray(T,T+1)),T+=1,m=N(h,12),y=N(h,16),p=N(h,20),S=N(h,24),T=28}else if(f===1){m=N(h,T+=4);var R=N(h,T+=4),b=N(h,T+=4);for(T+=4,v=Math.pow(2,32)*R+b,Yi(v)||(v=Number.MAX_SAFE_INTEGER,L.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),p=N(h,T),S=N(h,T+=4),T+=4;J(h.subarray(T,T+1))!=="\0";)c+=J(h.subarray(T,T+1)),T+=1;for(c+=J(h.subarray(T,T+1)),T+=1;J(h.subarray(T,T+1))!=="\0";)g+=J(h.subarray(T,T+1)),T+=1;g+=J(h.subarray(T,T+1)),T+=1}return{schemeIdUri:c,value:g,timeScale:m,presentationTime:v,presentationTimeDelta:y,eventDuration:p,id:S,payload:h.subarray(T,h.byteLength)}}(n);if(Wa.test(o.schemeIdUri)){var l=F(o.presentationTime)?o.presentationTime/o.timeScale:t+o.presentationTimeDelta/o.timeScale,u=o.eventDuration===4294967295?Number.POSITIVE_INFINITY:o.eventDuration/o.timeScale;u<=.001&&(u=Number.POSITIVE_INFINITY);var d=o.payload;r.samples.push({data:d,len:d.byteLength,dts:l,pts:l,type:Qe,duration:u})}})}return r},a.demuxSampleAes=function(e,t,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},a.destroy=function(){},s}(),Et=null,qa=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],Xa=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],za=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],Qa=[0,1,1,4];function mi(s,a,e,t,r){if(!(e+24>a.length)){var i=pi(a,e);if(i&&e+i.frameLength<=a.length){var n=t+r*(9e4*i.samplesPerFrame/i.sampleRate),o={unit:a.subarray(e,e+i.frameLength),pts:n,dts:n};return s.config=[],s.channelCount=i.channelCount,s.samplerate=i.sampleRate,s.samples.push(o),{sample:o,length:i.frameLength,missing:0}}}}function pi(s,a){var e=s[a+1]>>3&3,t=s[a+1]>>1&3,r=s[a+2]>>4&15,i=s[a+2]>>2&3;if(e!==1&&r!==0&&r!==15&&i!==3){var n=s[a+2]>>1&1,o=s[a+3]>>6,l=1e3*qa[14*(e===3?3-t:t===3?3:4)+r-1],u=Xa[3*(e===3?0:e===2?1:2)+i],d=o===3?1:2,h=za[e][t],f=Qa[t],c=8*h*f,g=Math.floor(h*l/u+n)*f;if(Et===null){var m=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Et=m?parseInt(m[1]):0}return Et&&Et<=87&&t===2&&l>=224e3&&o===0&&(s[a+3]=128|s[a+3]),{sampleRate:u,channelCount:d,frameLength:g,samplesPerFrame:c}}}function Zt(s,a){return s[a]===255&&(224&s[a+1])==224&&(6&s[a+1])!=0}function yi(s,a){return a+1<s.length&&Zt(s,a)}function Za(s,a){if(a+1<s.length&&Zt(s,a)){var e=pi(s,a),t=4;e!=null&&e.frameLength&&(t=e.frameLength);var r=a+t;return r===s.length||yi(s,r)}return!1}var Ei=function(){function s(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}var a=s.prototype;return a.loadWord=function(){var e=this.data,t=this.bytesAvailable,r=e.byteLength-t,i=new Uint8Array(4),n=Math.min(4,t);if(n===0)throw new Error("no bytes available");i.set(e.subarray(r,r+n)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*n,this.bytesAvailable-=n},a.skipBits=function(e){var t;e=Math.min(e,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,e-=(t=e>>3)<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)},a.readBits=function(e){var t=Math.min(this.bitsAvailable,e),r=this.word>>>32-t;if(e>32&&L.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return(t=e-t)>0&&this.bitsAvailable?r<<t|this.readBits(t):r},a.skipLZ=function(){var e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()},a.skipUEG=function(){this.skipBits(1+this.skipLZ())},a.skipEG=function(){this.skipBits(1+this.skipLZ())},a.readUEG=function(){var e=this.skipLZ();return this.readBits(e+1)-1},a.readEG=function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)},a.readBoolean=function(){return this.readBits(1)===1},a.readUByte=function(){return this.readBits(8)},a.readUShort=function(){return this.readBits(16)},a.readUInt=function(){return this.readBits(32)},a.skipScalingList=function(e){for(var t=8,r=8,i=0;i<e;i++)r!==0&&(r=(t+this.readEG()+256)%256),t=r===0?t:r},a.readSPS=function(){var e,t,r,i=0,n=0,o=0,l=0,u=this.readUByte.bind(this),d=this.readBits.bind(this),h=this.readUEG.bind(this),f=this.readBoolean.bind(this),c=this.skipBits.bind(this),g=this.skipEG.bind(this),m=this.skipUEG.bind(this),y=this.skipScalingList.bind(this);u();var v=u();if(d(5),c(3),u(),m(),v===100||v===110||v===122||v===244||v===44||v===83||v===86||v===118||v===128){var p=h();if(p===3&&c(1),m(),m(),c(1),f())for(t=p!==3?8:12,r=0;r<t;r++)f()&&y(r<6?16:64)}m();var S=h();if(S===0)h();else if(S===1)for(c(1),g(),g(),e=h(),r=0;r<e;r++)g();m(),c(1);var T=h(),R=h(),b=d(1);b===0&&c(1),c(1),f()&&(i=h(),n=h(),o=h(),l=h());var A=[1,1];if(f()&&f())switch(u()){case 1:A=[1,1];break;case 2:A=[12,11];break;case 3:A=[10,11];break;case 4:A=[16,11];break;case 5:A=[40,33];break;case 6:A=[24,11];break;case 7:A=[20,11];break;case 8:A=[32,11];break;case 9:A=[80,33];break;case 10:A=[18,11];break;case 11:A=[15,11];break;case 12:A=[64,33];break;case 13:A=[160,99];break;case 14:A=[4,3];break;case 15:A=[3,2];break;case 16:A=[2,1];break;case 255:A=[u()<<8|u(),u()<<8|u()]}return{width:Math.ceil(16*(T+1)-2*i-2*n),height:(2-b)*(R+1)*16-(b?2:4)*(o+l),pixelRatio:A}},a.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},s}(),$a=function(){function s(e,t,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new qt(t,{removePKCS7Padding:!1})}var a=s.prototype;return a.decryptBuffer=function(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer)},a.decryptAacSample=function(e,t,r){var i=this,n=e[t].unit;if(!(n.length<=16)){var o=n.subarray(16,n.length-n.length%16),l=o.buffer.slice(o.byteOffset,o.byteOffset+o.length);this.decryptBuffer(l).then(function(u){var d=new Uint8Array(u);n.set(d,16),i.decrypter.isSync()||i.decryptAacSamples(e,t+1,r)})}},a.decryptAacSamples=function(e,t,r){for(;;t++){if(t>=e.length)return void r();if(!(e[t].unit.length<32||(this.decryptAacSample(e,t,r),this.decrypter.isSync())))return}},a.getAvcEncryptedData=function(e){for(var t=16*Math.floor((e.length-48)/160)+16,r=new Int8Array(t),i=0,n=32;n<e.length-16;n+=160,i+=16)r.set(e.subarray(n,n+16),i);return r},a.getAvcDecryptedUnit=function(e,t){for(var r=new Uint8Array(t),i=0,n=32;n<e.length-16;n+=160,i+=16)e.set(r.subarray(i,i+16),n);return e},a.decryptAvcSample=function(e,t,r,i,n){var o=this,l=xr(n.data),u=this.getAvcEncryptedData(l);this.decryptBuffer(u.buffer).then(function(d){n.data=o.getAvcDecryptedUnit(l,d),o.decrypter.isSync()||o.decryptAvcSamples(e,t,r+1,i)})},a.decryptAvcSamples=function(e,t,r,i){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,r=0){if(t>=e.length)return void i();for(var n=e[t].units;!(r>=n.length);r++){var o=n[r];if(!(o.data.length<=48||o.type!==1&&o.type!==5||(this.decryptAvcSample(e,t,r,i,o),this.decrypter.isSync())))return}}},s}(),ae=188,Ja=function(){function s(e,t,r){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=e,this.config=t,this.typeSupported=r}s.probe=function(e){var t=s.syncOffset(e);return t>0&&L.warn("MPEG2-TS detected but first sync word found @ offset "+t),t!==-1},s.syncOffset=function(e){for(var t=e.length,r=Math.min(940,e.length-ae)+1,i=0;i<r;){for(var n=!1,o=-1,l=0,u=i;u<t;u+=ae){if(e[u]!==71){if(l)return-1;break}if(l++,o===-1&&(o=u)!==0&&(r=Math.min(o+18612,e.length-ae)+1),n||(n=$t(e,u)===0),n&&l>1&&(o===0&&l>2||u+ae>r))return o}i++}return-1},s.createTrack=function(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:Rr[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}};var a=s.prototype;return a.resetInitSegment=function(e,t,r,i){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=s.createTrack("video"),this._audioTrack=s.createTrack("audio",i),this._id3Track=s.createTrack("id3"),this._txtTrack=s.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=r,this._duration=i},a.resetTimeStamp=function(){},a.resetContiguity=function(){var e=this._audioTrack,t=this._avcTrack,r=this._id3Track;e&&(e.pesData=null),t&&(t.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null},a.demux=function(e,t,r,i){var n;r===void 0&&(r=!1),i===void 0&&(i=!1),r||(this.sampleAes=null);var o=this._avcTrack,l=this._audioTrack,u=this._id3Track,d=this._txtTrack,h=o.pid,f=o.pesData,c=l.pid,g=u.pid,m=l.pesData,y=u.pesData,v=null,p=this.pmtParsed,S=this._pmtId,T=e.length;if(this.remainderData&&(T=(e=Ue(this.remainderData,e)).length,this.remainderData=null),T<ae&&!i)return this.remainderData=e,{audioTrack:l,videoTrack:o,id3Track:u,textTrack:d};var R=Math.max(0,s.syncOffset(e));(T-=(T-R)%ae)<e.byteLength&&!i&&(this.remainderData=new Uint8Array(e.buffer,T,e.buffer.byteLength-T));for(var b=0,A=R;A<T;A+=ae)if(e[A]===71){var _=!!(64&e[A+1]),x=$t(e,A),D=void 0;if((48&e[A+3])>>4>1){if((D=A+5+e[A+4])===A+ae)continue}else D=A+4;switch(x){case h:_&&(f&&(n=Ve(f))&&this.parseAVCPES(o,d,n,!1),f={data:[],size:0}),f&&(f.data.push(e.subarray(D,A+ae)),f.size+=A+ae-D);break;case c:if(_){if(m&&(n=Ve(m)))switch(l.segmentCodec){case"aac":this.parseAACPES(l,n);break;case"mp3":this.parseMPEGPES(l,n)}m={data:[],size:0}}m&&(m.data.push(e.subarray(D,A+ae)),m.size+=A+ae-D);break;case g:_&&(y&&(n=Ve(y))&&this.parseID3PES(u,n),y={data:[],size:0}),y&&(y.data.push(e.subarray(D,A+ae)),y.size+=A+ae-D);break;case 0:_&&(D+=e[D]+1),S=this._pmtId=en(e,D);break;case S:_&&(D+=e[D]+1);var I=tn(e,D,this.typeSupported,r);(h=I.avc)>0&&(o.pid=h),(c=I.audio)>0&&(l.pid=c,l.segmentCodec=I.segmentCodec),(g=I.id3)>0&&(u.pid=g),v===null||p||(L.warn("MPEG-TS PMT found at "+A+" after unknown PID '"+v+"'. Backtracking to sync byte @"+R+" to parse all TS packets."),v=null,A=R-188),p=this.pmtParsed=!0;break;case 17:case 8191:break;default:v=x}}else b++;if(b>0){var w=new Error("Found "+b+" TS packet/s that do not start with 0x47");this.observer.emit(E.ERROR,E.ERROR,{type:K.MEDIA_ERROR,details:k.FRAG_PARSING_ERROR,fatal:!1,error:w,reason:w.message})}o.pesData=f,l.pesData=m,u.pesData=y;var O={audioTrack:l,videoTrack:o,id3Track:u,textTrack:d};return i&&this.extractRemainingSamples(O),O},a.flush=function(){var e,t=this.remainderData;return this.remainderData=null,e=t?this.demux(t,-1,!1,!0):{videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(e),this.sampleAes?this.decrypt(e,this.sampleAes):e},a.extractRemainingSamples=function(e){var t,r=e.audioTrack,i=e.videoTrack,n=e.id3Track,o=e.textTrack,l=i.pesData,u=r.pesData,d=n.pesData;if(l&&(t=Ve(l))?(this.parseAVCPES(i,o,t,!0),i.pesData=null):i.pesData=l,u&&(t=Ve(u))){switch(r.segmentCodec){case"aac":this.parseAACPES(r,t);break;case"mp3":this.parseMPEGPES(r,t)}r.pesData=null}else u!=null&&u.size&&L.log("last AAC PES packet truncated,might overlap between fragments"),r.pesData=u;d&&(t=Ve(d))?(this.parseID3PES(n,t),n.pesData=null):n.pesData=d},a.demuxSampleAes=function(e,t,r){var i=this.demux(e,r,!0,!this.config.progressive),n=this.sampleAes=new $a(this.observer,this.config,t);return this.decrypt(i,n)},a.decrypt=function(e,t){return new Promise(function(r){var i=e.audioTrack,n=e.videoTrack;i.samples&&i.segmentCodec==="aac"?t.decryptAacSamples(i.samples,0,function(){n.samples?t.decryptAvcSamples(n.samples,0,0,function(){r(e)}):r(e)}):n.samples&&t.decryptAvcSamples(n.samples,0,0,function(){r(e)})})},a.destroy=function(){this._duration=0},a.parseAVCPES=function(e,t,r,i){var n,o=this,l=this.parseAVCNALu(e,r.data),u=this.avcSample,d=!1;r.data=null,u&&l.length&&!e.audFound&&(rt(u,e),u=this.avcSample=Tt(!1,r.pts,r.dts,"")),l.forEach(function(h){var f;switch(h.type){case 1:var c=!1;n=!0;var g,m=h.data;if(d&&m.length>4){var y=new Ei(m).readSliceType();y!==2&&y!==4&&y!==7&&y!==9||(c=!0)}c&&(g=u)!=null&&g.frame&&!u.key&&(rt(u,e),u=o.avcSample=null),u||(u=o.avcSample=Tt(!0,r.pts,r.dts,"")),u.frame=!0,u.key=c;break;case 5:n=!0,(f=u)!=null&&f.frame&&!u.key&&(rt(u,e),u=o.avcSample=null),u||(u=o.avcSample=Tt(!0,r.pts,r.dts,"")),u.key=!0,u.frame=!0;break;case 6:n=!0,_r(h.data,1,r.pts,t.samples);break;case 7:if(n=!0,d=!0,!e.sps){var v=h.data,p=new Ei(v).readSPS();e.width=p.width,e.height=p.height,e.pixelRatio=p.pixelRatio,e.sps=[v],e.duration=o._duration;for(var S=v.subarray(1,4),T="avc1.",R=0;R<3;R++){var b=S[R].toString(16);b.length<2&&(b="0"+b),T+=b}e.codec=T}break;case 8:n=!0,e.pps||(e.pps=[h.data]);break;case 9:n=!1,e.audFound=!0,u&&rt(u,e),u=o.avcSample=Tt(!1,r.pts,r.dts,"");break;case 12:n=!0;break;default:n=!1,u&&(u.debug+="unknown NAL "+h.type+" ")}u&&n&&u.units.push(h)}),i&&u&&(rt(u,e),this.avcSample=null)},a.getLastNalUnit=function(e){var t,r,i=this.avcSample;if(i&&i.units.length!==0||(i=e[e.length-1]),(t=i)!=null&&t.units){var n=i.units;r=n[n.length-1]}return r},a.parseAVCNALu=function(e,t){var r,i,n=t.byteLength,o=e.naluState||0,l=o,u=[],d=0,h=-1,f=0;for(o===-1&&(h=0,f=31&t[0],o=0,d=1);d<n;)if(r=t[d++],o)if(o!==1)if(r)if(r===1){if(h>=0){var c={data:t.subarray(h,d-o-1),type:f};u.push(c)}else{var g=this.getLastNalUnit(e.samples);if(g&&(l&&d<=4-l&&g.state&&(g.data=g.data.subarray(0,g.data.byteLength-l)),(i=d-o-1)>0)){var m=new Uint8Array(g.data.byteLength+i);m.set(g.data,0),m.set(t.subarray(0,i),g.data.byteLength),g.data=m,g.state=0}}d<n?(h=d,f=31&t[d],o=0):o=-1}else o=0;else o=3;else o=r?0:2;else o=r?0:1;if(h>=0&&o>=0){var y={data:t.subarray(h,n),type:f,state:o};u.push(y)}if(u.length===0){var v=this.getLastNalUnit(e.samples);if(v){var p=new Uint8Array(v.data.byteLength+t.byteLength);p.set(v.data,0),p.set(t,v.data.byteLength),v.data=p}}return e.naluState=o,u},a.parseAACPES=function(e,t){var r,i,n,o=0,l=this.aacOverFlow,u=t.data;if(l){this.aacOverFlow=null;var d=l.missing,h=l.sample.unit.byteLength;if(d===-1){var f=new Uint8Array(h+u.byteLength);f.set(l.sample.unit,0),f.set(u,h),u=f}else{var c=h-d;l.sample.unit.set(u.subarray(0,d),c),e.samples.push(l.sample),o=l.missing}}for(r=o,i=u.length;r<i-1&&!yt(u,r);r++);if(r!==o){var g,m=r<i-1;g=m?"AAC PES did not start with ADTS header,offset:"+r:"No ADTS header found in AAC PES";var y=new Error(g);if(L.warn("parsing error: "+g),this.observer.emit(E.ERROR,E.ERROR,{type:K.MEDIA_ERROR,details:k.FRAG_PARSING_ERROR,fatal:!1,levelRetry:m,error:y,reason:g}),!m)return}if(ci(e,this.observer,u,r,this.audioCodec),t.pts!==void 0)n=t.pts;else{if(!l)return void L.warn("[tsdemuxer]: AAC PES unknown PTS");var v=vi(e.samplerate);n=l.sample.pts+v}for(var p,S=0;r<i;){if(r+=(p=gi(e,u,r,n,S)).length,p.missing){this.aacOverFlow=p;break}for(S++;r<i-1&&!yt(u,r);r++);}},a.parseMPEGPES=function(e,t){var r=t.data,i=r.length,n=0,o=0,l=t.pts;if(l!==void 0)for(;o<i;)if(yi(r,o)){var u=mi(e,r,o,l,n);if(!u)break;o+=u.length,n++}else o++;else L.warn("[tsdemuxer]: MPEG PES unknown PTS")},a.parseID3PES=function(e,t){if(t.pts!==void 0){var r=oe({},t,{type:this._avcTrack?Qe:ze,duration:Number.POSITIVE_INFINITY});e.samples.push(r)}else L.warn("[tsdemuxer]: ID3 PES unknown PTS")},s}();function Tt(s,a,e,t){return{key:s,frame:!1,pts:a,dts:e,units:[],debug:t,length:0}}function $t(s,a){return((31&s[a+1])<<8)+s[a+2]}function en(s,a){return(31&s[a+10])<<8|s[a+11]}function tn(s,a,e,t){var r={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},i=a+3+((15&s[a+1])<<8|s[a+2])-4;for(a+=12+((15&s[a+10])<<8|s[a+11]);a<i;){var n=$t(s,a);switch(s[a]){case 207:if(!t){L.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:r.audio===-1&&(r.audio=n);break;case 21:r.id3===-1&&(r.id3=n);break;case 219:if(!t){L.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:r.avc===-1&&(r.avc=n);break;case 3:case 4:e.mpeg!==!0&&e.mp3!==!0?L.log("MPEG audio found, not supported in this browser"):r.audio===-1&&(r.audio=n,r.segmentCodec="mp3");break;case 36:L.warn("Unsupported HEVC stream type found")}a+=5+((15&s[a+3])<<8|s[a+4])}return r}function Ve(s){var a,e,t,r,i,n=0,o=s.data;if(!s||s.size===0)return null;for(;o[0].length<19&&o.length>1;){var l=new Uint8Array(o[0].length+o[1].length);l.set(o[0]),l.set(o[1],o[0].length),o[0]=l,o.splice(1,1)}if(((a=o[0])[0]<<16)+(a[1]<<8)+a[2]===1){if((e=(a[4]<<8)+a[5])&&e>s.size-6)return null;var u=a[7];192&u&&(r=536870912*(14&a[9])+4194304*(255&a[10])+16384*(254&a[11])+128*(255&a[12])+(254&a[13])/2,64&u?r-(i=536870912*(14&a[14])+4194304*(255&a[15])+16384*(254&a[16])+128*(255&a[17])+(254&a[18])/2)>54e5&&(L.warn(Math.round((r-i)/9e4)+"s delta between PTS and DTS, align them"),r=i):i=r);var d=(t=a[8])+9;if(s.size<=d)return null;s.size-=d;for(var h=new Uint8Array(s.size),f=0,c=o.length;f<c;f++){var g=(a=o[f]).byteLength;if(d){if(d>g){d-=g;continue}a=a.subarray(d),g-=d,d=0}h.set(a,n),n+=g}return e&&(e-=t+3),{data:h,pts:r,dts:i,len:e}}return null}function rt(s,a){if(s.units.length&&s.frame){if(s.pts===void 0){var e=a.samples,t=e.length;if(!t)return void a.dropped++;var r=e[t-1];s.pts=r.pts,s.dts=r.dts}a.samples.push(s)}s.debug.length&&L.log(s.pts+"/"+s.dts+":"+s.debug)}var rn=function(s){function a(){return s.apply(this,arguments)||this}Ee(a,s);var e=a.prototype;return e.resetInitSegment=function(t,r,i,n){s.prototype.resetInitSegment.call(this,t,r,i,n),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:r,duration:n,inputTimeScale:9e4,dropped:0}},a.probe=function(t){if(!t)return!1;for(var r=(ot(t,0)||[]).length,i=t.length;r<i;r++)if(Za(t,r))return L.log("MPEG Audio sync word found !"),!0;return!1},e.canParse=function(t,r){return function(i,n){return Zt(i,n)&&4<=i.length-n}(t,r)},e.appendFrame=function(t,r,i){if(this.basePTS!==null)return mi(t,r,i,this.basePTS,this.frameIndex)},a}(di),Ti=function(){function s(){}return s.getSilentFrame=function(a,e){if(a==="mp4a.40.2"){if(e===1)return new Uint8Array([0,200,0,128,35,128]);if(e===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(e===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(e===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(e===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(e===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(e===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(e===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(e===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},s}(),_e=Math.pow(2,32)-1,Z=function(){function s(){}return s.init=function(){var a;for(a in s.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},s.types)s.types.hasOwnProperty(a)&&(s.types[a]=[a.charCodeAt(0),a.charCodeAt(1),a.charCodeAt(2),a.charCodeAt(3)]);var e=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),t=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);s.HDLR_TYPES={video:e,audio:t};var r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i=new Uint8Array([0,0,0,0,0,0,0,0]);s.STTS=s.STSC=s.STCO=i,s.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),s.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),s.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),s.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var n=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);s.FTYP=s.box(s.types.ftyp,n,l,n,o),s.DINF=s.box(s.types.dinf,s.box(s.types.dref,r))},s.box=function(a){for(var e=8,t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];for(var n=r.length,o=n;n--;)e+=r[n].byteLength;var l=new Uint8Array(e);for(l[0]=e>>24&255,l[1]=e>>16&255,l[2]=e>>8&255,l[3]=255&e,l.set(a,4),n=0,e=8;n<o;n++)l.set(r[n],e),e+=r[n].byteLength;return l},s.hdlr=function(a){return s.box(s.types.hdlr,s.HDLR_TYPES[a])},s.mdat=function(a){return s.box(s.types.mdat,a)},s.mdhd=function(a,e){e*=a;var t=Math.floor(e/(_e+1)),r=Math.floor(e%(_e+1));return s.box(s.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,a>>24&255,a>>16&255,a>>8&255,255&a,t>>24,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,85,196,0,0]))},s.mdia=function(a){return s.box(s.types.mdia,s.mdhd(a.timescale,a.duration),s.hdlr(a.type),s.minf(a))},s.mfhd=function(a){return s.box(s.types.mfhd,new Uint8Array([0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a]))},s.minf=function(a){return a.type==="audio"?s.box(s.types.minf,s.box(s.types.smhd,s.SMHD),s.DINF,s.stbl(a)):s.box(s.types.minf,s.box(s.types.vmhd,s.VMHD),s.DINF,s.stbl(a))},s.moof=function(a,e,t){return s.box(s.types.moof,s.mfhd(a),s.traf(t,e))},s.moov=function(a){for(var e=a.length,t=[];e--;)t[e]=s.trak(a[e]);return s.box.apply(null,[s.types.moov,s.mvhd(a[0].timescale,a[0].duration)].concat(t).concat(s.mvex(a)))},s.mvex=function(a){for(var e=a.length,t=[];e--;)t[e]=s.trex(a[e]);return s.box.apply(null,[s.types.mvex].concat(t))},s.mvhd=function(a,e){e*=a;var t=Math.floor(e/(_e+1)),r=Math.floor(e%(_e+1)),i=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,a>>24&255,a>>16&255,a>>8&255,255&a,t>>24,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return s.box(s.types.mvhd,i)},s.sdtp=function(a){var e,t,r=a.samples||[],i=new Uint8Array(4+r.length);for(e=0;e<r.length;e++)t=r[e].flags,i[e+4]=t.dependsOn<<4|t.isDependedOn<<2|t.hasRedundancy;return s.box(s.types.sdtp,i)},s.stbl=function(a){return s.box(s.types.stbl,s.stsd(a),s.box(s.types.stts,s.STTS),s.box(s.types.stsc,s.STSC),s.box(s.types.stsz,s.STSZ),s.box(s.types.stco,s.STCO))},s.avc1=function(a){var e,t,r,i=[],n=[];for(e=0;e<a.sps.length;e++)r=(t=a.sps[e]).byteLength,i.push(r>>>8&255),i.push(255&r),i=i.concat(Array.prototype.slice.call(t));for(e=0;e<a.pps.length;e++)r=(t=a.pps[e]).byteLength,n.push(r>>>8&255),n.push(255&r),n=n.concat(Array.prototype.slice.call(t));var o=s.box(s.types.avcC,new Uint8Array([1,i[3],i[4],i[5],255,224|a.sps.length].concat(i).concat([a.pps.length]).concat(n))),l=a.width,u=a.height,d=a.pixelRatio[0],h=a.pixelRatio[1];return s.box(s.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,s.box(s.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),s.box(s.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,255&d,h>>24,h>>16&255,h>>8&255,255&h])))},s.esds=function(a){var e=a.config.length;return new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(a.config).concat([6,1,2]))},s.mp4a=function(a){var e=a.samplerate;return s.box(s.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,a.channelCount,0,16,0,0,0,0,e>>8&255,255&e,0,0]),s.box(s.types.esds,s.esds(a)))},s.mp3=function(a){var e=a.samplerate;return s.box(s.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,a.channelCount,0,16,0,0,0,0,e>>8&255,255&e,0,0]))},s.stsd=function(a){return a.type==="audio"?a.segmentCodec==="mp3"&&a.codec==="mp3"?s.box(s.types.stsd,s.STSD,s.mp3(a)):s.box(s.types.stsd,s.STSD,s.mp4a(a)):s.box(s.types.stsd,s.STSD,s.avc1(a))},s.tkhd=function(a){var e=a.id,t=a.duration*a.timescale,r=a.width,i=a.height,n=Math.floor(t/(_e+1)),o=Math.floor(t%(_e+1));return s.box(s.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,o>>24,o>>16&255,o>>8&255,255&o,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,255&r,0,0,i>>8&255,255&i,0,0]))},s.traf=function(a,e){var t=s.sdtp(a),r=a.id,i=Math.floor(e/(_e+1)),n=Math.floor(e%(_e+1));return s.box(s.types.traf,s.box(s.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r])),s.box(s.types.tfdt,new Uint8Array([1,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,n>>24,n>>16&255,n>>8&255,255&n])),s.trun(a,t.length+16+20+8+16+8+8),t)},s.trak=function(a){return a.duration=a.duration||4294967295,s.box(s.types.trak,s.tkhd(a),s.mdia(a))},s.trex=function(a){var e=a.id;return s.box(s.types.trex,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},s.trun=function(a,e){var t,r,i,n,o,l,u=a.samples||[],d=u.length,h=12+16*d,f=new Uint8Array(h);for(e+=8+h,f.set([a.type==="video"?1:0,0,15,1,d>>>24&255,d>>>16&255,d>>>8&255,255&d,e>>>24&255,e>>>16&255,e>>>8&255,255&e],0),t=0;t<d;t++)i=(r=u[t]).duration,n=r.size,o=r.flags,l=r.cts,f.set([i>>>24&255,i>>>16&255,i>>>8&255,255&i,n>>>24&255,n>>>16&255,n>>>8&255,255&n,o.isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.paddingValue<<1|o.isNonSync,61440&o.degradPrio,15&o.degradPrio,l>>>24&255,l>>>16&255,l>>>8&255,255&l],12+16*t);return s.box(s.types.trun,f)},s.initSegment=function(a){s.types||s.init();var e=s.moov(a),t=new Uint8Array(s.FTYP.byteLength+e.byteLength);return t.set(s.FTYP),t.set(e,s.FTYP.byteLength),t},s}();function it(s,a){return a===void 0&&(a=!1),function(e,t,r,i){r===void 0&&(r=1),i===void 0&&(i=!1);var n=e*t*r;return i?Math.round(n):n}(s,1e3,1/9e4,a)}Z.types=void 0,Z.HDLR_TYPES=void 0,Z.STTS=void 0,Z.STSC=void 0,Z.STCO=void 0,Z.STSZ=void 0,Z.VMHD=void 0,Z.SMHD=void 0,Z.STSD=void 0,Z.FTYP=void 0,Z.DINF=void 0;var St=null,Jt=null,er=function(){function s(e,t,r,i){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=e,this.config=t,this.typeSupported=r,this.ISGenerated=!1,St===null){var n=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);St=n?parseInt(n[1]):0}if(Jt===null){var o=navigator.userAgent.match(/Safari\/(\d+)/i);Jt=o?parseInt(o[1]):0}}var a=s.prototype;return a.destroy=function(){},a.resetTimeStamp=function(e){L.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e},a.resetNextTimestamp=function(){L.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},a.resetInitSegment=function(){L.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},a.getVideoStartPts=function(e){var t=!1,r=e.reduce(function(i,n){var o=n.pts-i;return o<-4294967296?(t=!0,fe(i,n.pts)):o>0?i:n.pts},e[0].pts);return t&&L.debug("PTS rollover detected"),r},a.remux=function(e,t,r,i,n,o,l,u){var d,h,f,c,g,m,y=n,v=n,p=e.pid>-1,S=t.pid>-1,T=t.samples.length,R=e.samples.length>0,b=l&&T>0||T>1;if((!p||R)&&(!S||b)||this.ISGenerated||l){this.ISGenerated||(f=this.generateIS(e,t,n,o));var A,_=this.isVideoContiguous,x=-1;if(b&&(x=function(B){for(var C=0;C<B.length;C++)if(B[C].key)return C;return-1}(t.samples),!_&&this.config.forceKeyFrameOnDiscontinuity))if(m=!0,x>0){L.warn("[mp4-remuxer]: Dropped "+x+" out of "+T+" video samples due to a missing keyframe");var D=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(x),t.dropped+=x,A=v+=(t.samples[0].pts-D)/t.inputTimeScale}else x===-1&&(L.warn("[mp4-remuxer]: No keyframe found out of "+T+" video samples"),m=!1);if(this.ISGenerated){if(R&&b){var I=this.getVideoStartPts(t.samples),w=(fe(e.samples[0].pts,I)-I)/t.inputTimeScale;y+=Math.max(0,w),v+=Math.max(0,-w)}if(R){if(e.samplerate||(L.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),f=this.generateIS(e,t,n,o)),h=this.remuxAudio(e,y,this.isAudioContiguous,o,S||b||u===ht?v:void 0),b){var O=h?h.endPTS-h.startPTS:0;t.inputTimeScale||(L.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),f=this.generateIS(e,t,n,o)),d=this.remuxVideo(t,v,_,O)}}else b&&(d=this.remuxVideo(t,v,_,0));d&&(d.firstKeyFrame=x,d.independent=x!==-1,d.firstKeyFramePTS=A)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(r.samples.length&&(g=Si(r,n,this._initPTS,this._initDTS)),i.samples.length&&(c=Li(i,n,this._initPTS))),{audio:h,video:d,initSegment:f,independent:m,text:c,id3:g}},a.generateIS=function(e,t,r,i){var n,o,l,u=e.samples,d=t.samples,h=this.typeSupported,f={},c=this._initPTS,g=!c||i,m="audio/mp4";if(g&&(n=o=1/0),e.config&&u.length&&(e.timescale=e.samplerate,e.segmentCodec==="mp3"&&(h.mpeg?(m="audio/mpeg",e.codec=""):h.mp3&&(e.codec="mp3")),f.audio={id:"audio",container:m,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&h.mpeg?new Uint8Array(0):Z.initSegment([e]),metadata:{channelCount:e.channelCount}},g&&(l=e.inputTimeScale,c&&l===c.timescale?g=!1:n=o=u[0].pts-Math.round(l*r))),t.sps&&t.pps&&d.length&&(t.timescale=t.inputTimeScale,f.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:Z.initSegment([t]),metadata:{width:t.width,height:t.height}},g))if(l=t.inputTimeScale,c&&l===c.timescale)g=!1;else{var y=this.getVideoStartPts(d),v=Math.round(l*r);o=Math.min(o,fe(d[0].dts,y)-v),n=Math.min(n,y-v)}if(Object.keys(f).length)return this.ISGenerated=!0,g?(this._initPTS={baseTime:n,timescale:l},this._initDTS={baseTime:o,timescale:l}):n=l=void 0,{tracks:f,initPTS:n,timescale:l}},a.remuxVideo=function(e,t,r,i){var n,o,l=e.inputTimeScale,u=e.samples,d=[],h=u.length,f=this._initPTS,c=this.nextAvcDts,g=8,m=this.videoSampleDuration,y=Number.POSITIVE_INFINITY,v=Number.NEGATIVE_INFINITY,p=!1;r&&c!==null||(c=t*l-(u[0].pts-fe(u[0].dts,u[0].pts)));for(var S=f.baseTime*l/f.timescale,T=0;T<h;T++){var R=u[T];R.pts=fe(R.pts-S,c),R.dts=fe(R.dts-S,c),R.dts<u[T>0?T-1:T].dts&&(p=!0)}p&&u.sort(function(At,Ni){var xn=At.dts-Ni.dts,wn=At.pts-Ni.pts;return xn||wn}),n=u[0].dts;var b=(o=u[u.length-1].dts)-n,A=b?Math.round(b/(h-1)):m||e.inputTimeScale/30;if(r){var _=n-c,x=_>A,D=_<-1;if((x||D)&&(x?L.warn("AVC: "+it(_,!0)+" ms ("+_+"dts) hole between fragments detected, filling it"):L.warn("AVC: "+it(-_,!0)+" ms ("+_+"dts) overlapping between fragments detected"),!D||c>=u[0].pts)){n=c;var I=u[0].pts-_;u[0].dts=n,u[0].pts=I,L.log("Video: First PTS/DTS adjusted: "+it(I,!0)+"/"+it(n,!0)+", delta: "+it(_,!0)+" ms")}}n=Math.max(0,n);for(var w=0,O=0,B=0;B<h;B++){for(var C=u[B],U=C.units,M=U.length,P=0,H=0;H<M;H++)P+=U[H].data.length;O+=P,w+=M,C.length=P,C.dts=Math.max(C.dts,n),y=Math.min(C.pts,y),v=Math.max(C.pts,v)}o=u[h-1].dts;var V,G=O+4*w+8;try{V=new Uint8Array(G)}catch(At){return void this.observer.emit(E.ERROR,E.ERROR,{type:K.MUX_ERROR,details:k.REMUX_ALLOC_ERROR,fatal:!1,error:At,bytes:G,reason:"fail allocating video mdat "+G})}var q=new DataView(V.buffer);q.setUint32(0,G),V.set(Z.types.mdat,4);for(var te=!1,re=Number.POSITIVE_INFINITY,ce=Number.POSITIVE_INFINITY,le=Number.NEGATIVE_INFINITY,ue=Number.NEGATIVE_INFINITY,z=0;z<h;z++){for(var ee=u[z],ve=ee.units,Me=0,ne=0,Lt=ve.length;ne<Lt;ne++){var at=ve[ne],Rt=at.data,We=at.data.byteLength;q.setUint32(g,We),g+=4,V.set(Rt,g),g+=We,Me+=4+We}var Ne=void 0;if(z<h-1)m=u[z+1].dts-ee.dts,Ne=u[z+1].pts-ee.pts;else{var Be=this.config,bt=z>0?ee.dts-u[z-1].dts:A;if(Ne=z>0?ee.pts-u[z-1].pts:A,Be.stretchShortVideoTrack&&this.nextAudioPts!==null){var bn=Math.floor(Be.maxBufferHole*l),lr=(i?y+i*l:this.nextAudioPts)-ee.pts;lr>bn?((m=lr-bt)<0?m=bt:te=!0,L.log("[mp4-remuxer]: It is approximately "+lr/90+" ms to the next segment; using duration "+m/90+" ms for the last video frame.")):m=bt}else m=bt}var An=Math.round(ee.pts-ee.dts);re=Math.min(re,m),le=Math.max(le,m),ce=Math.min(ce,Ne),ue=Math.max(ue,Ne),d.push(new Ri(ee.key,m,Me,An))}if(d.length){if(St){if(St<70){var Fi=d[0].flags;Fi.dependsOn=2,Fi.isNonSync=0}}else if(Jt&&ue-ce<le-re&&A/le<.025&&d[0].cts===0){L.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var ur=n,ge=0,Oi=d.length;ge<Oi;ge++){var Mi=ur+d[ge].duration,kn=ur+d[ge].cts;if(ge<Oi-1){var Dn=Mi+d[ge+1].cts;d[ge].duration=Dn-kn}else d[ge].duration=ge?d[ge-1].duration:A;d[ge].cts=0,ur=Mi}}}m=te||!m?A:m,this.nextAvcDts=c=o+m,this.videoSampleDuration=m,this.isVideoContiguous=!0;var _n={data1:Z.moof(e.sequenceNumber++,n,oe({},e,{samples:d})),data2:V,startPTS:y/l,endPTS:(v+m)/l,startDTS:n/l,endDTS:c/l,type:"video",hasAudio:!1,hasVideo:!0,nb:d.length,dropped:e.dropped};return e.samples=[],e.dropped=0,_n},a.remuxAudio=function(e,t,r,i,n){var o=e.inputTimeScale,l=o/(e.samplerate?e.samplerate:o),u=e.segmentCodec==="aac"?1024:1152,d=u*l,h=this._initPTS,f=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,c=[],g=n!==void 0,m=e.samples,y=f?0:8,v=this.nextAudioPts||-1,p=t*o,S=h.baseTime*o/h.timescale;if(this.isAudioContiguous=r=r||m.length&&v>0&&(i&&Math.abs(p-v)<9e3||Math.abs(fe(m[0].pts-S,p)-v)<20*d),m.forEach(function(ne){ne.pts=fe(ne.pts-S,p)}),!r||v<0){if(m=m.filter(function(ne){return ne.pts>=0}),!m.length)return;v=n===0?0:i&&!g?Math.max(0,p):m[0].pts}if(e.segmentCodec==="aac")for(var T=this.config.maxAudioFramesDrift,R=0,b=v;R<m.length;R++){var A=m[R],_=A.pts,x=_-b,D=Math.abs(1e3*x/o);if(x<=-T*d&&g)R===0&&(L.warn("Audio frame @ "+(_/o).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*x/o)+" ms."),this.nextAudioPts=v=b=_);else if(x>=T*d&&D<1e4&&g){var I=Math.round(x/d);(b=_-I*d)<0&&(I--,b+=d),R===0&&(this.nextAudioPts=v=b),L.warn("[mp4-remuxer]: Injecting "+I+" audio frame @ "+(b/o).toFixed(3)+"s due to "+Math.round(1e3*x/o)+" ms gap.");for(var w=0;w<I;w++){var O=Math.max(b,0),B=Ti.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);B||(L.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),B=A.unit.subarray()),m.splice(R,0,{unit:B,pts:O}),b+=d,R++}}A.pts=b,b+=d}for(var C,U=null,M=null,P=0,H=m.length;H--;)P+=m[H].unit.byteLength;for(var V=0,G=m.length;V<G;V++){var q=m[V],te=q.unit,re=q.pts;if(M!==null)c[V-1].duration=Math.round((re-M)/l);else{if(r&&e.segmentCodec==="aac"&&(re=v),U=re,!(P>0))return;P+=y;try{C=new Uint8Array(P)}catch(ne){return void this.observer.emit(E.ERROR,E.ERROR,{type:K.MUX_ERROR,details:k.REMUX_ALLOC_ERROR,fatal:!1,error:ne,bytes:P,reason:"fail allocating audio mdat "+P})}f||(new DataView(C.buffer).setUint32(0,P),C.set(Z.types.mdat,4))}C.set(te,y);var ce=te.byteLength;y+=ce,c.push(new Ri(!0,u,ce,0)),M=re}var le=c.length;if(le){var ue=c[c.length-1];this.nextAudioPts=v=M+l*ue.duration;var z=f?new Uint8Array(0):Z.moof(e.sequenceNumber++,U/l,oe({},e,{samples:c}));e.samples=[];var ee=U/o,ve=v/o,Me={data1:z,data2:C,startPTS:ee,endPTS:ve,startDTS:ee,endDTS:ve,type:"audio",hasAudio:!0,hasVideo:!1,nb:le};return this.isAudioContiguous=!0,Me}},a.remuxEmptyAudio=function(e,t,r,i){var n=e.inputTimeScale,o=n/(e.samplerate?e.samplerate:n),l=this.nextAudioPts,u=this._initDTS,d=9e4*u.baseTime/u.timescale,h=(l!==null?l:i.startDTS*n)+d,f=i.endDTS*n+d,c=1024*o,g=Math.ceil((f-h)/c),m=Ti.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(L.warn("[mp4-remuxer]: remux empty Audio"),m){for(var y=[],v=0;v<g;v++){var p=h+v*c;y.push({unit:m,pts:p,dts:p})}return e.samples=y,this.remuxAudio(e,t,r,!1)}L.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},s}();function fe(s,a){var e;if(a===null)return s;for(e=a<s?-8589934592:8589934592;Math.abs(s-a)>4294967296;)s+=e;return s}function Si(s,a,e,t){var r=s.samples.length;if(r){for(var i=s.inputTimeScale,n=0;n<r;n++){var o=s.samples[n];o.pts=fe(o.pts-e.baseTime*i/e.timescale,a*i)/i,o.dts=fe(o.dts-t.baseTime*i/t.timescale,a*i)/i}var l=s.samples;return s.samples=[],{samples:l}}}function Li(s,a,e){var t=s.samples.length;if(t){for(var r=s.inputTimeScale,i=0;i<t;i++){var n=s.samples[i];n.pts=fe(n.pts-e.baseTime*r/e.timescale,a*r)/r}s.samples.sort(function(l,u){return l.pts-u.pts});var o=s.samples;return s.samples=[],{samples:o}}}var Le,Ri=function(s,a,e,t){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=a,this.size=e,this.cts=t,this.flags=new an(s)},an=function(s){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=s?2:1,this.isNonSync=s?0:1},nn=function(){function s(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}var a=s.prototype;return a.destroy=function(){},a.resetTimeStamp=function(e){this.initPTS=e,this.lastEndTime=null},a.resetNextTimestamp=function(){this.lastEndTime=null},a.resetInitSegment=function(e,t,r,i){this.audioCodec=t,this.videoCodec=r,this.generateInitSegment(la(e,i)),this.emitInitSegment=!0},a.generateInitSegment=function(e){var t=this.audioCodec,r=this.videoCodec;if(e==null||!e.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var i=this.initData=kr(e);t||(t=bi(i.audio,me)),r||(r=bi(i.video,he));var n={};i.audio&&i.video?n.audiovideo={container:"video/mp4",codec:t+","+r,initSegment:e,id:"main"}:i.audio?n.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:i.video?n.video={container:"video/mp4",codec:r,initSegment:e,id:"main"}:L.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=n},a.remux=function(e,t,r,i,n,o){var l,u,d=this.initPTS,h=this.lastEndTime,f={audio:void 0,video:void 0,text:i,id3:r,initSegment:void 0};F(h)||(h=this.lastEndTime=n||0);var c=t.samples;if(c==null||!c.length)return f;var g={initPTS:void 0,timescale:1},m=this.initData;if((l=m)!=null&&l.length||(this.generateInitSegment(c),m=this.initData),(u=m)==null||!u.length)return L.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),f;this.emitInitSegment&&(g.tracks=this.initTracks,this.emitInitSegment=!1);var y=function(x,D){for(var I=0,w=0,O=0,B=Y(x,["moof","traf"]),C=0;C<B.length;C++){var U=B[C],M=Y(U,["tfhd"])[0],P=D[N(M,4)];if(P){var H=P.default,V=N(M,0)|H?.flags,G=H?.duration;8&V&&(G=N(M,2&V?12:8));for(var q=P.timescale||9e4,te=Y(U,["trun"]),re=0;re<te.length;re++)!(I=ua(te[re]))&&G&&(I=G*N(te[re],4)),P.type===he?w+=I/q:P.type===me&&(O+=I/q)}}if(w===0&&O===0){for(var ce=0,le=Y(x,["sidx"]),ue=0;ue<le.length;ue++){var z=oa(le[ue]);z!=null&&z.references&&(ce+=z.references.reduce(function(ee,ve){return ee+ve.info.duration||0},0))}return ce}return w||O}(c,m),v=function(x,D){return Y(D,["moof","traf"]).reduce(function(I,w){var O=Y(w,["tfdt"])[0],B=O[0],C=Y(w,["tfhd"]).reduce(function(U,M){var P=N(M,4),H=x[P];if(H){var V=N(O,4);if(B===1){if(V===ut)return L.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),U;V*=ut+1,V+=N(O,8)}var G=V/(H.timescale||9e4);if(F(G)&&(U===null||G<U))return G}return U},null);return C!==null&&F(C)&&(I===null||C<I)?C:I},null)}(m,c),p=v===null?n:v;(function(x,D,I,w){if(x===null)return!0;var O=Math.max(w,1),B=D-x.baseTime/x.timescale;return Math.abs(B-I)>O}(d,p,n,y)||g.timescale!==d.timescale&&o)&&(g.initPTS=p-n,d&&d.timescale===1&&L.warn("Adjusting initPTS by "+(g.initPTS-d.baseTime)),this.initPTS=d={baseTime:g.initPTS,timescale:1});var S=e?p-d.baseTime/d.timescale:h,T=S+y;(function(x,D,I){Y(D,["moof","traf"]).forEach(function(w){Y(w,["tfhd"]).forEach(function(O){var B=N(O,4),C=x[B];if(C){var U=C.timescale||9e4;Y(w,["tfdt"]).forEach(function(M){var P=M[0],H=N(M,4);if(P===0)H-=I*U,Ft(M,4,H=Math.max(H,0));else{H*=Math.pow(2,32),H+=N(M,8),H-=I*U,H=Math.max(H,0);var V=Math.floor(H/(ut+1)),G=Math.floor(H%(ut+1));Ft(M,4,V),Ft(M,8,G)}})}})})})(m,c,d.baseTime/d.timescale),y>0?this.lastEndTime=T:(L.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var R=!!m.audio,b=!!m.video,A="";R&&(A+="audio"),b&&(A+="video");var _={data1:c,startPTS:S,startDTS:S,endPTS:T,endDTS:T,type:A,hasAudio:R,hasVideo:b,nb:1,dropped:0};return f.audio=_.type==="audio"?_:void 0,f.video=_.type!=="audio"?_:void 0,f.initSegment=g,f.id3=Si(r,n,d,d),i.samples.length&&(f.text=Li(i,n,d)),f},s}();function bi(s,a){var e=s?.codec;return e&&e.length>4?e:e==="hvc1"||e==="hev1"?"hvc1.1.6.L120.90":e==="av01"?"av01.0.04M.08":e==="avc1"||a===he?"avc1.42e01e":"mp4a.40.5"}try{Le=self.performance.now.bind(self.performance)}catch{L.debug("Unable to use Performance API on this environment"),Le=typeof self<"u"&&self.Date.now}var tr=[{demux:ja,remux:nn},{demux:Ja,remux:er},{demux:Ya,remux:er},{demux:rn,remux:er}],rr=function(){function s(e,t,r,i,n){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=r,this.vendor=i,this.id=n}var a=s.prototype;return a.configure=function(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()},a.push=function(e,t,r,i){var n=this,o=r.transmuxing;o.executeStart=Le();var l=new Uint8Array(e),u=this.currentTransmuxState,d=this.transmuxConfig;i&&(this.currentTransmuxState=i);var h=i||u,f=h.contiguous,c=h.discontinuity,g=h.trackSwitch,m=h.accurateTimeOffset,y=h.timeOffset,v=h.initSegmentChange,p=d.audioCodec,S=d.videoCodec,T=d.defaultInitPts,R=d.duration,b=d.initSegmentData,A=function(B,C){var U=null;return B.byteLength>0&&C!=null&&C.key!=null&&C.iv!==null&&C.method!=null&&(U=C),U}(l,t);if(A&&A.method==="AES-128"){var _=this.getDecrypter();if(!_.isSync())return this.decryptionPromise=_.webCryptoDecrypt(l,A.key.buffer,A.iv.buffer).then(function(B){var C=n.push(B,null,r);return n.decryptionPromise=null,C}),this.decryptionPromise;var x=_.softwareDecrypt(l,A.key.buffer,A.iv.buffer);if(r.part>-1&&(x=_.flush()),!x)return o.executeEnd=Le(),ir(r);l=new Uint8Array(x)}var D=this.needsProbing(c,g);if(D){var I=this.configureTransmuxer(l);if(I)return L.warn("[transmuxer] "+I.message),this.observer.emit(E.ERROR,E.ERROR,{type:K.MEDIA_ERROR,details:k.FRAG_PARSING_ERROR,fatal:!1,error:I,reason:I.message}),o.executeEnd=Le(),ir(r)}(c||g||v||D)&&this.resetInitSegment(b,p,S,R,t),(c||v||D)&&this.resetInitialTimestamp(T),f||this.resetContiguity();var w=this.transmux(l,A,y,m,r),O=this.currentTransmuxState;return O.contiguous=!0,O.discontinuity=!1,O.trackSwitch=!1,o.executeEnd=Le(),w},a.flush=function(e){var t=this,r=e.transmuxing;r.executeStart=Le();var i=this.decrypter,n=this.currentTransmuxState,o=this.decryptionPromise;if(o)return o.then(function(){return t.flush(e)});var l=[],u=n.timeOffset;if(i){var d=i.flush();d&&l.push(this.push(d,null,e))}var h=this.demuxer,f=this.remuxer;if(!h||!f)return r.executeEnd=Le(),[ir(e)];var c=h.flush(u);return Oe(c)?c.then(function(g){return t.flushRemux(l,g,e),l}):(this.flushRemux(l,c,e),l)},a.flushRemux=function(e,t,r){var i=t.audioTrack,n=t.videoTrack,o=t.id3Track,l=t.textTrack,u=this.currentTransmuxState,d=u.accurateTimeOffset,h=u.timeOffset;L.log("[transmuxer.ts]: Flushed fragment "+r.sn+(r.part>-1?" p: "+r.part:"")+" of level "+r.level);var f=this.remuxer.remux(i,n,o,l,h,d,!0,this.id);e.push({remuxResult:f,chunkMeta:r}),r.transmuxing.executeEnd=Le()},a.resetInitialTimestamp=function(e){var t=this.demuxer,r=this.remuxer;t&&r&&(t.resetTimeStamp(e),r.resetTimeStamp(e))},a.resetContiguity=function(){var e=this.demuxer,t=this.remuxer;e&&t&&(e.resetContiguity(),t.resetNextTimestamp())},a.resetInitSegment=function(e,t,r,i,n){var o=this.demuxer,l=this.remuxer;o&&l&&(o.resetInitSegment(e,t,r,i),l.resetInitSegment(e,t,r,n))},a.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},a.transmux=function(e,t,r,i,n){return t&&t.method==="SAMPLE-AES"?this.transmuxSampleAes(e,t,r,i,n):this.transmuxUnencrypted(e,r,i,n)},a.transmuxUnencrypted=function(e,t,r,i){var n=this.demuxer.demux(e,t,!1,!this.config.progressive),o=n.audioTrack,l=n.videoTrack,u=n.id3Track,d=n.textTrack;return{remuxResult:this.remuxer.remux(o,l,u,d,t,r,!1,this.id),chunkMeta:i}},a.transmuxSampleAes=function(e,t,r,i,n){var o=this;return this.demuxer.demuxSampleAes(e,t,r).then(function(l){return{remuxResult:o.remuxer.remux(l.audioTrack,l.videoTrack,l.id3Track,l.textTrack,r,i,!1,o.id),chunkMeta:n}})},a.configureTransmuxer=function(e){for(var t,r=this.config,i=this.observer,n=this.typeSupported,o=this.vendor,l=0,u=tr.length;l<u;l++)if(tr[l].demux.probe(e)){t=tr[l];break}if(!t)return new Error("Failed to find demuxer by probing fragment data");var d=this.demuxer,h=this.remuxer,f=t.remux,c=t.demux;h&&h instanceof f||(this.remuxer=new f(i,r,n,o)),d&&d instanceof c||(this.demuxer=new c(i,r,n),this.probe=c.probe)},a.needsProbing=function(e,t){return!this.demuxer||!this.remuxer||e||t},a.getDecrypter=function(){var e=this.decrypter;return e||(e=this.decrypter=new qt(this.config)),e},s}(),ir=function(s){return{remuxResult:{},chunkMeta:s}};function Oe(s){return"then"in s&&s.then instanceof Function}var sn=function(s,a,e,t,r){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=s,this.videoCodec=a,this.initSegmentData=e,this.duration=t,this.defaultInitPts=r||null},on=function(s,a,e,t,r,i){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=s,this.contiguous=a,this.accurateTimeOffset=e,this.trackSwitch=t,this.timeOffset=r,this.initSegmentChange=i},Ai={exports:{}};(function(s){var a=Object.prototype.hasOwnProperty,e="~";function t(){}function r(l,u,d){this.fn=l,this.context=u,this.once=d||!1}function i(l,u,d,h,f){if(typeof d!="function")throw new TypeError("The listener must be a function");var c=new r(d,h||l,f),g=e?e+u:u;return l._events[g]?l._events[g].fn?l._events[g]=[l._events[g],c]:l._events[g].push(c):(l._events[g]=c,l._eventsCount++),l}function n(l,u){--l._eventsCount==0?l._events=new t:delete l._events[u]}function o(){this._events=new t,this._eventsCount=0}Object.create&&(t.prototype=Object.create(null),new t().__proto__||(e=!1)),o.prototype.eventNames=function(){var l,u,d=[];if(this._eventsCount===0)return d;for(u in l=this._events)a.call(l,u)&&d.push(e?u.slice(1):u);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(l)):d},o.prototype.listeners=function(l){var u=e?e+l:l,d=this._events[u];if(!d)return[];if(d.fn)return[d.fn];for(var h=0,f=d.length,c=new Array(f);h<f;h++)c[h]=d[h].fn;return c},o.prototype.listenerCount=function(l){var u=e?e+l:l,d=this._events[u];return d?d.fn?1:d.length:0},o.prototype.emit=function(l,u,d,h,f,c){var g=e?e+l:l;if(!this._events[g])return!1;var m,y,v=this._events[g],p=arguments.length;if(v.fn){switch(v.once&&this.removeListener(l,v.fn,void 0,!0),p){case 1:return v.fn.call(v.context),!0;case 2:return v.fn.call(v.context,u),!0;case 3:return v.fn.call(v.context,u,d),!0;case 4:return v.fn.call(v.context,u,d,h),!0;case 5:return v.fn.call(v.context,u,d,h,f),!0;case 6:return v.fn.call(v.context,u,d,h,f,c),!0}for(y=1,m=new Array(p-1);y<p;y++)m[y-1]=arguments[y];v.fn.apply(v.context,m)}else{var S,T=v.length;for(y=0;y<T;y++)switch(v[y].once&&this.removeListener(l,v[y].fn,void 0,!0),p){case 1:v[y].fn.call(v[y].context);break;case 2:v[y].fn.call(v[y].context,u);break;case 3:v[y].fn.call(v[y].context,u,d);break;case 4:v[y].fn.call(v[y].context,u,d,h);break;default:if(!m)for(S=1,m=new Array(p-1);S<p;S++)m[S-1]=arguments[S];v[y].fn.apply(v[y].context,m)}}return!0},o.prototype.on=function(l,u,d){return i(this,l,u,d,!1)},o.prototype.once=function(l,u,d){return i(this,l,u,d,!0)},o.prototype.removeListener=function(l,u,d,h){var f=e?e+l:l;if(!this._events[f])return this;if(!u)return n(this,f),this;var c=this._events[f];if(c.fn)c.fn!==u||h&&!c.once||d&&c.context!==d||n(this,f);else{for(var g=0,m=[],y=c.length;g<y;g++)(c[g].fn!==u||h&&!c[g].once||d&&c[g].context!==d)&&m.push(c[g]);m.length?this._events[f]=m.length===1?m[0]:m:n(this,f)}return this},o.prototype.removeAllListeners=function(l){var u;return l?(u=e?e+l:l,this._events[u]&&n(this,u)):(this._events=new t,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=e,o.EventEmitter=o,s.exports=o})(Ai);var ar=cr(Ai.exports);function nr(s,a){if(!((e=a.remuxResult).audio||e.video||e.text||e.id3||e.initSegment))return!1;var e,t=[],r=a.remuxResult,i=r.audio,n=r.video;return i&&ki(t,i),n&&ki(t,n),s.postMessage({event:"transmuxComplete",data:a},t),!0}function ki(s,a){a.data1&&s.push(a.data1.buffer),a.data2&&s.push(a.data2.buffer)}function Di(s,a,e){a.reduce(function(t,r){return nr(s,r)||t},!1)||s.postMessage({event:"transmuxComplete",data:a[0]}),s.postMessage({event:"flush",data:e})}$!==void 0&&$&&function(s){var a=new ar,e=function(r,i){s.postMessage({event:r,data:i})};a.on(E.FRAG_DECRYPTED,e),a.on(E.ERROR,e);var t=function(){var r=function(n){var o=function(l){e("workerLog",{logType:n,message:l})};L[n]=o};for(var i in L)r(i)};s.addEventListener("message",function(r){var i=r.data;switch(i.cmd){case"init":var n=JSON.parse(i.config);s.transmuxer=new rr(a,i.typeSupported,n,i.vendor,i.id),gr(n.debug,i.id),t(),e("init",null);break;case"configure":s.transmuxer.configure(i.config);break;case"demux":var o=s.transmuxer.push(i.data,i.decryptdata,i.chunkMeta,i.state);Oe(o)?(s.transmuxer.async=!0,o.then(function(d){nr(s,d)}).catch(function(d){e(E.ERROR,{type:K.MEDIA_ERROR,details:k.FRAG_PARSING_ERROR,chunkMeta:i.chunkMeta,fatal:!1,error:d,err:d,reason:"transmuxer-worker push error"})})):(s.transmuxer.async=!1,nr(s,o));break;case"flush":var l=i.chunkMeta,u=s.transmuxer.flush(l);Oe(u)||s.transmuxer.async?(Oe(u)||(u=Promise.resolve(u)),u.then(function(d){Di(s,d,l)}).catch(function(d){e(E.ERROR,{type:K.MEDIA_ERROR,details:k.FRAG_PARSING_ERROR,chunkMeta:i.chunkMeta,fatal:!1,error:d,err:d,reason:"transmuxer-worker flush error"})})):Di(s,u,l)}})}(self);var sr=dt()||{isTypeSupported:function(){return!1}},ln=function(){function s(e,t,r,i){var n=this;this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var o=e.config;this.hls=e,this.id=t,this.useWorker=!!o.enableWorker,this.onTransmuxComplete=r,this.onFlush=i;var l=function(y,v){(v=v||{}).frag=n.frag,v.id=n.id,y===E.ERROR&&(n.error=v.error),n.hls.trigger(y,v)};this.observer=new ar,this.observer.on(E.FRAG_DECRYPTED,l),this.observer.on(E.ERROR,l);var u,d,h,f,c={mp4:sr.isTypeSupported("video/mp4"),mpeg:sr.isTypeSupported("audio/mpeg"),mp3:sr.isTypeSupported('audio/mp4; codecs="mp3"')},g=navigator.vendor;if(!this.useWorker||typeof Worker>"u"||(o.workerPath,0))this.transmuxer=new rr(this.observer,c,o,g,t);else try{o.workerPath?(L.log("loading Web Worker "+o.workerPath+' for "'+t+'"'),this.workerContext=(h=o.workerPath,f=new self.URL(h,self.location.href).href,{worker:new self.Worker(f),scriptURL:f})):(L.log('injecting Web Worker for "'+t+'"'),this.workerContext=(u=new self.Blob(["var exports={};var module={exports:exports};function define(f){f()};define.amd=true;("+ie.toString()+")(true);"],{type:"text/javascript"}),d=self.URL.createObjectURL(u),{worker:new self.Worker(d),objectURL:d})),this.onwmsg=function(y){return n.onWorkerMessage(y)};var m=this.workerContext.worker;m.addEventListener("message",this.onwmsg),m.onerror=function(y){var v=new Error(y.message+"  ("+y.filename+":"+y.lineno+")");o.enableWorker=!1,L.warn('Error in "'+t+'" Web Worker, fallback to inline'),n.hls.trigger(E.ERROR,{type:K.OTHER_ERROR,details:k.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:v})},m.postMessage({cmd:"init",typeSupported:c,vendor:g,id:t,config:JSON.stringify(o)})}catch(y){L.warn('Error setting up "'+t+'" Web Worker, fallback to inline',y),this.resetWorker(),this.error=null,this.transmuxer=new rr(this.observer,c,o,g,t)}}var a=s.prototype;return a.resetWorker=function(){if(this.workerContext){var e=this.workerContext,t=e.worker,r=e.objectURL;r&&self.URL.revokeObjectURL(r),t.removeEventListener("message",this.onwmsg),t.onerror=null,t.terminate(),this.workerContext=null}},a.destroy=function(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{var e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}var t=this.observer;t&&t.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},a.push=function(e,t,r,i,n,o,l,u,d,h){var f,c,g=this;d.transmuxing.start=self.performance.now();var m=this.transmuxer,y=o?o.start:n.start,v=n.decryptdata,p=this.frag,S=!(p&&n.cc===p.cc),T=!(p&&d.level===p.level),R=p?d.sn-p.sn:-1,b=this.part?d.part-this.part.index:-1,A=R===0&&d.id>1&&d.id===p?.stats.chunkCount,_=!T&&(R===1||R===0&&(b===1||A&&b<=0)),x=self.performance.now();(T||R||n.stats.parsing.start===0)&&(n.stats.parsing.start=x),!o||!b&&_||(o.stats.parsing.start=x);var D=!(p&&((f=n.initSegment)==null?void 0:f.url)===((c=p.initSegment)==null?void 0:c.url)),I=new on(S,_,u,T,y,D);if(!_||S||D){L.log("[transmuxer-interface, "+n.type+"]: Starting new transmux session for sn: "+d.sn+" p: "+d.part+" level: "+d.level+" id: "+d.id+`
        discontinuity: `+S+`
        trackSwitch: `+T+`
        contiguous: `+_+`
        accurateTimeOffset: `+u+`
        timeOffset: `+y+`
        initSegmentChange: `+D);var w=new sn(r,i,t,l,h);this.configureTransmuxer(w)}if(this.frag=n,this.part=o,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:e,decryptdata:v,chunkMeta:d,state:I},e instanceof ArrayBuffer?[e]:[]);else if(m){var O=m.push(e,v,d,I);Oe(O)?(m.async=!0,O.then(function(B){g.handleTransmuxComplete(B)}).catch(function(B){g.transmuxerError(B,d,"transmuxer-interface push error")})):(m.async=!1,this.handleTransmuxComplete(O))}},a.flush=function(e){var t=this;e.transmuxing.start=self.performance.now();var r=this.transmuxer;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:e});else if(r){var i=r.flush(e);Oe(i)||r.async?(Oe(i)||(i=Promise.resolve(i)),i.then(function(n){t.handleFlushResult(n,e)}).catch(function(n){t.transmuxerError(n,e,"transmuxer-interface flush error")})):this.handleFlushResult(i,e)}},a.transmuxerError=function(e,t,r){this.hls&&(this.error=e,this.hls.trigger(E.ERROR,{type:K.MEDIA_ERROR,details:k.FRAG_PARSING_ERROR,chunkMeta:t,fatal:!1,error:e,err:e,reason:r}))},a.handleFlushResult=function(e,t){var r=this;e.forEach(function(i){r.handleTransmuxComplete(i)}),this.onFlush(t)},a.onWorkerMessage=function(e){var t=e.data,r=this.hls;switch(t.event){case"init":var i,n=(i=this.workerContext)==null?void 0:i.objectURL;n&&self.URL.revokeObjectURL(n);break;case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":L[t.data.logType]&&L[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,r.trigger(t.event,t.data)}},a.configureTransmuxer=function(e){var t=this.transmuxer;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:e}):t&&t.configure(e)},a.handleTransmuxComplete=function(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)},s}(),un=function(){function s(e,t,r,i){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=r,this.hls=i}var a=s.prototype;return a.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},a.poll=function(e,t){var r=this.config,i=this.media,n=this.stalled;if(i!==null){var o=i.currentTime,l=i.seeking,u=this.seeking&&!l,d=!this.seeking&&l;if(this.seeking=l,o===e){if(d||u)this.stalled=null;else if(!(i.paused&&!l||i.ended||i.playbackRate===0)&&X.getBuffered(i).length){var h=X.bufferInfo(i,o,0),f=h.len>0,c=h.nextStart||0;if(f||c){if(l){var g=h.len>2,m=!c||t&&t.start<=o||c-o>2&&!this.fragmentTracker.getPartialFragment(o);if(g||m)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var y,v=Math.max(c,h.start||0)-o,p=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,S=!(p==null||(y=p.details)==null)&&y.live?2*p.details.targetduration:2,T=this.fragmentTracker.getPartialFragment(o);if(v>0&&(v<=S||T))return void this._trySkipBufferHole(T)}var R=self.performance.now();if(n!==null){var b=R-n;if(l||!(b>=250)||(this._reportStall(h),this.media)){var A=X.bufferInfo(i,o,r.maxBufferHole);this._tryFixBufferStall(A,b)}}else this.stalled=R}}}else if(this.moved=!0,n!==null){if(this.stallReported){var _=self.performance.now()-n;L.warn("playback not stuck anymore @"+o+", after "+Math.round(_)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}}},a._tryFixBufferStall=function(e,t){var r=this.config,i=this.fragmentTracker,n=this.media;if(n!==null){var o=n.currentTime,l=i.getPartialFragment(o);if(l&&(this._trySkipBufferHole(l)||!this.media))return;(e.len>r.maxBufferHole||e.nextStart&&e.nextStart-o<r.maxBufferHole)&&t>1e3*r.highBufferWatchdogPeriod&&(L.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},a._reportStall=function(e){var t=this.hls,r=this.media;if(!this.stallReported&&r){this.stallReported=!0;var i=new Error("Playback stalling at @"+r.currentTime+" due to low buffer ("+JSON.stringify(e)+")");L.warn(i.message),t.trigger(E.ERROR,{type:K.MEDIA_ERROR,details:k.BUFFER_STALLED_ERROR,fatal:!1,error:i,buffer:e.len})}},a._trySkipBufferHole=function(e){var t=this.config,r=this.hls,i=this.media;if(i===null)return 0;var n=i.currentTime,o=X.bufferInfo(i,n,0),l=n<o.start?o.start:o.nextStart;if(l){var u=o.len<=t.maxBufferHole,d=o.len>0&&o.len<1&&i.readyState<3,h=l-n;if(h>0&&(u||d)){if(h>t.maxBufferHole){var f=this.fragmentTracker,c=!1;if(n===0){var g=f.getAppendedFrag(0,W);g&&l<g.end&&(c=!0)}if(!c){var m=e||f.getAppendedFrag(n,W);if(m){for(var y=!1,v=m.end;v<l;){var p=f.getPartialFragment(v);if(!p){y=!0;break}v+=p.duration}if(y)return 0}}}var S=Math.max(l+.05,n+.1);if(L.warn("skipping hole, adjusting currentTime from "+n+" to "+S),this.moved=!0,this.stalled=null,i.currentTime=S,e&&!e.gap){var T=new Error("fragment loaded with buffer holes, seeking from "+n+" to "+S);r.trigger(E.ERROR,{type:K.MEDIA_ERROR,details:k.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:T,reason:T.message,frag:e})}return S}}return 0},a._tryNudgeBuffer=function(){var e=this.config,t=this.hls,r=this.media,i=this.nudgeRetry;if(r!==null){var n=r.currentTime;if(this.nudgeRetry++,i<e.nudgeMaxRetry){var o=n+(i+1)*e.nudgeOffset,l=new Error("Nudging 'currentTime' from "+n+" to "+o);L.warn(l.message),r.currentTime=o,t.trigger(E.ERROR,{type:K.MEDIA_ERROR,details:k.BUFFER_NUDGE_ON_STALL,error:l,fatal:!1})}else{var u=new Error("Playhead still not moving while enough data buffered @"+n+" after "+e.nudgeMaxRetry+" nudges");L.error(u.message),t.trigger(E.ERROR,{type:K.MEDIA_ERROR,details:k.BUFFER_STALLED_ERROR,error:u,fatal:!0})}}},s}(),dn=function(s){function a(t,r,i){var n;return(n=s.call(this,t,r,i,"[stream-controller]",W)||this).audioCodecSwap=!1,n.gapController=null,n.level=-1,n._forceStartLoad=!1,n.altAudio=!1,n.audioOnly=!1,n.fragPlaying=null,n.onvplaying=null,n.onvseeked=null,n.fragLastKbps=0,n.couldBacktrack=!1,n.backtrackFragment=null,n.audioCodecSwitch=!1,n.videoBuffer=null,n._registerListeners(),n}Ee(a,s);var e=a.prototype;return e._registerListeners=function(){var t=this.hls;t.on(E.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(E.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(E.MANIFEST_LOADING,this.onManifestLoading,this),t.on(E.MANIFEST_PARSED,this.onManifestParsed,this),t.on(E.LEVEL_LOADING,this.onLevelLoading,this),t.on(E.LEVEL_LOADED,this.onLevelLoaded,this),t.on(E.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.on(E.ERROR,this.onError,this),t.on(E.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(E.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(E.BUFFER_CREATED,this.onBufferCreated,this),t.on(E.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(E.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(E.FRAG_BUFFERED,this.onFragBuffered,this)},e._unregisterListeners=function(){var t=this.hls;t.off(E.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(E.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(E.MANIFEST_LOADING,this.onManifestLoading,this),t.off(E.MANIFEST_PARSED,this.onManifestParsed,this),t.off(E.LEVEL_LOADED,this.onLevelLoaded,this),t.off(E.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.off(E.ERROR,this.onError,this),t.off(E.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(E.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(E.BUFFER_CREATED,this.onBufferCreated,this),t.off(E.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(E.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(E.FRAG_BUFFERED,this.onFragBuffered,this)},e.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},e.startLoad=function(t){if(this.levels){var r=this.lastCurrentTime,i=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,!this.startFragRequested){var n=i.startLevel;n===-1&&(i.config.testBandwidth&&this.levels.length>1?(n=0,this.bitrateTest=!0):n=i.nextAutoLevel),this.level=i.nextLoadLevel=n,this.loadedmetadata=!1}r>0&&t===-1&&(this.log("Override startPosition with lastCurrentTime @"+r.toFixed(3)),t=r),this.state=j,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}else this._forceStartLoad=!0,this.state=Se},e.stopLoad=function(){this._forceStartLoad=!1,s.prototype.stopLoad.call(this)},e.doTick=function(){switch(this.state){case Fe:var t,r=this.levels,i=this.level,n=r==null||(t=r[i])==null?void 0:t.details;if(n&&(!n.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(n))break;this.state=j;break}if(this.hls.nextLoadLevel!==this.level){this.state=j;break}break;case et:var o,l=self.performance.now(),u=this.retryDate;(!u||l>=u||(o=this.media)!=null&&o.seeking)&&(this.resetStartWhenNotLoaded(this.level),this.state=j)}this.state===j&&this.doTickIdle(),this.onTickEnd()},e.onTickEnd=function(){s.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},e.doTickIdle=function(){var t=this.hls,r=this.levelLastLoaded,i=this.levels,n=this.media,o=t.config,l=t.nextLoadLevel;if(r!==null&&(n||!this.startFragRequested&&o.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&i!=null&&i[l]){var u=i[l],d=this.getMainFwdBufferInfo();if(d!==null){var h=this.getLevelDetails();if(h&&this._streamEnded(d,h)){var f={};return this.altAudio&&(f.type="video"),this.hls.trigger(E.BUFFER_EOS,f),void(this.state=zt)}t.loadLevel!==l&&t.manualLevel===-1&&this.log("Adapting to level "+l+" from level "+this.level),this.level=t.nextLoadLevel=l;var c=u.details;if(!c||this.state===Fe||c.live&&this.levelLastLoaded!==l)return this.level=l,void(this.state=Fe);var g=d.len,m=this.getMaxBufferLength(u.maxBitrate);if(!(g>=m)){this.backtrackFragment&&this.backtrackFragment.start>d.end&&(this.backtrackFragment=null);var y=this.backtrackFragment?this.backtrackFragment.start:d.end,v=this.getNextFragment(y,c);if(this.couldBacktrack&&!this.fragPrevious&&v&&v.sn!=="initSegment"&&this.fragmentTracker.getState(v)!==$e){var p,S=((p=this.backtrackFragment)!=null?p:v).sn-c.startSN,T=c.fragments[S-1];T&&v.cc===T.cc&&(v=T,this.fragmentTracker.removeFragment(T))}else this.backtrackFragment&&d.len&&(this.backtrackFragment=null);if(v&&this.isLoopLoading(v,y)){if(!v.gap){var R=this.audioOnly&&!this.altAudio?me:he,b=(R===he?this.videoBuffer:this.mediaBuffer)||this.media;b&&this.afterBufferFlushed(b,R,W)}v=this.getNextFragmentLoopLoading(v,c,d,W,m)}v&&(!v.initSegment||v.initSegment.data||this.bitrateTest||(v=v.initSegment),this.loadFragment(v,u,y))}}}},e.loadFragment=function(t,r,i){var n=this.fragmentTracker.getState(t);this.fragCurrent=t,n===ti||n===Ze?t.sn==="initSegment"?this._loadInitSegment(t,r):this.bitrateTest?(this.log("Fragment "+t.sn+" of level "+t.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(t,r)):(this.startFragRequested=!0,s.prototype.loadFragment.call(this,t,r,i)):this.clearTrackerIfNeeded(t)},e.getBufferedFrag=function(t){return this.fragmentTracker.getBufferedFrag(t,W)},e.followingBufferedFrag=function(t){return t?this.getBufferedFrag(t.end+.5):null},e.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},e.nextLevelSwitch=function(){var t=this.levels,r=this.media;if(r!=null&&r.readyState){var i,n=this.getAppendedFrag(r.currentTime);n&&n.start>1&&this.flushMainBuffer(0,n.start-1);var o=this.getLevelDetails();if(o!=null&&o.live){var l=this.getMainFwdBufferInfo();if(!l||l.len<2*o.targetduration)return}if(!r.paused&&t){var u=t[this.hls.nextLoadLevel],d=this.fragLastKbps;i=d&&this.fragCurrent?this.fragCurrent.duration*u.maxBitrate/(1e3*d)+1:0}else i=0;var h=this.getBufferedFrag(r.currentTime+i);if(h){var f=this.followingBufferedFrag(h);if(f){this.abortCurrentFrag();var c=f.maxStartPTS?f.maxStartPTS:f.start,g=f.duration,m=Math.max(h.end,c+Math.min(Math.max(g-this.config.maxFragLookUpTolerance,.5*g),.75*g));this.flushMainBuffer(m,Number.POSITIVE_INFINITY)}}}},e.abortCurrentFrag=function(){var t=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,t&&(t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.state){case Xt:case Je:case et:case Pe:case pt:this.state=j}this.nextLoadPosition=this.getLoadPosition()},e.flushMainBuffer=function(t,r){s.prototype.flushMainBuffer.call(this,t,r,this.altAudio?"video":null)},e.onMediaAttached=function(t,r){s.prototype.onMediaAttached.call(this,t,r);var i=r.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),i.addEventListener("playing",this.onvplaying),i.addEventListener("seeked",this.onvseeked),this.gapController=new un(this.config,i,this.fragmentTracker,this.hls)},e.onMediaDetaching=function(){var t=this.media;t&&this.onvplaying&&this.onvseeked&&(t.removeEventListener("playing",this.onvplaying),t.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),s.prototype.onMediaDetaching.call(this)},e.onMediaPlaying=function(){this.tick()},e.onMediaSeeked=function(){var t=this.media,r=t?t.currentTime:null;F(r)&&this.log("Media seeked to "+r.toFixed(3));var i=this.getMainFwdBufferInfo();i!==null&&i.len!==0?this.tick():this.warn('Main forward buffer length on "seeked" event '+(i?i.len:"empty")+")")},e.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(E.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.levels=this.fragPlaying=this.backtrackFragment=null,this.altAudio=this.audioOnly=!1},e.onManifestParsed=function(t,r){var i,n,o,l=!1,u=!1;r.levels.forEach(function(d){(i=d.audioCodec)&&(i.indexOf("mp4a.40.2")!==-1&&(l=!0),i.indexOf("mp4a.40.5")!==-1&&(u=!0))}),this.audioCodecSwitch=l&&u&&typeof((o=ui())==null||(n=o.prototype)==null?void 0:n.changeType)!="function",this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=r.levels,this.startFragRequested=!1},e.onLevelLoading=function(t,r){var i=this.levels;if(i&&this.state===j){var n=i[r.level];(!n.details||n.details.live&&this.levelLastLoaded!==r.level||this.waitForCdnTuneIn(n.details))&&(this.state=Fe)}},e.onLevelLoaded=function(t,r){var i,n=this.levels,o=r.level,l=r.details,u=l.totalduration;if(n){this.log("Level "+o+" loaded ["+l.startSN+","+l.endSN+"]"+(l.lastPartSn?"[part-"+l.lastPartSn+"-"+l.lastPartIndex+"]":"")+", cc ["+l.startCC+", "+l.endCC+"] duration:"+u);var d=n[o],h=this.fragCurrent;!h||this.state!==Je&&this.state!==et||h.level===r.level&&h.urlId===d.urlId||!h.loader||this.abortCurrentFrag();var f=0;if(l.live||(i=d.details)!=null&&i.live){if(this.checkLiveUpdate(l),l.deltaUpdateFailed)return;f=this.alignPlaylists(l,d.details)}if(d.details=l,this.levelLastLoaded=o,this.hls.trigger(E.LEVEL_UPDATED,{details:l,level:o}),this.state===Fe){if(this.waitForCdnTuneIn(l))return;this.state=j}this.startFragRequested?l.live&&this.synchronizeToLiveEdge(l):this.setStartPosition(l,f),this.tick()}else this.warn("Levels were reset while loading level "+o)},e._handleFragmentLoadProgress=function(t){var r,i=t.frag,n=t.part,o=t.payload,l=this.levels;if(l){var u=l[i.level],d=u.details;if(!d)return this.warn("Dropping fragment "+i.sn+" of level "+i.level+" after level details were reset"),void this.fragmentTracker.removeFragment(i);var h=u.videoCodec,f=d.PTSKnown||!d.live,c=(r=i.initSegment)==null?void 0:r.data,g=this._getAudioCodec(u),m=this.transmuxer=this.transmuxer||new ln(this.hls,W,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),y=n?n.index:-1,v=y!==-1,p=new si(i.level,i.sn,i.stats.chunkCount,o.byteLength,y,v),S=this.initPTS[i.cc];m.push(o,c,g,h,i,n,d.totalduration,f,p,S)}else this.warn("Levels were reset while fragment load was in progress. Fragment "+i.sn+" of level "+i.level+" will not be buffered")},e.onAudioTrackSwitching=function(t,r){var i=this.altAudio;if(!r.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var n=this.fragCurrent;n&&(this.log("Switching to main audio track, cancel main fragment load"),n.abortRequests(),this.fragmentTracker.removeFragment(n)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var o=this.hls;i&&(o.trigger(E.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),o.trigger(E.AUDIO_TRACK_SWITCHED,r)}},e.onAudioTrackSwitched=function(t,r){var i=r.id,n=!!this.hls.audioTracks[i].url;if(n){var o=this.videoBuffer;o&&this.mediaBuffer!==o&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=o)}this.altAudio=n,this.tick()},e.onBufferCreated=function(t,r){var i,n,o=r.tracks,l=!1;for(var u in o){var d=o[u];if(d.id==="main"){if(n=u,i=d,u==="video"){var h=o[u];h&&(this.videoBuffer=h.buffer)}}else l=!0}l&&i?(this.log("Alternate track found, use "+n+".buffered to schedule main fragment loading"),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media},e.onFragBuffered=function(t,r){var i=r.frag,n=r.part;if(!i||i.type===W){if(this.fragContextChanged(i))return this.warn("Fragment "+i.sn+(n?" p: "+n.index:"")+" of level "+i.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===pt&&(this.state=j));var o=n?n.stats:i.stats;this.fragLastKbps=Math.round(8*o.total/(o.buffering.end-o.loading.first)),i.sn!=="initSegment"&&(this.fragPrevious=i),this.fragBufferedComplete(i,n)}},e.onError=function(t,r){var i;if(r.fatal)this.state=tt;else switch(r.details){case k.FRAG_GAP:case k.FRAG_PARSING_ERROR:case k.FRAG_DECRYPT_ERROR:case k.FRAG_LOAD_ERROR:case k.FRAG_LOAD_TIMEOUT:case k.KEY_LOAD_ERROR:case k.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(W,r);break;case k.LEVEL_LOAD_ERROR:case k.LEVEL_LOAD_TIMEOUT:case k.LEVEL_PARSING_ERROR:r.levelRetry||this.state!==Fe||((i=r.context)==null?void 0:i.type)!==Ce||(this.state=j);break;case k.BUFFER_FULL_ERROR:if(!r.parent||r.parent!=="main")return;this.reduceLengthAndFlushBuffer(r)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case k.INTERNAL_EXCEPTION:this.recoverWorkerError(r)}},e.checkBuffer=function(){var t=this.media,r=this.gapController;if(t&&r&&t.readyState){if(this.loadedmetadata||!X.getBuffered(t).length){var i=this.state!==j?this.fragCurrent:null;r.poll(this.lastCurrentTime,i)}this.lastCurrentTime=t.currentTime}},e.onFragLoadEmergencyAborted=function(){this.state=j,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},e.onBufferFlushed=function(t,r){var i=r.type;if(i!==me||this.audioOnly&&!this.altAudio){var n=(i===he?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(n,i,W)}},e.onLevelsUpdated=function(t,r){this.levels=r.levels},e.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},e.seekToStartPos=function(){var t=this.media;if(t){var r=t.currentTime,i=this.startPosition;if(i>=0&&r<i){if(t.seeking)return void this.log("could not seek to "+i+", already seeking at "+r);var n=X.getBuffered(t),o=(n.length?n.start(0):0)-i;o>0&&(o<this.config.maxBufferHole||o<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+o+" to match buffer start"),i+=o,this.startPosition=i),this.log("seek to target start position "+i+" from current time "+r),t.currentTime=i}}},e._getAudioCodec=function(t){var r=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&r&&(this.log("Swapping audio codec"),r=r.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),r},e._loadBitrateTestFrag=function(t,r){var i=this;t.bitrateTest=!0,this._doFragLoad(t,r).then(function(n){var o=i.hls;if(n&&!i.fragContextChanged(t)){r.fragmentError=0,i.state=j,i.startFragRequested=!1,i.bitrateTest=!1;var l=t.stats;l.parsing.start=l.parsing.end=l.buffering.start=l.buffering.end=self.performance.now(),o.trigger(E.FRAG_LOADED,n),t.bitrateTest=!1}})},e._handleTransmuxComplete=function(t){var r,i="main",n=this.hls,o=t.remuxResult,l=t.chunkMeta,u=this.getCurrentContext(l);if(u){var d=u.frag,h=u.part,f=u.level,c=o.video,g=o.text,m=o.id3,y=o.initSegment,v=f.details,p=this.altAudio?void 0:o.audio;if(this.fragContextChanged(d))this.fragmentTracker.removeFragment(d);else{if(this.state=Pe,y){if(y!=null&&y.tracks){var S=d.initSegment||d;this._bufferInitSegment(f,y.tracks,S,l),n.trigger(E.FRAG_PARSING_INIT_SEGMENT,{frag:S,id:i,tracks:y.tracks})}var T=y.initPTS,R=y.timescale;F(T)&&(this.initPTS[d.cc]={baseTime:T,timescale:R},n.trigger(E.INIT_PTS_FOUND,{frag:d,id:i,initPTS:T,timescale:R}))}if(c&&v&&d.sn!=="initSegment"){var b=v.fragments[d.sn-1-v.startSN],A=d.sn===v.startSN,_=!b||d.cc>b.cc;if(o.independent!==!1){var x=c.startPTS,D=c.endPTS,I=c.startDTS,w=c.endDTS;if(h)h.elementaryStreams[c.type]={startPTS:x,endPTS:D,startDTS:I,endDTS:w};else if(c.firstKeyFrame&&c.independent&&l.id===1&&!_&&(this.couldBacktrack=!0),c.dropped&&c.independent){var O=this.getMainFwdBufferInfo(),B=(O?O.end:this.getLoadPosition())+this.config.maxBufferHole,C=c.firstKeyFramePTS?c.firstKeyFramePTS:x;if(!A&&B<C-this.config.maxBufferHole&&!_)return void this.backtrack(d);_&&(d.gap=!0),d.setElementaryStreamInfo(c.type,d.start,D,d.start,w,!0)}d.setElementaryStreamInfo(c.type,x,D,I,w),this.backtrackFragment&&(this.backtrackFragment=d),this.bufferFragmentData(c,d,h,l,A||_)}else{if(!A&&!_)return void this.backtrack(d);d.gap=!0}}if(p){var U=p.startPTS,M=p.endPTS,P=p.startDTS,H=p.endDTS;h&&(h.elementaryStreams[me]={startPTS:U,endPTS:M,startDTS:P,endDTS:H}),d.setElementaryStreamInfo(me,U,M,P,H),this.bufferFragmentData(p,d,h,l)}if(v&&m!=null&&(r=m.samples)!=null&&r.length){var V={id:i,frag:d,details:v,samples:m.samples};n.trigger(E.FRAG_PARSING_METADATA,V)}if(v&&g){var G={id:i,frag:d,details:v,samples:g.samples};n.trigger(E.FRAG_PARSING_USERDATA,G)}}}else this.resetWhenMissingContext(l)},e._bufferInitSegment=function(t,r,i,n){var o=this;if(this.state===Pe){this.audioOnly=!!r.audio&&!r.video,this.altAudio&&!this.audioOnly&&delete r.audio;var l=r.audio,u=r.video,d=r.audiovideo;if(l){var h=t.audioCodec,f=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(h&&(h=h.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),l.metadata.channelCount!==1&&f.indexOf("firefox")===-1&&(h="mp4a.40.5")),f.indexOf("android")!==-1&&l.container!=="audio/mpeg"&&(h="mp4a.40.2",this.log("Android: force audio codec to "+h)),t.audioCodec&&t.audioCodec!==h&&this.log('Swapping manifest audio codec "'+t.audioCodec+'" for "'+h+'"'),l.levelCodec=h,l.id="main",this.log("Init audio buffer, container:"+l.container+", codecs[selected/level/parsed]=["+(h||"")+"/"+(t.audioCodec||"")+"/"+l.codec+"]")}u&&(u.levelCodec=t.videoCodec,u.id="main",this.log("Init video buffer, container:"+u.container+", codecs[level/parsed]=["+(t.videoCodec||"")+"/"+u.codec+"]")),d&&this.log("Init audiovideo buffer, container:"+d.container+", codecs[level/parsed]=["+(t.attrs.CODECS||"")+"/"+d.codec+"]"),this.hls.trigger(E.BUFFER_CODECS,r),Object.keys(r).forEach(function(c){var g=r[c].initSegment;g!=null&&g.byteLength&&o.hls.trigger(E.BUFFER_APPENDING,{type:c,data:g,frag:i,part:null,chunkMeta:n,parent:i.type})}),this.tick()}},e.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,W)},e.backtrack=function(t){this.couldBacktrack=!0,this.backtrackFragment=t,this.resetTransmuxer(),this.flushBufferGap(t),this.fragmentTracker.removeFragment(t),this.fragPrevious=null,this.nextLoadPosition=t.start,this.state=j},e.checkFragmentChanged=function(){var t=this.media,r=null;if(t&&t.readyState>1&&t.seeking===!1){var i=t.currentTime;if(X.isBuffered(t,i)?r=this.getAppendedFrag(i):X.isBuffered(t,i+.1)&&(r=this.getAppendedFrag(i+.1)),r){this.backtrackFragment=null;var n=this.fragPlaying,o=r.level;n&&r.sn===n.sn&&n.level===o&&r.urlId===n.urlId||(this.fragPlaying=r,this.hls.trigger(E.FRAG_CHANGED,{frag:r}),n&&n.level===o||this.hls.trigger(E.LEVEL_SWITCHED,{level:o}))}}},se(a,[{key:"nextLevel",get:function(){var t=this.nextBufferedFrag;return t?t.level:-1}},{key:"currentFrag",get:function(){var t=this.media;return t?this.fragPlaying||this.getAppendedFrag(t.currentTime):null}},{key:"currentProgramDateTime",get:function(){var t=this.media;if(t){var r=t.currentTime,i=this.currentFrag;if(i&&F(r)&&F(i.programDateTime)){var n=i.programDateTime+1e3*(r-i.start);return new Date(n)}}return null}},{key:"currentLevel",get:function(){var t=this.currentFrag;return t?t.level:-1}},{key:"nextBufferedFrag",get:function(){var t=this.currentFrag;return t?this.followingBufferedFrag(t):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),a}(Ha),Ye=function(){function s(e,t,r){t===void 0&&(t=0),r===void 0&&(r=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=r}var a=s.prototype;return a.sample=function(e,t){var r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e},a.getTotalWeight=function(){return this.totalWeight_},a.getEstimate=function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_},s}(),hn=function(){function s(e,t,r,i){i===void 0&&(i=100),this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Ye(e),this.fast_=new Ye(t),this.defaultTTFB_=i,this.ttfb_=new Ye(e)}var a=s.prototype;return a.update=function(e,t){var r=this.slow_,i=this.fast_,n=this.ttfb_;r.halfLife!==e&&(this.slow_=new Ye(e,r.getEstimate(),r.getTotalWeight())),i.halfLife!==t&&(this.fast_=new Ye(t,i.getEstimate(),i.getTotalWeight())),n.halfLife!==e&&(this.ttfb_=new Ye(e,n.getEstimate(),n.getTotalWeight()))},a.sample=function(e,t){var r=(e=Math.max(e,this.minDelayMs_))/1e3,i=8*t/r;this.fast_.sample(r,i),this.slow_.sample(r,i)},a.sampleTTFB=function(e){var t=e/1e3,r=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(r,Math.max(e,5))},a.canEstimate=function(){return this.fast_.getTotalWeight()>=this.minWeight_},a.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},a.getEstimateTTFB=function(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_},a.destroy=function(){},s}(),fn=function(){function s(e){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=-1,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=e;var t=e.config;this.bwEstimator=new hn(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate),this.registerListeners()}var a=s.prototype;return a.registerListeners=function(){var e=this.hls;e.on(E.FRAG_LOADING,this.onFragLoading,this),e.on(E.FRAG_LOADED,this.onFragLoaded,this),e.on(E.FRAG_BUFFERED,this.onFragBuffered,this),e.on(E.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(E.LEVEL_LOADED,this.onLevelLoaded,this)},a.unregisterListeners=function(){var e=this.hls;e.off(E.FRAG_LOADING,this.onFragLoading,this),e.off(E.FRAG_LOADED,this.onFragLoaded,this),e.off(E.FRAG_BUFFERED,this.onFragBuffered,this),e.off(E.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(E.LEVEL_LOADED,this.onLevelLoaded,this)},a.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},a.onFragLoading=function(e,t){var r,i=t.frag;this.ignoreFragment(i)||(this.fragCurrent=i,this.partCurrent=(r=t.part)!=null?r:null,this.clearTimer(),this.timer=self.setInterval(this.onCheck,100))},a.onLevelSwitching=function(e,t){this.clearTimer()},a.getTimeToLoadFrag=function(e,t,r,i){return e+r/t+(i?this.lastLevelLoadSec:0)},a.onLevelLoaded=function(e,t){var r=this.hls.config,i=t.stats,n=i.total,o=i.bwEstimate;F(n)&&F(o)&&(this.lastLevelLoadSec=8*n/o),t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD)},a._abandonRulesCheck=function(){var e=this.fragCurrent,t=this.partCurrent,r=this.hls,i=r.autoLevelEnabled,n=r.media;if(e&&n){var o=performance.now(),l=t?t.stats:e.stats,u=t?t.duration:e.duration,d=o-l.loading.start;if(l.aborted||l.loaded&&l.loaded===l.total||e.level===0)return this.clearTimer(),void(this._nextAutoLevel=-1);if(i&&!n.paused&&n.playbackRate&&n.readyState){var h=r.mainForwardBufferInfo;if(h!==null){var f=this.bwEstimator.getEstimateTTFB(),c=Math.abs(n.playbackRate);if(!(d<=Math.max(f,u/(2*c)*1e3))){var g=h.len/c;if(!(g>=2*u/c)){var m=l.loading.first?l.loading.first-l.loading.start:-1,y=l.loaded&&m>-1,v=this.bwEstimator.getEstimate(),p=r.levels,S=r.minAutoLevel,T=p[e.level],R=l.total||Math.max(l.loaded,Math.round(u*T.maxBitrate/8)),b=d-m;b<1&&y&&(b=Math.min(d,8*l.loaded/v));var A=y?1e3*l.loaded/b:0,_=A?(R-l.loaded)/A:8*R/v+f/1e3;if(!(_<=g)){var x,D=A?8*A:v,I=Number.POSITIVE_INFINITY;for(x=e.level-1;x>S;x--){var w=p[x].maxBitrate;if((I=this.getTimeToLoadFrag(f/1e3,D,u*w,!p[x].details))<g)break}I>=_||I>10*u||(r.nextLoadLevel=x,y?this.bwEstimator.sample(d-Math.min(f,m),l.loaded):this.bwEstimator.sampleTTFB(d),this.clearTimer(),L.warn("[abr] Fragment "+e.sn+(t?" part "+t.index:"")+" of level "+e.level+` is loading too slowly;
      Time to underbuffer: `+g.toFixed(3)+` s
      Estimated load time for current fragment: `+_.toFixed(3)+` s
      Estimated load time for down switch fragment: `+I.toFixed(3)+` s
      TTFB estimate: `+m+`
      Current BW estimate: `+(F(v)?(v/1024).toFixed(3):"Unknown")+` Kb/s
      New BW estimate: `+(this.bwEstimator.getEstimate()/1024).toFixed(3)+` Kb/s
      Aborting and switching to level `+x),e.loader&&(this.fragCurrent=this.partCurrent=null,e.abortRequests()),r.trigger(E.FRAG_LOAD_EMERGENCY_ABORTED,{frag:e,part:t,stats:l}))}}}}}}},a.onFragLoaded=function(e,t){var r=t.frag,i=t.part,n=i?i.stats:r.stats;if(r.type===W&&this.bwEstimator.sampleTTFB(n.loading.first-n.loading.start),!this.ignoreFragment(r)){if(this.clearTimer(),this.lastLoadedFragLevel=r.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var o=i?i.duration:r.duration,l=this.hls.levels[r.level],u=(l.loaded?l.loaded.bytes:0)+n.loaded,d=(l.loaded?l.loaded.duration:0)+o;l.loaded={bytes:u,duration:d},l.realBitrate=Math.round(8*u/d)}if(r.bitrateTest){var h={stats:n,frag:r,part:i,id:r.type};this.onFragBuffered(E.FRAG_BUFFERED,h),r.bitrateTest=!1}}},a.onFragBuffered=function(e,t){var r=t.frag,i=t.part,n=i!=null&&i.stats.loaded?i.stats:r.stats;if(!n.aborted&&!this.ignoreFragment(r)){var o=n.parsing.end-n.loading.start-Math.min(n.loading.first-n.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(o,n.loaded),n.bwEstimate=this.bwEstimator.getEstimate(),r.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}},a.ignoreFragment=function(e){return e.type!==W||e.sn==="initSegment"},a.clearTimer=function(){self.clearInterval(this.timer)},a.getNextABRAutoLevel=function(){var e=this.fragCurrent,t=this.partCurrent,r=this.hls,i=r.maxAutoLevel,n=r.config,o=r.minAutoLevel,l=r.media,u=t?t.duration:e?e.duration:0,d=l&&l.playbackRate!==0?Math.abs(l.playbackRate):1,h=this.bwEstimator?this.bwEstimator.getEstimate():n.abrEwmaDefaultEstimate,f=r.mainForwardBufferInfo,c=(f?f.len:0)/d,g=this.findBestLevel(h,o,i,c,n.abrBandWidthFactor,n.abrBandWidthUpFactor);if(g>=0)return g;L.trace("[abr] "+(c?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var m=u?Math.min(u,n.maxStarvationDelay):n.maxStarvationDelay,y=n.abrBandWidthFactor,v=n.abrBandWidthUpFactor;if(!c){var p=this.bitrateTestDelay;p&&(m=(u?Math.min(u,n.maxLoadingDelay):n.maxLoadingDelay)-p,L.trace("[abr] bitrate test took "+Math.round(1e3*p)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*m)+" ms"),y=v=1)}return g=this.findBestLevel(h,o,i,c+m,y,v),Math.max(g,0)},a.findBestLevel=function(e,t,r,i,n,o){for(var l,u=this.fragCurrent,d=this.partCurrent,h=this.lastLoadedFragLevel,f=this.hls.levels,c=f[h],g=!(c==null||(l=c.details)==null||!l.live),m=c?.codecSet,y=d?d.duration:u?u.duration:0,v=this.bwEstimator.getEstimateTTFB()/1e3,p=t,S=-1,T=r;T>=t;T--){var R=f[T];if(!R||m&&R.codecSet!==m)R&&(p=Math.min(T,p),S=Math.max(T,S));else{S!==-1&&L.trace("[abr] Skipped level(s) "+p+"-"+S+' with CODECS:"'+f[S].attrs.CODECS+'"; not compatible with "'+c.attrs.CODECS+'"');var b=R.details,A=(d?b?.partTarget:b?.averagetargetduration)||y,_=void 0;_=T<=h?n*e:o*e;var x=f[T].maxBitrate,D=this.getTimeToLoadFrag(v,_,x*A,b===void 0);if(L.trace("[abr] level:"+T+" adjustedbw-bitrate:"+Math.round(_-x)+" avgDuration:"+A.toFixed(1)+" maxFetchDuration:"+i.toFixed(1)+" fetchDuration:"+D.toFixed(1)),_>x&&(D===0||!F(D)||g&&!this.bitrateTestDelay||D<i))return T}}return-1},se(s,[{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,t=this.bwEstimator;if(e!==-1&&!t.canEstimate())return e;var r=this.getNextABRAutoLevel();if(e!==-1){var i=this.hls.levels;if(i.length>Math.max(e,r)&&i[e].loadError<=i[r].loadError)return e}return e!==-1&&(r=Math.min(e,r)),r},set:function(e){this._nextAutoLevel=e}}]),s}(),cn=function(){function s(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}var a=s.prototype;return a.append=function(e,t){var r=this.queues[t];r.push(e),r.length===1&&this.buffers[t]&&this.executeNext(t)},a.insertAbort=function(e,t){this.queues[t].unshift(e),this.executeNext(t)},a.appendBlocker=function(e){var t,r=new Promise(function(n){t=n}),i={execute:t,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(i,e),r},a.executeNext=function(e){var t=this.buffers,r=this.queues,i=t[e],n=r[e];if(n.length){var o=n[0];try{o.execute()}catch(l){L.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),o.onError(l),i!=null&&i.updating||(n.shift(),this.executeNext(e))}}},a.shiftAndExecuteNext=function(e){this.queues[e].shift(),this.executeNext(e)},a.current=function(e){return this.queues[e][0]},s}(),_i=dt(),xi=/([ha]vc.)(?:\.[^.,]+)+/,vn=function(){function s(e){var t=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var r=t.media,i=t.mediaSource;L.log("[buffer-controller]: Media source opened"),r&&(r.removeEventListener("emptied",t._onMediaEmptied),t.updateMediaElementDuration(),t.hls.trigger(E.MEDIA_ATTACHED,{media:r})),i&&i.removeEventListener("sourceopen",t._onMediaSourceOpen),t.checkPendingTracks()},this._onMediaSourceClose=function(){L.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){L.log("[buffer-controller]: Media source ended")},this._onMediaEmptied=function(){var r=t.media,i=t._objectUrl;r&&r.src!==i&&L.error("Media element src was set while attaching MediaSource ("+i+" > "+r.src+")")},this.hls=e,this._initSourceBuffer(),this.registerListeners()}var a=s.prototype;return a.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},a.destroy=function(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null},a.registerListeners=function(){var e=this.hls;e.on(E.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(E.MANIFEST_LOADING,this.onManifestLoading,this),e.on(E.MANIFEST_PARSED,this.onManifestParsed,this),e.on(E.BUFFER_RESET,this.onBufferReset,this),e.on(E.BUFFER_APPENDING,this.onBufferAppending,this),e.on(E.BUFFER_CODECS,this.onBufferCodecs,this),e.on(E.BUFFER_EOS,this.onBufferEos,this),e.on(E.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(E.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(E.FRAG_PARSED,this.onFragParsed,this),e.on(E.FRAG_CHANGED,this.onFragChanged,this)},a.unregisterListeners=function(){var e=this.hls;e.off(E.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(E.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(E.MANIFEST_LOADING,this.onManifestLoading,this),e.off(E.MANIFEST_PARSED,this.onManifestParsed,this),e.off(E.BUFFER_RESET,this.onBufferReset,this),e.off(E.BUFFER_APPENDING,this.onBufferAppending,this),e.off(E.BUFFER_CODECS,this.onBufferCodecs,this),e.off(E.BUFFER_EOS,this.onBufferEos,this),e.off(E.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(E.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(E.FRAG_PARSED,this.onFragParsed,this),e.off(E.FRAG_CHANGED,this.onFragChanged,this)},a._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new cn(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null},a.onManifestLoading=function(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null},a.onManifestParsed=function(e,t){var r=2;t.audio&&!t.video||t.altAudio,r=1,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=r,L.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},a.onMediaAttaching=function(e,t){var r=this.media=t.media;if(r&&_i){var i=this.mediaSource=new _i;i.addEventListener("sourceopen",this._onMediaSourceOpen),i.addEventListener("sourceended",this._onMediaSourceEnded),i.addEventListener("sourceclose",this._onMediaSourceClose),r.src=self.URL.createObjectURL(i),this._objectUrl=r.src,r.addEventListener("emptied",this._onMediaEmptied)}},a.onMediaDetaching=function(){var e=this.media,t=this.mediaSource,r=this._objectUrl;if(t){if(L.log("[buffer-controller]: media source detaching"),t.readyState==="open")try{t.endOfStream()}catch(i){L.warn("[buffer-controller]: onMediaDetaching: "+i.message+" while calling endOfStream")}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(e.removeEventListener("emptied",this._onMediaEmptied),r&&self.URL.revokeObjectURL(r),e.src===r?(e.removeAttribute("src"),e.load()):L.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(E.MEDIA_DETACHED,void 0)},a.onBufferReset=function(){var e=this;this.getSourceBufferTypes().forEach(function(t){var r=e.sourceBuffer[t];try{r&&(e.removeBufferListeners(t),e.mediaSource&&e.mediaSource.removeSourceBuffer(r),e.sourceBuffer[t]=void 0)}catch(i){L.warn("[buffer-controller]: Failed to reset the "+t+" buffer",i)}}),this._initSourceBuffer()},a.onBufferCodecs=function(e,t){var r=this,i=this.getSourceBufferTypes().length;Object.keys(t).forEach(function(n){if(i){var o=r.tracks[n];if(o&&typeof o.buffer.changeType=="function"){var l=t[n],u=l.id,d=l.codec,h=l.levelCodec,f=l.container,c=l.metadata,g=(o.levelCodec||o.codec).replace(xi,"$1"),m=(h||d).replace(xi,"$1");if(g!==m){var y=f+";codecs="+(h||d);r.appendChangeType(n,y),L.log("[buffer-controller]: switching codec "+g+" to "+m),r.tracks[n]={buffer:o.buffer,codec:d,container:f,levelCodec:h,metadata:c,id:u}}}}else r.pendingTracks[n]=t[n]}),i||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},a.appendChangeType=function(e,t){var r=this,i=this.operationQueue,n={execute:function(){var o=r.sourceBuffer[e];o&&(L.log("[buffer-controller]: changing "+e+" sourceBuffer type to "+t),o.changeType(t)),i.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(o){L.warn("[buffer-controller]: Failed to change "+e+" SourceBuffer type",o)}};i.append(n,e)},a.onBufferAppending=function(e,t){var r=this,i=this.hls,n=this.operationQueue,o=this.tracks,l=t.data,u=t.type,d=t.frag,h=t.part,f=t.chunkMeta,c=f.buffering[u],g=self.performance.now();c.start=g;var m=d.stats.buffering,y=h?h.stats.buffering:null;m.start===0&&(m.start=g),y&&y.start===0&&(y.start=g);var v=o.audio,p=!1;u==="audio"&&v?.container==="audio/mpeg"&&(p=!this.lastMpegAudioChunk||f.id===1||this.lastMpegAudioChunk.sn!==f.sn,this.lastMpegAudioChunk=f);var S=d.start,T={execute:function(){if(c.executeStart=self.performance.now(),p){var R=r.sourceBuffer[u];if(R){var b=S-R.timestampOffset;Math.abs(b)>=.1&&(L.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+S+" (delta: "+b+") sn: "+d.sn+")"),R.timestampOffset=S)}}r.appendExecutor(l,u)},onStart:function(){},onComplete:function(){var R=self.performance.now();c.executeEnd=c.end=R,m.first===0&&(m.first=R),y&&y.first===0&&(y.first=R);var b=r.sourceBuffer,A={};for(var _ in b)A[_]=X.getBuffered(b[_]);r.appendError=0,r.hls.trigger(E.BUFFER_APPENDED,{type:u,frag:d,part:h,chunkMeta:f,parent:d.type,timeRanges:A})},onError:function(R){L.error("[buffer-controller]: Error encountered while trying to append to the "+u+" SourceBuffer",R);var b={type:K.MEDIA_ERROR,parent:d.type,details:k.BUFFER_APPEND_ERROR,frag:d,part:h,chunkMeta:f,error:R,err:R,fatal:!1};R.code===DOMException.QUOTA_EXCEEDED_ERR?b.details=k.BUFFER_FULL_ERROR:(r.appendError++,b.details=k.BUFFER_APPEND_ERROR,r.appendError>i.config.appendErrorMaxRetry&&(L.error("[buffer-controller]: Failed "+i.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),b.fatal=!0)),i.trigger(E.ERROR,b)}};n.append(T,u)},a.onBufferFlushing=function(e,t){var r=this,i=this.operationQueue,n=function(o){return{execute:r.removeExecutor.bind(r,o,t.startOffset,t.endOffset),onStart:function(){},onComplete:function(){r.hls.trigger(E.BUFFER_FLUSHED,{type:o})},onError:function(l){L.warn("[buffer-controller]: Failed to remove from "+o+" SourceBuffer",l)}}};t.type?i.append(n(t.type),t.type):this.getSourceBufferTypes().forEach(function(o){i.append(n(o),o)})},a.onFragParsed=function(e,t){var r=this,i=t.frag,n=t.part,o=[],l=n?n.elementaryStreams:i.elementaryStreams;l[wt]?o.push("audiovideo"):(l[me]&&o.push("audio"),l[he]&&o.push("video")),o.length===0&&L.warn("Fragments must have at least one ElementaryStreamType set. type: "+i.type+" level: "+i.level+" sn: "+i.sn),this.blockBuffers(function(){var u=self.performance.now();i.stats.buffering.end=u,n&&(n.stats.buffering.end=u);var d=n?n.stats:i.stats;r.hls.trigger(E.FRAG_BUFFERED,{frag:i,part:n,stats:d,id:i.type})},o)},a.onFragChanged=function(e,t){this.flushBackBuffer()},a.onBufferEos=function(e,t){var r=this;this.getSourceBufferTypes().reduce(function(i,n){var o=r.sourceBuffer[n];return!o||t.type&&t.type!==n||(o.ending=!0,o.ended||(o.ended=!0,L.log("[buffer-controller]: "+n+" sourceBuffer now EOS"))),i&&!(o&&!o.ended)},!0)&&(L.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers(function(){r.getSourceBufferTypes().forEach(function(n){var o=r.sourceBuffer[n];o&&(o.ending=!1)});var i=r.mediaSource;i&&i.readyState==="open"?(L.log("[buffer-controller]: Calling mediaSource.endOfStream()"),i.endOfStream()):i&&L.info("[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: "+i.readyState)}))},a.onLevelUpdated=function(e,t){var r=t.details;r.fragments.length&&(this.details=r,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},a.flushBackBuffer=function(){var e=this.hls,t=this.details,r=this.media,i=this.sourceBuffer;if(r&&t!==null){var n=this.getSourceBufferTypes();if(n.length){var o=t.live&&e.config.liveBackBufferLength!==null?e.config.liveBackBufferLength:e.config.backBufferLength;if(F(o)&&!(o<0)){var l=r.currentTime,u=t.levelTargetDuration,d=Math.max(o,u),h=Math.floor(l/u)*u-d;n.forEach(function(f){var c=i[f];if(c){var g=X.getBuffered(c);if(g.length>0&&h>g.start(0)){if(e.trigger(E.BACK_BUFFER_REACHED,{bufferEnd:h}),t.live)e.trigger(E.LIVE_BACK_BUFFER_REACHED,{bufferEnd:h});else if(c.ended&&g.end(g.length-1)-l<2*u)return void L.info("[buffer-controller]: Cannot flush "+f+" back buffer while SourceBuffer is in ended state");e.trigger(E.BUFFER_FLUSHING,{startOffset:0,endOffset:h,type:f})}}})}}}},a.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&this.mediaSource.readyState==="open"){var e=this.details,t=this.hls,r=this.media,i=this.mediaSource,n=e.fragments[0].start+e.totalduration,o=r.duration,l=F(i.duration)?i.duration:0;e.live&&t.config.liveDurationInfinity?(L.log("[buffer-controller]: Media Source duration is set to Infinity"),i.duration=1/0,this.updateSeekableRange(e)):(n>l&&n>o||!F(o))&&(L.log("[buffer-controller]: Updating Media Source duration to "+n.toFixed(3)),i.duration=n)}},a.updateSeekableRange=function(e){var t=this.mediaSource,r=e.fragments;if(r.length&&e.live&&t!=null&&t.setLiveSeekableRange){var i=Math.max(0,r[0].start),n=Math.max(i,i+e.totalduration);t.setLiveSeekableRange(i,n)}},a.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,t=this.operationQueue,r=this.pendingTracks,i=Object.keys(r).length;if(i&&!e||i===2){this.createSourceBuffers(r),this.pendingTracks={};var n=this.getSourceBufferTypes();if(n.length)this.hls.trigger(E.BUFFER_CREATED,{tracks:this.tracks}),n.forEach(function(l){t.executeNext(l)});else{var o=new Error("could not create source buffer for media codec(s)");this.hls.trigger(E.ERROR,{type:K.MEDIA_ERROR,details:k.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:o,reason:o.message})}}},a.createSourceBuffers=function(e){var t=this.sourceBuffer,r=this.mediaSource;if(!r)throw Error("createSourceBuffers called when mediaSource was null");for(var i in e)if(!t[i]){var n=e[i];if(!n)throw Error("source buffer exists for track "+i+", however track does not");var o=n.levelCodec||n.codec,l=n.container+";codecs="+o;L.log("[buffer-controller]: creating sourceBuffer("+l+")");try{var u=t[i]=r.addSourceBuffer(l),d=i;this.addBufferListener(d,"updatestart",this._onSBUpdateStart),this.addBufferListener(d,"updateend",this._onSBUpdateEnd),this.addBufferListener(d,"error",this._onSBUpdateError),this.tracks[i]={buffer:u,codec:o,container:n.container,levelCodec:n.levelCodec,metadata:n.metadata,id:n.id}}catch(h){L.error("[buffer-controller]: error while trying to add sourceBuffer: "+h.message),this.hls.trigger(E.ERROR,{type:K.MEDIA_ERROR,details:k.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:h,mimeType:l})}}},a._onSBUpdateStart=function(e){this.operationQueue.current(e).onStart()},a._onSBUpdateEnd=function(e){var t=this.operationQueue;t.current(e).onComplete(),t.shiftAndExecuteNext(e)},a._onSBUpdateError=function(e,t){var r=new Error(e+" SourceBuffer error");L.error("[buffer-controller]: "+r,t),this.hls.trigger(E.ERROR,{type:K.MEDIA_ERROR,details:k.BUFFER_APPENDING_ERROR,error:r,fatal:!1});var i=this.operationQueue.current(e);i&&i.onError(t)},a.removeExecutor=function(e,t,r){var i=this.media,n=this.mediaSource,o=this.operationQueue,l=this.sourceBuffer[e];if(!i||!n||!l)return L.warn("[buffer-controller]: Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),void o.shiftAndExecuteNext(e);var u=F(i.duration)?i.duration:1/0,d=F(n.duration)?n.duration:1/0,h=Math.max(0,t),f=Math.min(r,u,d);f>h&&!l.ending?(l.ended=!1,L.log("[buffer-controller]: Removing ["+h+","+f+"] from the "+e+" SourceBuffer"),l.remove(h,f)):o.shiftAndExecuteNext(e)},a.appendExecutor=function(e,t){var r=this.operationQueue,i=this.sourceBuffer[t];if(!i)return L.warn("[buffer-controller]: Attempting to append to the "+t+" SourceBuffer, but it does not exist"),void r.shiftAndExecuteNext(t);i.ended=!1,i.appendBuffer(e)},a.blockBuffers=function(e,t){var r=this;if(t===void 0&&(t=this.getSourceBufferTypes()),!t.length)return L.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(e);var i=this.operationQueue,n=t.map(function(o){return i.appendBlocker(o)});Promise.all(n).then(function(){e(),t.forEach(function(o){var l=r.sourceBuffer[o];l!=null&&l.updating||i.shiftAndExecuteNext(o)})})},a.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},a.addBufferListener=function(e,t,r){var i=this.sourceBuffer[e];if(i){var n=r.bind(this,e);this.listeners[e].push({event:t,listener:n}),i.addEventListener(t,n)}},a.removeBufferListeners=function(e){var t=this.sourceBuffer[e];t&&this.listeners[e].forEach(function(r){t.removeEventListener(r.event,r.listener)})},s}(),gn=function(){function s(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var a=s.prototype;return a.setStreamController=function(e){this.streamController=e},a.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},a.registerListeners=function(){var e=this.hls;e.on(E.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(E.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(E.MANIFEST_PARSED,this.onManifestParsed,this),e.on(E.BUFFER_CODECS,this.onBufferCodecs,this),e.on(E.MEDIA_DETACHING,this.onMediaDetaching,this)},a.unregisterListener=function(){var e=this.hls;e.off(E.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(E.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(E.MANIFEST_PARSED,this.onManifestParsed,this),e.off(E.BUFFER_CODECS,this.onBufferCodecs,this),e.off(E.MEDIA_DETACHING,this.onMediaDetaching,this)},a.onFpsDropLevelCapping=function(e,t){var r=this.hls.levels[t.droppedLevel];this.isLevelAllowed(r)&&this.restrictedLevels.push({bitrate:r.bitrate,height:r.height,width:r.width})},a.onMediaAttaching=function(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null},a.onManifestParsed=function(e,t){var r=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,r.config.capLevelToPlayerSize&&t.video&&this.startCapping()},a.onBufferCodecs=function(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()},a.onMediaDetaching=function(){this.stopCapping()},a.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var e=this.hls.levels;if(e.length){var t=this.hls;t.autoLevelCapping=this.getMaxLevel(e.length-1),t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}},a.getMaxLevel=function(e){var t=this,r=this.hls.levels;if(!r.length)return-1;var i=r.filter(function(n,o){return t.isLevelAllowed(n)&&o<=e});return this.clientRect=null,s.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)},a.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},a.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},a.getDimensions=function(){if(this.clientRect)return this.clientRect;var e=this.media,t={width:0,height:0};if(e){var r=e.getBoundingClientRect();t.width=r.width,t.height=r.height,t.width||t.height||(t.width=r.right-r.left||e.width||0,t.height=r.bottom-r.top||e.height||0)}return this.clientRect=t,t},a.isLevelAllowed=function(e){return!this.restrictedLevels.some(function(t){return e.bitrate===t.bitrate&&e.width===t.width&&e.height===t.height})},s.getMaxLevelByMediaSize=function(e,t,r){if(e==null||!e.length)return-1;for(var i,n,o=e.length-1,l=0;l<e.length;l+=1){var u=e[l];if((u.width>=t||u.height>=r)&&(i=u,!(n=e[l+1])||i.width!==n.width||i.height!==n.height)){o=l;break}}return o},se(s,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return e}}]),s}(),mn=function(){function s(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}var a=s.prototype;return a.setStreamController=function(e){this.streamController=e},a.registerListeners=function(){this.hls.on(E.MEDIA_ATTACHING,this.onMediaAttaching,this)},a.unregisterListeners=function(){this.hls.off(E.MEDIA_ATTACHING,this.onMediaAttaching,this)},a.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},a.onMediaAttaching=function(e,t){var r=this.hls.config;if(r.capLevelOnFPSDrop){var i=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=i,i&&typeof i.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}},a.checkFPS=function(e,t,r){var i=performance.now();if(t){if(this.lastTime){var n=i-this.lastTime,o=r-this.lastDroppedFrames,l=t-this.lastDecodedFrames,u=1e3*o/n,d=this.hls;if(d.trigger(E.FPS_DROP,{currentDropped:o,currentDecoded:l,totalDroppedFrames:r}),u>0&&o>d.config.fpsDroppedMonitoringThreshold*l){var h=d.currentLevel;L.warn("drop FPS ratio greater than max allowed value for currentLevel: "+h),h>0&&(d.autoLevelCapping===-1||d.autoLevelCapping>=h)&&(h-=1,d.trigger(E.FPS_DROP_LEVEL_CAPPING,{level:h,droppedLevel:d.currentLevel}),d.autoLevelCapping=h,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=r,this.lastDecodedFrames=t}},a.checkFPSInterval=function(){var e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)},s}(),pn=/^age:\s*[\d.]+\s*$/im,wi=function(){function s(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new st,this.retryDelay=0}var a=s.prototype;return a.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},a.abortInternal=function(){var e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))},a.abort=function(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},a.load=function(e,t,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=r,this.loadInternal()},a.loadInternal=function(){var e=this,t=this.config,r=this.context;if(t){var i=this.loader=new self.XMLHttpRequest,n=this.stats;n.loading.first=0,n.loaded=0,n.aborted=!1;var o=this.xhrSetup;o?Promise.resolve().then(function(){if(!e.stats.aborted)return o(i,r.url)}).catch(function(l){return i.open("GET",r.url,!0),o(i,r.url)}).then(function(){e.stats.aborted||e.openAndSendXhr(i,r,t)}).catch(function(l){e.callbacks.onError({code:i.status,text:l.message},r,i,n)}):this.openAndSendXhr(i,r,t)}},a.openAndSendXhr=function(e,t,r){e.readyState||e.open("GET",t.url,!0);var i=this.context.headers,n=r.loadPolicy,o=n.maxTimeToFirstByteMs,l=n.maxLoadTimeMs;if(i)for(var u in i)e.setRequestHeader(u,i[u]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),r.timeout=o&&F(o)?o:l,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.timeout),e.send()},a.readystatechange=function(){var e=this.context,t=this.loader,r=this.stats;if(e&&t){var i=t.readyState,n=this.config;if(!r.aborted&&i>=2&&(r.loading.first===0&&(r.loading.first=Math.max(self.performance.now(),r.loading.start),n.timeout!==n.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),n.timeout=n.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.loadPolicy.maxLoadTimeMs-(r.loading.first-r.loading.start)))),i===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;var o=t.status,l=t.responseType!=="text";if(o>=200&&o<300&&(l&&t.response||t.responseText!==null)){r.loading.end=Math.max(self.performance.now(),r.loading.first);var u=l?t.response:t.responseText,d=t.responseType==="arraybuffer"?u.byteLength:u.length;if(r.loaded=r.total=d,r.bwEstimate=8e3*r.total/(r.loading.end-r.loading.first),!this.callbacks)return;var h=this.callbacks.onProgress;if(h&&h(r,e,u,t),!this.callbacks)return;var f={url:t.responseURL,data:u,code:o};this.callbacks.onSuccess(f,r,e,t)}else{var c=n.loadPolicy.errorRetry;vt(c,r.retry,!1,o)?this.retry(c):(L.error(o+" while loading "+e.url),this.callbacks.onError({code:o,text:t.statusText},e,t,r))}}}},a.loadtimeout=function(){var e,t=(e=this.config)==null?void 0:e.loadPolicy.timeoutRetry;if(vt(t,this.stats.retry,!0))this.retry(t);else{L.warn("timeout while loading "+this.context.url);var r=this.callbacks;r&&(this.abortInternal(),r.onTimeout(this.stats,this.context,this.loader))}},a.retry=function(e){var t=this.context,r=this.stats;this.retryDelay=Kt(e,r.retry),r.retry++,L.warn((status?"HTTP Status "+status:"Timeout")+" while loading "+t.url+", retrying "+r.retry+"/"+e.maxNumRetry+" in "+this.retryDelay+"ms"),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)},a.loadprogress=function(e){var t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)},a.getCacheAge=function(){var e=null;if(this.loader&&pn.test(this.loader.getAllResponseHeaders())){var t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e},a.getResponseHeader=function(e){return this.loader&&new RegExp("^"+e+":\\s*[\\d.]+\\s*$","im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null},s}(),yn=function(){function s(){this.chunks=[],this.dataLength=0}var a=s.prototype;return a.push=function(e){this.chunks.push(e),this.dataLength+=e.length},a.flush=function(){var e,t=this.chunks,r=this.dataLength;return t.length?(e=t.length===1?t[0]:function(i,n){for(var o=new Uint8Array(n),l=0,u=0;u<i.length;u++){var d=i[u];o.set(d,l),l+=d.length}return o}(t,r),this.reset(),e):new Uint8Array(0)},a.reset=function(){this.chunks.length=0,this.dataLength=0},s}(),En=/(\d+)-(\d+)\/(\d+)/,Ii=function(){function s(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||Tn,this.controller=new self.AbortController,this.stats=new st}var a=s.prototype;return a.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},a.abortInternal=function(){var e=this.response;e!=null&&e.ok||(this.stats.aborted=!0,this.controller.abort())},a.abort=function(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},a.load=function(e,t,r){var i=this,n=this.stats;if(n.loading.start)throw new Error("Loader can only be used once.");n.loading.start=self.performance.now();var o=function(g,m){var y={method:"GET",mode:"cors",credentials:"same-origin",signal:m,headers:new self.Headers(oe({},g.headers))};return g.rangeEnd&&y.headers.set("Range","bytes="+g.rangeStart+"-"+String(g.rangeEnd-1)),y}(e,this.controller.signal),l=r.onProgress,u=e.responseType==="arraybuffer",d=u?"byteLength":"length",h=t.loadPolicy,f=h.maxTimeToFirstByteMs,c=h.maxLoadTimeMs;this.context=e,this.config=t,this.callbacks=r,this.request=this.fetchSetup(e,o),self.clearTimeout(this.requestTimeout),t.timeout=f&&F(f)?f:c,this.requestTimeout=self.setTimeout(function(){i.abortInternal(),r.onTimeout(n,e,i.response)},t.timeout),self.fetch(this.request).then(function(g){i.response=i.loader=g;var m=Math.max(self.performance.now(),n.loading.start);if(self.clearTimeout(i.requestTimeout),t.timeout=c,i.requestTimeout=self.setTimeout(function(){i.abortInternal(),r.onTimeout(n,e,i.response)},c-(m-n.loading.start)),!g.ok){var y=g.status,v=g.statusText;throw new Sn(v||"fetch, bad network response",y,g)}return n.loading.first=m,n.total=function(p){var S=p.get("Content-Range");if(S){var T=function(b){var A=En.exec(b);if(A)return parseInt(A[2])-parseInt(A[1])+1}(S);if(F(T))return T}var R=p.get("Content-Length");if(R)return parseInt(R)}(g.headers)||n.total,l&&F(t.highWaterMark)?i.loadProgressively(g,n,e,t.highWaterMark,l):u?g.arrayBuffer():e.responseType==="json"?g.json():g.text()}).then(function(g){var m=i.response;self.clearTimeout(i.requestTimeout),n.loading.end=Math.max(self.performance.now(),n.loading.first);var y=g[d];y&&(n.loaded=n.total=y);var v={url:m.url,data:g,code:m.status};l&&!F(t.highWaterMark)&&l(n,e,g,m),r.onSuccess(v,n,e,m)}).catch(function(g){if(self.clearTimeout(i.requestTimeout),!n.aborted){var m=g&&g.code||0,y=g?g.message:null;r.onError({code:m,text:y},e,g?g.details:null,n)}})},a.getCacheAge=function(){var e=null;if(this.response){var t=this.response.headers.get("age");e=t?parseFloat(t):null}return e},a.getResponseHeader=function(e){return this.response?this.response.headers.get(e):null},a.loadProgressively=function(e,t,r,i,n){i===void 0&&(i=0);var o=new yn,l=e.body.getReader();return function u(){return l.read().then(function(d){if(d.done)return o.dataLength&&n(t,r,o.flush(),e),Promise.resolve(new ArrayBuffer(0));var h=d.value,f=h.length;return t.loaded+=f,f<i||o.dataLength?(o.push(h),o.dataLength>=i&&n(t,r,o.flush(),e)):n(t,r,h,e),u()}).catch(function(){return Promise.reject()})}()},s}();function Tn(s,a){return new self.Request(s.url,a)}var Sn=function(s){function a(e,t,r){var i;return(i=s.call(this,e)||this).code=void 0,i.details=void 0,i.code=t,i.details=r,i}return Ee(a,s),a}(nt(Error)),Ci={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},Ln=de(de({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:wi,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:fn,bufferController:vn,capLevelController:gn,errorController:_a,fpsController:mn,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:null,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,certLoadPolicy:{default:Ci},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:Ci},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},{cueHandler:Zi,enableWebVTT:!1,enableIMSC1:!1,enableCEA708Captions:!1,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:void 0,subtitleTrackController:void 0,timelineController:void 0,audioStreamController:void 0,audioTrackController:void 0,emeController:void 0,cmcdController:void 0,contentSteeringController:void 0});function or(s){return s&&typeof s=="object"?Array.isArray(s)?s.map(or):Object.keys(s).reduce(function(a,e){return a[e]=or(s[e]),a},{}):s}function Rn(s){var a=s.loader;a!==Ii&&a!==wi?(L.log("[config]: Custom loader detected, cannot enable progressive streaming"),s.progressive=!1):function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}()&&(s.loader=Ii,s.progressive=!0,s.enableSoftwareAES=!0,L.log("[config]: Progressive streaming enabled, using FetchLoader"))}var Pi=function(){function s(e){e===void 0&&(e={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new ar,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,gr(e.debug||!1,"Hls instance");var t=this.config=function(I,w){if((w.liveSyncDurationCount||w.liveMaxLatencyDurationCount)&&(w.liveSyncDuration||w.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(w.liveMaxLatencyDurationCount!==void 0&&(w.liveSyncDurationCount===void 0||w.liveMaxLatencyDurationCount<=w.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(w.liveMaxLatencyDuration!==void 0&&(w.liveSyncDuration===void 0||w.liveMaxLatencyDuration<=w.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');var O=or(I),B=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach(function(C){var U=(C==="level"?"playlist":C)+"LoadPolicy",M=w[U]===void 0,P=[];B.forEach(function(H){var V=C+"Loading"+H,G=w[V];if(G!==void 0&&M){P.push(V);var q=O[U].default;switch(w[U]={default:q},H){case"TimeOut":q.maxLoadTimeMs=G,q.maxTimeToFirstByteMs=G;break;case"MaxRetry":q.errorRetry.maxNumRetry=G,q.timeoutRetry.maxNumRetry=G;break;case"RetryDelay":q.errorRetry.retryDelayMs=G,q.timeoutRetry.retryDelayMs=G;break;case"MaxRetryTimeout":q.errorRetry.maxRetryDelayMs=G,q.timeoutRetry.maxRetryDelayMs=G}}}),P.length&&L.warn('hls.js config: "'+P.join('", "')+'" setting(s) are deprecated, use "'+U+'": '+JSON.stringify(w[U]))}),de(de({},O),w)}(s.DefaultConfig,e);this.userConfig=e,this._autoLevelCapping=-1,t.progressive&&Rn(t);var r=t.abrController,i=t.bufferController,n=t.capLevelController,o=t.errorController,l=t.fpsController,u=new o(this),d=this.abrController=new r(this),h=this.bufferController=new i(this),f=this.capLevelController=new n(this),c=new l(this),g=new ma(this),m=new Ta(this),y=t.contentSteeringController,v=y?new y(this):null,p=this.levelController=new wa(this,v),S=new Ia(this),T=new Pa(this.config),R=this.streamController=new dn(this,S,T);f.setStreamController(R),c.setStreamController(R);var b=[g,p,R];v&&b.splice(1,0,v),this.networkControllers=b;var A=[d,h,f,c,m,S];this.audioTrackController=this.createController(t.audioTrackController,b);var _=t.audioStreamController;_&&b.push(new _(this,S,T)),this.subtitleTrackController=this.createController(t.subtitleTrackController,b);var x=t.subtitleStreamController;x&&b.push(new x(this,S,T)),this.createController(t.timelineController,A),T.emeController=this.emeController=this.createController(t.emeController,A),this.cmcdController=this.createController(t.cmcdController,A),this.latencyController=this.createController(Sa,A),this.coreComponents=A,b.push(u);var D=u.onErrorOut;typeof D=="function"&&this.on(E.ERROR,D,u)}s.isSupported=function(){return function(){var e=dt();if(!e)return!1;var t=ui(),r=e&&typeof e.isTypeSupported=="function"&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),i=!t||t.prototype&&typeof t.prototype.appendBuffer=="function"&&typeof t.prototype.remove=="function";return!!r&&!!i}()};var a=s.prototype;return a.createController=function(e,t){if(e){var r=new e(this);return t&&t.push(r),r}return null},a.on=function(e,t,r){r===void 0&&(r=this),this._emitter.on(e,t,r)},a.once=function(e,t,r){r===void 0&&(r=this),this._emitter.once(e,t,r)},a.removeAllListeners=function(e){this._emitter.removeAllListeners(e)},a.off=function(e,t,r,i){r===void 0&&(r=this),this._emitter.off(e,t,r,i)},a.listeners=function(e){return this._emitter.listeners(e)},a.emit=function(e,t,r){return this._emitter.emit(e,t,r)},a.trigger=function(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(r){L.error("An internal error happened while handling event "+e+'. Error message: "'+r.message+'". Here is a stacktrace:',r),this.trigger(E.ERROR,{type:K.OTHER_ERROR,details:k.INTERNAL_EXCEPTION,fatal:!1,event:e,error:r})}return!1},a.listenerCount=function(e){return this._emitter.listenerCount(e)},a.destroy=function(){L.log("destroy"),this.trigger(E.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(t){return t.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(t){return t.destroy()}),this.coreComponents.length=0;var e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null},a.attachMedia=function(e){L.log("attachMedia"),this._media=e,this.trigger(E.MEDIA_ATTACHING,{media:e})},a.detachMedia=function(){L.log("detachMedia"),this.trigger(E.MEDIA_DETACHING,void 0),this._media=null},a.loadSource=function(e){this.stopLoad();var t=this.media,r=this.url,i=this.url=_t.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});L.log("loadSource:"+i),t&&r&&(r!==i||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(E.MANIFEST_LOADING,{url:e})},a.startLoad=function(e){e===void 0&&(e=-1),L.log("startLoad("+e+")"),this.networkControllers.forEach(function(t){t.startLoad(e)})},a.stopLoad=function(){L.log("stopLoad"),this.networkControllers.forEach(function(e){e.stopLoad()})},a.swapAudioCodec=function(){L.log("swapAudioCodec"),this.streamController.swapAudioCodec()},a.recoverMediaError=function(){L.log("recoverMediaError");var e=this._media;this.detachMedia(),e&&this.attachMedia(e)},a.removeLevel=function(e,t){t===void 0&&(t=0),this.levelController.removeLevel(e,t)},se(s,[{key:"levels",get:function(){var e=this.levelController.levels;return e||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){L.log("set currentLevel:"+e),this.loadLevel=e,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){L.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){L.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){L.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){L.log("set startLevel:"+e),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(e){var t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){this._autoLevelCapping!==e&&(L.log("set autoLevelCapping:"+e),this._autoLevelCapping=e)}},{key:"bandwidthEstimate",get:function(){var e=this.abrController.bwEstimator;return e?e.getEstimate():NaN}},{key:"ttfbEstimate",get:function(){var e=this.abrController.bwEstimator;return e?e.getEstimateTTFB():NaN}},{key:"maxHdcpLevel",get:function(){return this._maxHdcpLevel},set:function(e){Ut.indexOf(e)>-1&&(this._maxHdcpLevel=e)}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var e=this.levels,t=this.config.minAutoBitrate;if(!e)return 0;for(var r=e.length,i=0;i<r;i++)if(e[i].maxBitrate>=t)return i;return 0}},{key:"maxAutoLevel",get:function(){var e,t=this.levels,r=this.autoLevelCapping,i=this.maxHdcpLevel;if(e=r===-1&&t&&t.length?t.length-1:r,i)for(var n=e;n--;){var o=t[n].attrs["HDCP-LEVEL"];if(o&&o<=i)return n}return e}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"audioTracks",get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]}},{key:"audioTrack",get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;t&&(t.audioTrack=e)}},{key:"subtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var e=this.subtitleTrackController;return!!e&&e.subtitleDisplay},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(e){this.config.lowLatencyMode=e}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.4.13"}},{key:"Events",get:function(){return E}},{key:"ErrorTypes",get:function(){return K}},{key:"ErrorDetails",get:function(){return k}},{key:"DefaultConfig",get:function(){return s.defaultConfig?s.defaultConfig:Ln},set:function(e){s.defaultConfig=e}}]),s}();return Pi.defaultConfig=void 0,Pi},typeof Ui=="object"&&typeof dr<"u"?dr.exports=xe():typeof define=="function"&&define.amd?define(xe):(ye=typeof globalThis<"u"?globalThis:ye||self).Hls=xe()})(!1)});var Hi=Bn(Gi(),1);window.Hls=Hi.default;})();
